
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="PII anonymization for text, images, and structured data.">
      
      
        <meta name="author" content="Microsoft">
      
      
        <link rel="canonical" href="https://microsoft.github.io/presidio/api/image_redactor_python/">
      
      
        <link rel="prev" href="../anonymizer_python/">
      
      
        <link rel="next" href="../structured_python/">
      
      
      <link rel="icon" href="../../assets/ms_icon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Presidio Image Redactor Python API - Microsoft Presidio</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
<script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "5pd40fk720");
</script>

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#presidio-image-redactor-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Microsoft Presidio" class="md-header__button md-logo" aria-label="Microsoft Presidio" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Microsoft Presidio
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Presidio Image Redactor Python API
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/microsoft/presidio/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  Presidio

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../getting_started/" class="md-tabs__link">
          
  
  Quick start

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../learn_presidio/" class="md-tabs__link">
          
  
  Learn Presidio

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../supported_entities/" class="md-tabs__link">
          
  
  Resources

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../samples/" class="md-tabs__link">
          
  
  Samples

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Microsoft Presidio" class="md-nav__button md-logo" aria-label="Microsoft Presidio" data-md-component="logo">
      
  <img src="../../assets/ms_icon.png" alt="logo">

    </a>
    Microsoft Presidio
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/microsoft/presidio/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Presidio
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Presidio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Quick start
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Quick start
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/getting_started_text/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Text
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/getting_started_images/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Images
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/getting_started_structured/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Semi/Structured data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Learn Presidio
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Learn Presidio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_presidio/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../learn_presidio/concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/00_getting_started/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/01_deny_list/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deny-list recognizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/02_regex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Regex recognizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/03_rule_based/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rule-based recognizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/05_languages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Additional models/languages
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/04_external_services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    External services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/06_context/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Context enhancement
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/07_decision_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Decision process
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/08_no_code/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    No-code recognizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/09_ad_hoc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ad-hoc recognizers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/10_simple_anonymization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simple anonymization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/11_custom_anonymization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom anonymization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/12_encryption/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Encryption/Decryption
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorial/13_allow_list/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Allow-lists
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Text de-identification
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Text de-identification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../text_anonymization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2" id="__nav_3_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Presidio Analyzer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            Presidio Analyzer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2_2" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2_2" id="__nav_3_4_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developing PII recognizers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2_2">
            <span class="md-nav__icon md-icon"></span>
            Developing PII recognizers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/adding_recognizers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/developing_recognizers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Best practices
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/recognizer_registry_provider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Recognizer registry from file
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/languages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Multi-language support
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4_2_4" id="__nav_3_4_2_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Customizing the NLP model
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_4_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2_4">
            <span class="md-nav__icon md-icon"></span>
            Customizing the NLP model
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/customizing_nlp_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/nlp_engines/spacy_stanza/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Spacy/Stanza
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/nlp_engines/transformers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Transformers
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/decision_process/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tracing the decision process
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../analyzer/analyzer_engine_provider/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configure from file
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3" >
        
          
          <label class="md-nav__link" for="__nav_3_4_3" id="__nav_3_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Presidio Anonymizer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Presidio Anonymizer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../anonymizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../anonymizer/adding_operators/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Developing PII anonymization operators
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Image de-identification
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Image de-identification
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image-redactor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../image-redactor/evaluating_dicom_redaction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Evaluating DICOM redaction
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Structured and Semi-structured
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Structured and Semi-structured
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../structured/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PII detection evaluation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Resources
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Resources
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../supported_entities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Supported entities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../community/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Community
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/microsoft/presidio/blob/main/CHANGELOG.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Change log
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setting up a development environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build_release/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Build and release process
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../presidio_V2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Changes from V1 to V2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_7" checked>
        
          
          <label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Python API reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_7">
            <span class="md-nav__icon md-icon"></span>
            Python API reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../analyzer_python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presidio Analyzer Python API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../anonymizer_python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presidio Anonymizer Python API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Presidio Image Redactor Python API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Presidio Image Redactor Python API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#presidio_image_redactor" class="md-nav__link">
    <span class="md-ellipsis">
      presidio_image_redactor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="presidio_image_redactor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine" class="md-nav__link">
    <span class="md-ellipsis">
      image_processing_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_processing_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImagePreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.BilateralFilter" class="md-nav__link">
    <span class="md-ellipsis">
      BilateralFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BilateralFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.BilateralFilter.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.BilateralFilter.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentedAdaptiveThreshold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SegmentedAdaptiveThreshold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImageRescaling" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRescaling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRescaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImageRescaling.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImageRescaling.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer" class="md-nav__link">
    <span class="md-ellipsis">
      ContrastSegmentedImageEnhancer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContrastSegmentedImageEnhancer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine" class="md-nav__link">
    <span class="md-ellipsis">
      dicom_image_redactor_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dicom_image_redactor_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine" class="md-nav__link">
    <span class="md-ellipsis">
      DicomImageRedactorEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DicomImageRedactorEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_and_return_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      redact_and_return_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.augment_word" class="md-nav__link">
    <span class="md-ellipsis">
      augment_word
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.tesseract_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      tesseract_ocr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tesseract_ocr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.tesseract_ocr.TesseractOCR" class="md-nav__link">
    <span class="md-ellipsis">
      TesseractOCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TesseractOCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.tesseract_ocr.TesseractOCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.tesseract_ocr.TesseractOCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine" class="md-nav__link">
    <span class="md-ellipsis">
      dicom_image_pii_verify_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dicom_image_pii_verify_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine" class="md-nav__link">
    <span class="md-ellipsis">
      DicomImagePiiVerifyEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DicomImagePiiVerifyEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_and_return_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      redact_and_return_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.augment_word" class="md-nav__link">
    <span class="md-ellipsis">
      augment_word
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify_dicom_instance" class="md-nav__link">
    <span class="md-ellipsis">
      verify_dicom_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.eval_dicom_instance" class="md-nav__link">
    <span class="md-ellipsis">
      eval_dicom_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_precision" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_precision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_recall" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_recall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox" class="md-nav__link">
    <span class="md-ellipsis">
      bbox
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bbox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BboxProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BboxProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_ocr_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_bboxes_from_ocr_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_analyzer_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_bboxes_from_analyzer_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor.remove_bbox_padding" class="md-nav__link">
    <span class="md-ellipsis">
      remove_bbox_padding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor.match_with_source" class="md-nav__link">
    <span class="md-ellipsis">
      match_with_source
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ocr" class="md-nav__link">
    <span class="md-ellipsis">
      ocr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ocr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ocr.OCR" class="md-nav__link">
    <span class="md-ellipsis">
      OCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ocr.OCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ocr.OCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_redactor_engine" class="md-nav__link">
    <span class="md-ellipsis">
      image_redactor_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_redactor_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_redactor_engine.ImageRedactorEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRedactorEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRedactorEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_redactor_engine.ImageRedactorEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine" class="md-nav__link">
    <span class="md-ellipsis">
      image_analyzer_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_analyzer_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImageAnalyzerEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageAnalyzerEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.analyze" class="md-nav__link">
    <span class="md-ellipsis">
      analyze
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.threshold_ocr_result" class="md-nav__link">
    <span class="md-ellipsis">
      threshold_ocr_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.remove_space_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      remove_space_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      map_analyzer_results_to_bounding_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.fig2img" class="md-nav__link">
    <span class="md-ellipsis">
      fig2img
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.get_pii_bboxes" class="md-nav__link">
    <span class="md-ellipsis">
      get_pii_bboxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.add_custom_bboxes" class="md-nav__link">
    <span class="md-ellipsis">
      add_custom_bboxes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      document_intelligence_ocr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="document_intelligence_ocr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentIntelligenceOCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentIntelligenceOCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_imgbytes" class="md-nav__link">
    <span class="md-ellipsis">
      get_imgbytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.analyze_document" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine" class="md-nav__link">
    <span class="md-ellipsis">
      image_pii_verify_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_pii_verify_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine.fig2img" class="md-nav__link">
    <span class="md-ellipsis">
      fig2img
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePiiVerifyEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImagePiiVerifyEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities" class="md-nav__link">
    <span class="md-ellipsis">
      entities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="entities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result" class="md-nav__link">
    <span class="md-ellipsis">
      image_recognizer_result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_recognizer_result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRecognizerResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRecognizerResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.append_analysis_explanation_text" class="md-nav__link">
    <span class="md-ellipsis">
      append_analysis_explanation_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.from_json" class="md-nav__link">
    <span class="md-ellipsis">
      from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.intersects" class="md-nav__link">
    <span class="md-ellipsis">
      intersects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contained_in" class="md-nav__link">
    <span class="md-ellipsis">
      contained_in
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contains" class="md-nav__link">
    <span class="md-ellipsis">
      contains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.equal_indices" class="md-nav__link">
    <span class="md-ellipsis">
      equal_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.has_conflict" class="md-nav__link">
    <span class="md-ellipsis">
      has_conflict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.api_request_convertor" class="md-nav__link">
    <span class="md-ellipsis">
      api_request_convertor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="api_request_convertor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.api_request_convertor.get_json_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_json_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.api_request_convertor.color_fill_string_to_value" class="md-nav__link">
    <span class="md-ellipsis">
      color_fill_string_to_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.api_request_convertor.image_to_byte_array" class="md-nav__link">
    <span class="md-ellipsis">
      image_to_byte_array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.invalid_exception" class="md-nav__link">
    <span class="md-ellipsis">
      invalid_exception
    </span>
  </a>
  
    <nav class="md-nav" aria-label="invalid_exception">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.invalid_exception.InvalidParamError" class="md-nav__link">
    <span class="md-ellipsis">
      InvalidParamError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRecognizerResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRecognizerResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.append_analysis_explanation_text" class="md-nav__link">
    <span class="md-ellipsis">
      append_analysis_explanation_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.from_json" class="md-nav__link">
    <span class="md-ellipsis">
      from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.intersects" class="md-nav__link">
    <span class="md-ellipsis">
      intersects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.contained_in" class="md-nav__link">
    <span class="md-ellipsis">
      contained_in
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.contains" class="md-nav__link">
    <span class="md-ellipsis">
      contains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.equal_indices" class="md-nav__link">
    <span class="md-ellipsis">
      equal_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.has_conflict" class="md-nav__link">
    <span class="md-ellipsis">
      has_conflict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.InvalidParamError" class="md-nav__link">
    <span class="md-ellipsis">
      InvalidParamError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.OCR" class="md-nav__link">
    <span class="md-ellipsis">
      OCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.OCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.OCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.TesseractOCR" class="md-nav__link">
    <span class="md-ellipsis">
      TesseractOCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TesseractOCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.TesseractOCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.TesseractOCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentIntelligenceOCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentIntelligenceOCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR.get_imgbytes" class="md-nav__link">
    <span class="md-ellipsis">
      get_imgbytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR.analyze_document" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BboxProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BboxProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor.get_bboxes_from_ocr_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_bboxes_from_ocr_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor.get_bboxes_from_analyzer_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_bboxes_from_analyzer_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor.remove_bbox_padding" class="md-nav__link">
    <span class="md-ellipsis">
      remove_bbox_padding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor.match_with_source" class="md-nav__link">
    <span class="md-ellipsis">
      match_with_source
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImagePreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePreprocessor.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePreprocessor.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImageAnalyzerEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageAnalyzerEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.analyze" class="md-nav__link">
    <span class="md-ellipsis">
      analyze
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.threshold_ocr_result" class="md-nav__link">
    <span class="md-ellipsis">
      threshold_ocr_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.remove_space_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      remove_space_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      map_analyzer_results_to_bounding_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.fig2img" class="md-nav__link">
    <span class="md-ellipsis">
      fig2img
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.get_pii_bboxes" class="md-nav__link">
    <span class="md-ellipsis">
      get_pii_bboxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.add_custom_bboxes" class="md-nav__link">
    <span class="md-ellipsis">
      add_custom_bboxes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRedactorEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRedactorEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRedactorEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRedactorEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePiiVerifyEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePiiVerifyEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImagePiiVerifyEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePiiVerifyEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePiiVerifyEngine.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine" class="md-nav__link">
    <span class="md-ellipsis">
      DicomImageRedactorEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DicomImageRedactorEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.redact_and_return_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      redact_and_return_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.redact_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.redact_from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.augment_word" class="md-nav__link">
    <span class="md-ellipsis">
      augment_word
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine" class="md-nav__link">
    <span class="md-ellipsis">
      DicomImagePiiVerifyEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DicomImagePiiVerifyEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact_and_return_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      redact_and_return_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.augment_word" class="md-nav__link">
    <span class="md-ellipsis">
      augment_word
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.verify_dicom_instance" class="md-nav__link">
    <span class="md-ellipsis">
      verify_dicom_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.eval_dicom_instance" class="md-nav__link">
    <span class="md-ellipsis">
      eval_dicom_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_precision" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_precision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_recall" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_recall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ContrastSegmentedImageEnhancer" class="md-nav__link">
    <span class="md-ellipsis">
      ContrastSegmentedImageEnhancer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContrastSegmentedImageEnhancer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ContrastSegmentedImageEnhancer.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ContrastSegmentedImageEnhancer.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BilateralFilter" class="md-nav__link">
    <span class="md-ellipsis">
      BilateralFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BilateralFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BilateralFilter.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BilateralFilter.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.SegmentedAdaptiveThreshold" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentedAdaptiveThreshold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SegmentedAdaptiveThreshold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.SegmentedAdaptiveThreshold.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.SegmentedAdaptiveThreshold.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRescaling" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRescaling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRescaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRescaling.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRescaling.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../structured_python/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presidio Structured Python API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://microsoft.github.io/presidio/api-docs/api-docs.html" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST API reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Samples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Samples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Usage
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_2" >
        
          
          <label class="md-nav__link" for="__nav_5_1_2" id="__nav_5_1_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Text
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_2">
            <span class="md-nav__icon md-icon"></span>
            Text
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/presidio_notebook/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presidio Basic Usage Notebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/customizing_presidio_analyzer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customizing Presidio Analyzer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/ner_model_configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Configuring The NLP engine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/encrypt_decrypt/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Encrypting and Decrypting identified entities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/getting_entity_values/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Getting the identified entity value using a custom Operator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/Anonymizing%20known%20values/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Anonymizing known values
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/keep_entities/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Keeping some entities from being anonymized
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/integrating_with_external_services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrating with external services
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/microsoft/presidio/blob/main/docs/samples/python/example_remote_recognizer.py" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Remote Recognizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/text_analytics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Azure AI Language as a Remote Recognizer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/microsoft/presidio/blob/main/docs/samples/python/flair_recognizer.py" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Flair as an external PII model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/microsoft/presidio/blob/main/docs/samples/python/span_marker_recognizer.py" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Span Marker as an external PII model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/transformers_recognizer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Transformers as an external PII model
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/pseudonymization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pseudonymization (replace PII values using mappings)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/microsoft/presidio/blob/main/docs/samples/python/example_custom_lambda_anonymizer.py" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Passing a lambda as a Presidio anonymizer using Faker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/synth_data_with_openai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Synthetic data generation with OpenAI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/no_code_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    YAML based no-code configuration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_3" >
        
          
          <label class="md-nav__link" for="__nav_5_1_3" id="__nav_5_1_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_3">
            <span class="md-nav__icon md-icon"></span>
            Data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/batch_processing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analyzing structured / semi-structured data in batch
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/example_structured/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presidio Structured Basic Usage Notebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/microsoft/presidio/blob/main/docs/samples/python/process_csv_file.py" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analyze and Anonymize CSV file
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_4" >
        
          
          <label class="md-nav__link" for="__nav_5_1_4" id="__nav_5_1_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Images
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_4">
            <span class="md-nav__icon md-icon"></span>
            Images
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/example_dicom_image_redactor/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redacting Text PII from DICOM images
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/image_redaction_allow_list_approach/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using an allow list with image redaction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/plot_custom_bboxes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plot custom bounding boxes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/example_dicom_redactor_evaluation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example DICOM redaction evaluation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_5" >
        
          
          <label class="md-nav__link" for="__nav_5_1_5" id="__nav_5_1_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    PDF
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_5">
            <span class="md-nav__icon md-icon"></span>
            PDF
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/example_pdf_annotation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Annotating PII in a PDF
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_6" >
        
          
          <label class="md-nav__link" for="__nav_5_1_6" id="__nav_5_1_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_6">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/deployments/app-service/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presidio with App Service
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/deployments/k8s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presidio with Kubernetes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/deployments/spark/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Presidio with Spark
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_6_4" >
        
          
          <label class="md-nav__link" for="__nav_5_1_6_4" id="__nav_5_1_6_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Azure Data Factory
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_5_1_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_6_4">
            <span class="md-nav__icon md-icon"></span>
            Azure Data Factory
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/deployments/data-factory/presidio-data-factory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ETL using AppService/Databricks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/deployments/data-factory/presidio-data-factory-template-gallery-http/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add Presidio as an HTTP service to your Azure Data Factory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/deployments/data-factory/presidio-data-factory-template-gallery-databricks/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add Presidio on Databricks to your Azure Data Factory
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/docker/litellm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PII Masking LLM calls using LiteLLM proxy
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1_7" >
        
          
          <label class="md-nav__link" for="__nav_5_1_7" id="__nav_5_1_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Demo
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1_7">
            <span class="md-nav__icon md-icon"></span>
            Demo
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../samples/python/streamlit/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create a simple demo app using Streamlit
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#presidio_image_redactor" class="md-nav__link">
    <span class="md-ellipsis">
      presidio_image_redactor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="presidio_image_redactor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine" class="md-nav__link">
    <span class="md-ellipsis">
      image_processing_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_processing_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImagePreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.BilateralFilter" class="md-nav__link">
    <span class="md-ellipsis">
      BilateralFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BilateralFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.BilateralFilter.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.BilateralFilter.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentedAdaptiveThreshold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SegmentedAdaptiveThreshold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImageRescaling" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRescaling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRescaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImageRescaling.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ImageRescaling.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer" class="md-nav__link">
    <span class="md-ellipsis">
      ContrastSegmentedImageEnhancer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContrastSegmentedImageEnhancer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine" class="md-nav__link">
    <span class="md-ellipsis">
      dicom_image_redactor_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dicom_image_redactor_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine" class="md-nav__link">
    <span class="md-ellipsis">
      DicomImageRedactorEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DicomImageRedactorEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_and_return_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      redact_and_return_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.augment_word" class="md-nav__link">
    <span class="md-ellipsis">
      augment_word
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.tesseract_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      tesseract_ocr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="tesseract_ocr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.tesseract_ocr.TesseractOCR" class="md-nav__link">
    <span class="md-ellipsis">
      TesseractOCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TesseractOCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.tesseract_ocr.TesseractOCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.tesseract_ocr.TesseractOCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine" class="md-nav__link">
    <span class="md-ellipsis">
      dicom_image_pii_verify_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dicom_image_pii_verify_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine" class="md-nav__link">
    <span class="md-ellipsis">
      DicomImagePiiVerifyEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DicomImagePiiVerifyEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_and_return_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      redact_and_return_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.augment_word" class="md-nav__link">
    <span class="md-ellipsis">
      augment_word
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify_dicom_instance" class="md-nav__link">
    <span class="md-ellipsis">
      verify_dicom_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.eval_dicom_instance" class="md-nav__link">
    <span class="md-ellipsis">
      eval_dicom_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_precision" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_precision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_recall" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_recall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox" class="md-nav__link">
    <span class="md-ellipsis">
      bbox
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bbox">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BboxProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BboxProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_ocr_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_bboxes_from_ocr_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_analyzer_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_bboxes_from_analyzer_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor.remove_bbox_padding" class="md-nav__link">
    <span class="md-ellipsis">
      remove_bbox_padding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.bbox.BboxProcessor.match_with_source" class="md-nav__link">
    <span class="md-ellipsis">
      match_with_source
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ocr" class="md-nav__link">
    <span class="md-ellipsis">
      ocr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ocr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ocr.OCR" class="md-nav__link">
    <span class="md-ellipsis">
      OCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ocr.OCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ocr.OCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_redactor_engine" class="md-nav__link">
    <span class="md-ellipsis">
      image_redactor_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_redactor_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_redactor_engine.ImageRedactorEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRedactorEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRedactorEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_redactor_engine.ImageRedactorEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine" class="md-nav__link">
    <span class="md-ellipsis">
      image_analyzer_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_analyzer_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImageAnalyzerEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageAnalyzerEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.analyze" class="md-nav__link">
    <span class="md-ellipsis">
      analyze
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.threshold_ocr_result" class="md-nav__link">
    <span class="md-ellipsis">
      threshold_ocr_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.remove_space_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      remove_space_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      map_analyzer_results_to_bounding_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.fig2img" class="md-nav__link">
    <span class="md-ellipsis">
      fig2img
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.get_pii_bboxes" class="md-nav__link">
    <span class="md-ellipsis">
      get_pii_bboxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.add_custom_bboxes" class="md-nav__link">
    <span class="md-ellipsis">
      add_custom_bboxes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      document_intelligence_ocr
    </span>
  </a>
  
    <nav class="md-nav" aria-label="document_intelligence_ocr">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentIntelligenceOCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentIntelligenceOCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_imgbytes" class="md-nav__link">
    <span class="md-ellipsis">
      get_imgbytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.analyze_document" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine" class="md-nav__link">
    <span class="md-ellipsis">
      image_pii_verify_engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_pii_verify_engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine.fig2img" class="md-nav__link">
    <span class="md-ellipsis">
      fig2img
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePiiVerifyEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImagePiiVerifyEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities" class="md-nav__link">
    <span class="md-ellipsis">
      entities
    </span>
  </a>
  
    <nav class="md-nav" aria-label="entities">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result" class="md-nav__link">
    <span class="md-ellipsis">
      image_recognizer_result
    </span>
  </a>
  
    <nav class="md-nav" aria-label="image_recognizer_result">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRecognizerResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRecognizerResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.append_analysis_explanation_text" class="md-nav__link">
    <span class="md-ellipsis">
      append_analysis_explanation_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.from_json" class="md-nav__link">
    <span class="md-ellipsis">
      from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.intersects" class="md-nav__link">
    <span class="md-ellipsis">
      intersects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contained_in" class="md-nav__link">
    <span class="md-ellipsis">
      contained_in
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contains" class="md-nav__link">
    <span class="md-ellipsis">
      contains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.equal_indices" class="md-nav__link">
    <span class="md-ellipsis">
      equal_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.has_conflict" class="md-nav__link">
    <span class="md-ellipsis">
      has_conflict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.api_request_convertor" class="md-nav__link">
    <span class="md-ellipsis">
      api_request_convertor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="api_request_convertor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.api_request_convertor.get_json_data" class="md-nav__link">
    <span class="md-ellipsis">
      get_json_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.api_request_convertor.color_fill_string_to_value" class="md-nav__link">
    <span class="md-ellipsis">
      color_fill_string_to_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.api_request_convertor.image_to_byte_array" class="md-nav__link">
    <span class="md-ellipsis">
      image_to_byte_array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.invalid_exception" class="md-nav__link">
    <span class="md-ellipsis">
      invalid_exception
    </span>
  </a>
  
    <nav class="md-nav" aria-label="invalid_exception">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.invalid_exception.InvalidParamError" class="md-nav__link">
    <span class="md-ellipsis">
      InvalidParamError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRecognizerResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRecognizerResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.append_analysis_explanation_text" class="md-nav__link">
    <span class="md-ellipsis">
      append_analysis_explanation_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      to_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.from_json" class="md-nav__link">
    <span class="md-ellipsis">
      from_json
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.intersects" class="md-nav__link">
    <span class="md-ellipsis">
      intersects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.contained_in" class="md-nav__link">
    <span class="md-ellipsis">
      contained_in
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.contains" class="md-nav__link">
    <span class="md-ellipsis">
      contains
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.equal_indices" class="md-nav__link">
    <span class="md-ellipsis">
      equal_indices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.ImageRecognizerResult.has_conflict" class="md-nav__link">
    <span class="md-ellipsis">
      has_conflict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.entities.InvalidParamError" class="md-nav__link">
    <span class="md-ellipsis">
      InvalidParamError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.OCR" class="md-nav__link">
    <span class="md-ellipsis">
      OCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="OCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.OCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.OCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.TesseractOCR" class="md-nav__link">
    <span class="md-ellipsis">
      TesseractOCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TesseractOCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.TesseractOCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.TesseractOCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR" class="md-nav__link">
    <span class="md-ellipsis">
      DocumentIntelligenceOCR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DocumentIntelligenceOCR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR.get_text_from_ocr_dict" class="md-nav__link">
    <span class="md-ellipsis">
      get_text_from_ocr_dict
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR.get_imgbytes" class="md-nav__link">
    <span class="md-ellipsis">
      get_imgbytes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR.analyze_document" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_document
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DocumentIntelligenceOCR.perform_ocr" class="md-nav__link">
    <span class="md-ellipsis">
      perform_ocr
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor" class="md-nav__link">
    <span class="md-ellipsis">
      BboxProcessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BboxProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor.get_bboxes_from_ocr_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_bboxes_from_ocr_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor.get_bboxes_from_analyzer_results" class="md-nav__link">
    <span class="md-ellipsis">
      get_bboxes_from_analyzer_results
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor.remove_bbox_padding" class="md-nav__link">
    <span class="md-ellipsis">
      remove_bbox_padding
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BboxProcessor.match_with_source" class="md-nav__link">
    <span class="md-ellipsis">
      match_with_source
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePreprocessor" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePreprocessor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImagePreprocessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePreprocessor.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePreprocessor.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImageAnalyzerEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageAnalyzerEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.analyze" class="md-nav__link">
    <span class="md-ellipsis">
      analyze
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.threshold_ocr_result" class="md-nav__link">
    <span class="md-ellipsis">
      threshold_ocr_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.remove_space_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      remove_space_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes" class="md-nav__link">
    <span class="md-ellipsis">
      map_analyzer_results_to_bounding_boxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.fig2img" class="md-nav__link">
    <span class="md-ellipsis">
      fig2img
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.get_pii_bboxes" class="md-nav__link">
    <span class="md-ellipsis">
      get_pii_bboxes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageAnalyzerEngine.add_custom_bboxes" class="md-nav__link">
    <span class="md-ellipsis">
      add_custom_bboxes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRedactorEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRedactorEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRedactorEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRedactorEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePiiVerifyEngine" class="md-nav__link">
    <span class="md-ellipsis">
      ImagePiiVerifyEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImagePiiVerifyEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePiiVerifyEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImagePiiVerifyEngine.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine" class="md-nav__link">
    <span class="md-ellipsis">
      DicomImageRedactorEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DicomImageRedactorEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.redact_and_return_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      redact_and_return_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.redact_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.redact_from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImageRedactorEngine.augment_word" class="md-nav__link">
    <span class="md-ellipsis">
      augment_word
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine" class="md-nav__link">
    <span class="md-ellipsis">
      DicomImagePiiVerifyEngine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DicomImagePiiVerifyEngine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact" class="md-nav__link">
    <span class="md-ellipsis">
      redact
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact_and_return_bbox" class="md-nav__link">
    <span class="md-ellipsis">
      redact_and_return_bbox
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_directory" class="md-nav__link">
    <span class="md-ellipsis">
      redact_from_directory
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.augment_word" class="md-nav__link">
    <span class="md-ellipsis">
      augment_word
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.verify" class="md-nav__link">
    <span class="md-ellipsis">
      verify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.verify_dicom_instance" class="md-nav__link">
    <span class="md-ellipsis">
      verify_dicom_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.eval_dicom_instance" class="md-nav__link">
    <span class="md-ellipsis">
      eval_dicom_instance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_precision" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_precision
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_recall" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_recall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ContrastSegmentedImageEnhancer" class="md-nav__link">
    <span class="md-ellipsis">
      ContrastSegmentedImageEnhancer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ContrastSegmentedImageEnhancer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ContrastSegmentedImageEnhancer.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ContrastSegmentedImageEnhancer.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BilateralFilter" class="md-nav__link">
    <span class="md-ellipsis">
      BilateralFilter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BilateralFilter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BilateralFilter.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.BilateralFilter.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.SegmentedAdaptiveThreshold" class="md-nav__link">
    <span class="md-ellipsis">
      SegmentedAdaptiveThreshold
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SegmentedAdaptiveThreshold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.SegmentedAdaptiveThreshold.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.SegmentedAdaptiveThreshold.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRescaling" class="md-nav__link">
    <span class="md-ellipsis">
      ImageRescaling
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ImageRescaling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRescaling.convert_image_to_array" class="md-nav__link">
    <span class="md-ellipsis">
      convert_image_to_array
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#presidio_image_redactor.ImageRescaling.preprocess_image" class="md-nav__link">
    <span class="md-ellipsis">
      preprocess_image
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  


<h1 id="presidio-image-redactor-api-reference">Presidio Image Redactor API Reference</h1>


<div class="doc doc-object doc-module">



<h2 id="presidio_image_redactor" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">presidio_image_redactor</span>


</h2>

    <div class="doc doc-contents first">

        <p>Image Redactor root module.</p>









  <div class="doc doc-children">







<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.image_processing_engine" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">image_processing_engine</span>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">







<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.image_processing_engine.ImagePreprocessor" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImagePreprocessor</span>


</h4>


    <div class="doc doc-contents ">


        <p>ImagePreprocessor class.</p>
<p>Parent class for image preprocessing objects.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor.preprocess_image" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image to be analyzed.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor.convert_image_to_array" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImagePreprocessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImagePreprocessor class.</span>

<span class="sd">    Parent class for image preprocessing objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ImagePreprocessor class.</span>

<span class="sd">        :param use_greyscale: Whether to convert the image to greyscale.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span> <span class="o">=</span> <span class="n">use_greyscale</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and any metadata regarding the</span>
<span class="sd">             preprocessing approach.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">        :param image: Loaded PIL image.</span>
<span class="sd">        :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">        :return: image pixels as a numpy array.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_bg_color</span><span class="p">(</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select most common color as background color.</span>

<span class="sd">        :param image: Loaded PIL image.</span>
<span class="sd">        :param is_greyscale: Whether the image is greyscale.</span>
<span class="sd">        :param invert: TRUE if you want to get the inverse of the bg color.</span>

<span class="sd">        :return: Background color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Invert colors if invert flag is True</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;RGBA&quot;</span><span class="p">:</span>
                <span class="c1"># Handle transparency as needed</span>
                <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">rgb_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">inverted_image</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">ImageOps</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">rgb_image</span><span class="p">)</span>
                <span class="n">r2</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">inverted_image</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">ImageOps</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Get background color</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="c1"># Select most common color as color</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">argmax</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Reduce size of image to 1 pixel to get dominant color</span>
            <span class="n">tmp_image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tmp_image</span> <span class="o">=</span> <span class="n">tmp_image</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">resample</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="n">tmp_image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">bg_color</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the contrast level and mean intensity of an image.</span>

<span class="sd">        :param image: Input image pixels (as a numpy array).</span>

<span class="sd">        :return: A tuple containing the contrast level and mean intensity of the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contrast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">mean_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrast</span><span class="p">,</span> <span class="n">mean_intensity</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.ImagePreprocessor.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image to be analyzed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and any metadata regarding the preprocessing approach.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and any metadata regarding the</span>
<span class="sd">         preprocessing approach.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.ImagePreprocessor.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.image_processing_engine.BilateralFilter" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">BilateralFilter</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor">ImagePreprocessor</a></code></p>


        <p>BilateralFilter class.</p>
<p>The class applies bilateral filtering to an image. and returns the filtered
  image and metadata.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.BilateralFilter.convert_image_to_array" href="#presidio_image_redactor.image_processing_engine.BilateralFilter.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.BilateralFilter.preprocess_image" href="#presidio_image_redactor.image_processing_engine.BilateralFilter.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image to be analyzed.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BilateralFilter</span><span class="p">(</span><span class="n">ImagePreprocessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;BilateralFilter class.</span>

<span class="sd">    The class applies bilateral filtering to an image. and returns the filtered</span>
<span class="sd">      image and metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">diameter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sigma_color</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">sigma_space</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the BilateralFilter class.</span>

<span class="sd">        :param diameter: Diameter of each pixel neighborhood.</span>
<span class="sd">        :param sigma_color: value of sigma in the color space.</span>
<span class="sd">        :param sigma_space: value of sigma in the coordinate space.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">use_greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span> <span class="o">=</span> <span class="n">diameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span> <span class="o">=</span> <span class="n">sigma_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span> <span class="o">=</span> <span class="n">sigma_space</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and metadata (diameter, sigma_color, sigma_space).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Apply bilateral filtering</span>
        <span class="n">filtered_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bilateralFilter</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span>
            <span class="s2">&quot;sigma_color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span><span class="p">,</span>
            <span class="s2">&quot;sigma_space&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.BilateralFilter.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.BilateralFilter.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image to be analyzed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and metadata (diameter, sigma_color, sigma_space).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and metadata (diameter, sigma_color, sigma_space).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Apply bilateral filtering</span>
    <span class="n">filtered_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bilateralFilter</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span>
        <span class="s2">&quot;sigma_color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span><span class="p">,</span>
        <span class="s2">&quot;sigma_space&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SegmentedAdaptiveThreshold</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor">ImagePreprocessor</a></code></p>


        <p>SegmentedAdaptiveThreshold class.</p>
<p>The class applies adaptive thresholding to an image
and returns the thresholded image and metadata.
The parameters used to run the adaptivethresholding are selected based on
the contrast level of the image.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.convert_image_to_array" href="#presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.preprocess_image" href="#presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SegmentedAdaptiveThreshold</span><span class="p">(</span><span class="n">ImagePreprocessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SegmentedAdaptiveThreshold class.</span>

<span class="sd">    The class applies adaptive thresholding to an image</span>
<span class="sd">    and returns the thresholded image and metadata.</span>
<span class="sd">    The parameters used to run the adaptivethresholding are selected based on</span>
<span class="sd">    the contrast level of the image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">block_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">contrast_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">c_low_contrast</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">c_high_contrast</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">bg_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">122</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the SegmentedAdaptiveThreshold class.</span>

<span class="sd">        :param block_size: Size of the neighborhood area for threshold calculation.</span>
<span class="sd">        :param contrast_threshold: Threshold for low contrast images.</span>
<span class="sd">        :param C_low_contrast: Constant added to the mean for low contrast images.</span>
<span class="sd">        :param C_high_contrast: Constant added to the mean for high contrast images.</span>
<span class="sd">        :param bg_threshold: Threshold for background color.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">use_greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="n">block_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_low_contrast</span> <span class="o">=</span> <span class="n">c_low_contrast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_high_contrast</span> <span class="o">=</span> <span class="n">c_high_contrast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bg_threshold</span> <span class="o">=</span> <span class="n">bg_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contrast_threshold</span> <span class="o">=</span> <span class="n">contrast_threshold</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and metadata (C, background_color, contrast).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Determine background color</span>
        <span class="n">background_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bg_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">contrast</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_low_contrast</span>
            <span class="k">if</span> <span class="n">contrast</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast_threshold</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_high_contrast</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">background_color</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bg_threshold</span><span class="p">:</span>
            <span class="n">adaptive_threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="mi">255</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_MEAN_C</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY_INV</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
                <span class="o">-</span><span class="n">c</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adaptive_threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="mi">255</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_MEAN_C</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
                <span class="n">c</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="s2">&quot;background_color&quot;</span><span class="p">:</span> <span class="n">background_color</span><span class="p">,</span> <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="n">contrast</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">adaptive_threshold_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.SegmentedAdaptiveThreshold.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="PIL.Image.Image">Image</span>, <span title="numpy.ndarray">ndarray</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and metadata (C, background_color, contrast).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and metadata (C, background_color, contrast).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Determine background color</span>
    <span class="n">background_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bg_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">contrast</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_low_contrast</span>
        <span class="k">if</span> <span class="n">contrast</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast_threshold</span>
        <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_high_contrast</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">background_color</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bg_threshold</span><span class="p">:</span>
        <span class="n">adaptive_threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_MEAN_C</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY_INV</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
            <span class="o">-</span><span class="n">c</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">adaptive_threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_MEAN_C</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
            <span class="n">c</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="s2">&quot;background_color&quot;</span><span class="p">:</span> <span class="n">background_color</span><span class="p">,</span> <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="n">contrast</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">adaptive_threshold_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.image_processing_engine.ImageRescaling" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImageRescaling</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor">ImagePreprocessor</a></code></p>


        <p>ImageRescaling class. Rescales images based on their size.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImageRescaling.convert_image_to_array" href="#presidio_image_redactor.image_processing_engine.ImageRescaling.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImageRescaling.preprocess_image" href="#presidio_image_redactor.image_processing_engine.ImageRescaling.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image to be analyzed.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageRescaling</span><span class="p">(</span><span class="n">ImagePreprocessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImageRescaling class. Rescales images based on their size.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">small_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1048576</span><span class="p">,</span>
        <span class="n">large_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4000000</span><span class="p">,</span>
        <span class="n">factor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ImageRescaling class.</span>

<span class="sd">        :param small_size: Threshold for small image size.</span>
<span class="sd">        :param large_size: Threshold for large image size.</span>
<span class="sd">        :param factor: Scaling factor for resizing.</span>
<span class="sd">        :param interpolation: Interpolation method for resizing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">use_greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">small_size</span> <span class="o">=</span> <span class="n">small_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">large_size</span> <span class="o">=</span> <span class="n">large_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and metadata (scale_factor).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">small_size</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
        <span class="k">elif</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">large_size</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>

        <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="c1"># resize image</span>
        <span class="n">rescaled_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">:</span> <span class="n">scale_factor</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">rescaled_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.ImageRescaling.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.ImageRescaling.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image to be analyzed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and metadata (scale_factor).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and metadata (scale_factor).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">small_size</span><span class="p">:</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
    <span class="k">elif</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">large_size</span><span class="p">:</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>

    <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
    <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

    <span class="c1"># resize image</span>
    <span class="n">rescaled_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">)</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">:</span> <span class="n">scale_factor</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">rescaled_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ContrastSegmentedImageEnhancer</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor">ImagePreprocessor</a></code></p>


        <p>Class containing all logic to perform contrastive segmentation.</p>
<p>Contrastive segmentation is a preprocessing step that aims to enhance the
text in an image by increasing the contrast between the text and the
background. The parameters used to run the preprocessing are selected based
on the contrast level of the image.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.convert_image_to_array" href="#presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.preprocess_image" href="#presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image to be analyzed.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ContrastSegmentedImageEnhancer</span><span class="p">(</span><span class="n">ImagePreprocessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing all logic to perform contrastive segmentation.</span>

<span class="sd">    Contrastive segmentation is a preprocessing step that aims to enhance the</span>
<span class="sd">    text in an image by increasing the contrast between the text and the</span>
<span class="sd">    background. The parameters used to run the preprocessing are selected based</span>
<span class="sd">    on the contrast level of the image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bilateral_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BilateralFilter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">adaptive_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SegmentedAdaptiveThreshold</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">image_rescaling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageRescaling</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">low_contrast_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the class.</span>

<span class="sd">        :param bilateral_filter: Optional BilateralFilter instance.</span>
<span class="sd">        :param adaptive_threshold: Optional AdaptiveThreshold instance.</span>
<span class="sd">        :param image_rescaling: Optional ImageRescaling instance.</span>
<span class="sd">        :param low_contrast_threshold: Threshold for low contrast images.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">use_greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bilateral_filter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bilateral_filter</span> <span class="o">=</span> <span class="n">BilateralFilter</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bilateral_filter</span> <span class="o">=</span> <span class="n">bilateral_filter</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">adaptive_threshold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_threshold</span> <span class="o">=</span> <span class="n">SegmentedAdaptiveThreshold</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_threshold</span> <span class="o">=</span> <span class="n">adaptive_threshold</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_rescaling</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_rescaling</span> <span class="o">=</span> <span class="n">ImageRescaling</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_rescaling</span> <span class="o">=</span> <span class="n">image_rescaling</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">low_contrast_threshold</span> <span class="o">=</span> <span class="n">low_contrast_threshold</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and metadata (background color, scale percentage,</span>
<span class="sd">             contrast level, and C value).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Apply bilateral filtering</span>
        <span class="n">filtered_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bilateral_filter</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Convert to grayscale</span>
        <span class="n">pil_filtered_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">))</span>
        <span class="n">pil_grayscale_image</span> <span class="o">=</span> <span class="n">pil_filtered_image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">grayscale_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pil_grayscale_image</span><span class="p">)</span>

        <span class="c1"># Improve contrast</span>
        <span class="n">adjusted_image</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">adjusted_contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_improve_contrast</span><span class="p">(</span><span class="n">grayscale_image</span><span class="p">)</span>

        <span class="c1"># Adaptive Thresholding</span>
        <span class="n">adaptive_threshold_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_threshold</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span>
            <span class="n">adjusted_image</span>
        <span class="p">)</span>
        <span class="c1"># Increase contrast</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">adaptive_threshold_image</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">|</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Rescale image</span>
        <span class="n">rescaled_image</span><span class="p">,</span> <span class="n">scale_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_rescaling</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span>
            <span class="n">threshold_image</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">rescaled_image</span><span class="p">,</span> <span class="n">scale_metadata</span>

    <span class="k">def</span> <span class="nf">_improve_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Improve the contrast of an image based on its initial contrast level.</span>

<span class="sd">        :param image: Input image.</span>

<span class="sd">        :return: A tuple containing the improved image, the initial contrast level,</span>
<span class="sd">             and the adjusted contrast level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contrast</span><span class="p">,</span> <span class="n">mean_intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">contrast</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_contrast_threshold</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="o">-</span><span class="n">mean_intensity</span> <span class="o">*</span> <span class="n">alpha</span>
            <span class="n">adjusted_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convertScaleAbs</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
            <span class="n">adjusted_contrast</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_contrast</span><span class="p">(</span><span class="n">adjusted_image</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjusted_image</span> <span class="o">=</span> <span class="n">image</span>
            <span class="n">adjusted_contrast</span> <span class="o">=</span> <span class="n">contrast</span>
        <span class="k">return</span> <span class="n">adjusted_image</span><span class="p">,</span> <span class="n">contrast</span><span class="p">,</span> <span class="n">adjusted_contrast</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_processing_engine.ContrastSegmentedImageEnhancer.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image to be analyzed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and metadata (background color, scale percentage, contrast level, and C value).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and metadata (background color, scale percentage,</span>
<span class="sd">         contrast level, and C value).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Apply bilateral filtering</span>
    <span class="n">filtered_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bilateral_filter</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Convert to grayscale</span>
    <span class="n">pil_filtered_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">))</span>
    <span class="n">pil_grayscale_image</span> <span class="o">=</span> <span class="n">pil_filtered_image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
    <span class="n">grayscale_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pil_grayscale_image</span><span class="p">)</span>

    <span class="c1"># Improve contrast</span>
    <span class="n">adjusted_image</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">adjusted_contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_improve_contrast</span><span class="p">(</span><span class="n">grayscale_image</span><span class="p">)</span>

    <span class="c1"># Adaptive Thresholding</span>
    <span class="n">adaptive_threshold_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_threshold</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span>
        <span class="n">adjusted_image</span>
    <span class="p">)</span>
    <span class="c1"># Increase contrast</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">adaptive_threshold_image</span><span class="p">),</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">255</span><span class="p">,</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">|</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Rescale image</span>
    <span class="n">rescaled_image</span><span class="p">,</span> <span class="n">scale_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_rescaling</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span>
        <span class="n">threshold_image</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rescaled_image</span><span class="p">,</span> <span class="n">scale_metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.dicom_image_redactor_engine" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">dicom_image_redactor_engine</span>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">























<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DicomImageRedactorEngine</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageRedactorEngine" href="#presidio_image_redactor.ImageRedactorEngine">ImageRedactorEngine</a></code></p>


        <p>Performs OCR + PII detection + bounding box redaction.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_analyzer_engine</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Engine which performs OCR + PII detection.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine" href="#presidio_image_redactor.ImageAnalyzerEngine">ImageAnalyzerEngine</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_and_return_bbox" href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_and_return_bbox">redact_and_return_bbox</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given DICOM image and return redacted bboxes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact" href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact">redact</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given DICOM image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_file" href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_file">redact_from_file</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact from a given file.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_directory" href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_directory">redact_from_directory</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact from a directory of files.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.augment_word" href="#presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.augment_word">augment_word</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Apply multiple types of casing to the provided string.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DicomImageRedactorEngine</span><span class="p">(</span><span class="n">ImageRedactorEngine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs OCR + PII detection + bounding box redaction.</span>

<span class="sd">    :param image_analyzer_engine: Engine which performs OCR + PII detection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">redact_and_return_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image and return redacted bboxes.</span>

<span class="sd">        Please note, this method duplicates the image, creates a</span>
<span class="sd">        new instance and manipulates it.</span>

<span class="sd">        :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">        :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: DICOM instance with redacted pixel data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check input</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The provided image must be a loaded DICOM instance.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">image</span><span class="o">.</span><span class="n">PixelData</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided DICOM instance lacks pixel data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to access pixel data (may not exist): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IsADirectoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IsADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DICOM instance is a directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Load image for processing</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
            <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
            <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
            <span class="n">image_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

            <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Redact all bounding boxes from DICOM file</span>
        <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">remove_bbox_padding</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>
        <span class="n">redacted_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_redact_box</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redacted_image</span><span class="p">,</span> <span class="n">bboxes</span>

    <span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image.</span>

<span class="sd">        Please note, this method duplicates the image, creates a</span>
<span class="sd">        new instance and manipulates it.</span>

<span class="sd">        :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">        :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: DICOM instance with redacted pixel data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">redacted_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redact_and_return_bbox</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
            <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
            <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">redacted_image</span>

    <span class="k">def</span> <span class="nf">redact_from_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a given file.</span>

<span class="sd">        Please notice, this method duplicates the file, creates</span>
<span class="sd">        new instance and manipulate them.</span>

<span class="sd">        :param input_dicom_path: String path to DICOM image.</span>
<span class="sd">        :param output_dir: String path to parent output directory.</span>
<span class="sd">        :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">        :param fill: Color setting to use for redaction box</span>
<span class="sd">        (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">        :param verbose: True to print where redacted file was written to.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verify the given paths</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be file (not dir)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid file&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Create duplicate</span>
        <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># Process DICOM file</span>
        <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_single_dicom_image</span><span class="p">(</span>
            <span class="n">dcm_path</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
            <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
            <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">redact_from_directory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a directory of files.</span>

<span class="sd">        Please notice, this method duplicates the files, creates</span>
<span class="sd">        new instances and manipulate them.</span>

<span class="sd">        :param input_dicom_path: String path to directory of DICOM images.</span>
<span class="sd">        :param output_dir: String path to parent output directory.</span>
<span class="sd">        :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Color setting to use for redaction box</span>
<span class="sd">        (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verify the given paths</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid directory&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a directory (not file)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Create duplicates</span>
        <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># Process DICOM files</span>
        <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_multiple_dicom_images</span><span class="p">(</span>
            <span class="n">dcm_dir</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
            <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
            <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_all_dcm_files</span><span class="p">(</span><span class="n">dcm_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return paths to all DICOM files in a directory and its sub-directories.</span>

<span class="sd">        :param dcm_dir: pathlib Path to a directory containing at least one .dcm file.</span>

<span class="sd">        :return: List of pathlib Path objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Define applicable extensions</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;[dD][cC][mM]&quot;</span><span class="p">,</span> <span class="s2">&quot;[dD][iI][cC][oO][mM]&quot;</span><span class="p">]</span>

        <span class="c1"># Get all files with any applicable extension</span>
        <span class="n">all_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">dcm_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**/*.</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
            <span class="n">all_files</span> <span class="o">+=</span> <span class="n">files</span>

        <span class="k">return</span> <span class="n">all_files</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a DICOM image is in greyscale.</span>

<span class="sd">        :param instance: A single DICOM instance.</span>

<span class="sd">        :return: FALSE if the Photometric Interpretation is RGB.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if image is grayscale using the Photometric Interpretation element</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">color_scale</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">PhotometricInterpretation</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">color_scale</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="n">color_scale</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;MONOCHROME1&quot;</span><span class="p">,</span> <span class="s2">&quot;MONOCHROME2&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">is_greyscale</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_rescale_dcm_pixel_array</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rescale DICOM pixel_array.</span>

<span class="sd">        :param instance: A singe DICOM instance.</span>
<span class="sd">        :param is_greyscale: FALSE if the Photometric Interpretation is RGB.</span>

<span class="sd">        :return: Rescaled DICOM pixel_array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Normalize contrast</span>
        <span class="k">if</span> <span class="s2">&quot;WindowWidth&quot;</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
                <span class="n">image_2d</span> <span class="o">=</span> <span class="n">apply_voi_lut</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">pixel_array</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image_2d</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">pixel_array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image_2d</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">pixel_array</span>

        <span class="c1"># Convert to float to avoid overflow or underflow losses.</span>
        <span class="n">image_2d_float</span> <span class="o">=</span> <span class="n">image_2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="n">image_2d_scaled</span> <span class="o">=</span> <span class="n">image_2d_float</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Rescaling grey scale between 0-255</span>
            <span class="n">image_2d_scaled</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">image_2d_float</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">image_2d_float</span><span class="p">)</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">image_2d_float</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">image_2d_float</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
            <span class="p">)</span> <span class="o">*</span> <span class="mf">255.0</span>

        <span class="c1"># Convert to uint</span>
        <span class="n">image_2d_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">image_2d_scaled</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image_2d_scaled</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_save_pixel_array_as_png</span><span class="p">(</span>
        <span class="n">pixel_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">output_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;temp_dir&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the pixel data from a loaded DICOM instance as PNG.</span>

<span class="sd">        :param pixel_array: Pixel data from the instance.</span>
<span class="sd">        :param is_greyscale: True if image is greyscale.</span>
<span class="sd">        :param output_file_name: Name of output file (no file extension).</span>
<span class="sd">        :param output_dir: String path to output directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">pixel_array</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Write the PNG file</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">output_file_name</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">png_file</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">png</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">png_file</span><span class="p">,</span> <span class="n">pixel_array</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">output_file_name</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">png_file</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">png</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">greyscale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># Semi-flatten the pixel array to RGB representation in 2D</span>
                <span class="n">pixel_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pixel_array</span><span class="p">,</span> <span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">png_file</span><span class="p">,</span> <span class="n">pixel_array</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_convert_dcm_to_png</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;temp_dir&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert DICOM image to PNG file.</span>

<span class="sd">        :param filepath: pathlib Path to a single dcm file.</span>
<span class="sd">        :param output_dir: String path to output directory.</span>

<span class="sd">        :return: Shape of pixel array and if image mode is greyscale.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dcmread</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="c1"># Check if image is grayscale using the Photometric Interpretation element</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="c1"># Rescale pixel array</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Write to PNG file</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">filepath</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">is_greyscale</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_bg_color</span><span class="p">(</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select most common color as background color.</span>

<span class="sd">        :param image: Loaded PIL image.</span>
<span class="sd">        :param colorscale: Colorscale of image (e.g., &#39;grayscale&#39;, &#39;RGB&#39;)</span>
<span class="sd">        :param invert: TRUE if you want to get the inverse of the bg color.</span>

<span class="sd">        :return: Background color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Invert colors if invert flag is True</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;RGBA&quot;</span><span class="p">:</span>
                <span class="c1"># Handle transparency as needed</span>
                <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">rgb_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">inverted_image</span> <span class="o">=</span> <span class="n">ImageOps</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">rgb_image</span><span class="p">)</span>
                <span class="n">r2</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">inverted_image</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">ImageOps</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Get background color</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="c1"># Select most common color as color</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getdata</span><span class="p">()))</span><span class="o">.</span><span class="n">argmax</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Reduce size of image to 1 pixel to get dominant color</span>
            <span class="n">tmp_image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tmp_image</span> <span class="o">=</span> <span class="n">tmp_image</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">resample</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="n">tmp_image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">bg_color</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_array_corners</span><span class="p">(</span><span class="n">pixel_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Crop a pixel array to just return the corners in a single array.</span>

<span class="sd">        :param pixel_array: Numpy array containing the pixel data.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>

<span class="sd">        :return: Cropped input array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">crop_ratio</span> <span class="o">&gt;=</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">crop_ratio</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;crop_ratio must be between 0 and 1&quot;</span><span class="p">)</span>

        <span class="c1"># Set dimensions</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">pixel_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">pixel_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">crop_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">crop_ratio</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">crop_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">crop_ratio</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Get coordinates for corners</span>
        <span class="c1"># (left, top, right, bottom)</span>
        <span class="n">box_top_left</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">crop_width</span><span class="p">,</span> <span class="n">crop_height</span><span class="p">)</span>
        <span class="n">box_top_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">crop_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">crop_height</span><span class="p">)</span>
        <span class="n">box_bottom_left</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">crop_height</span><span class="p">,</span> <span class="n">crop_width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">box_bottom_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">crop_width</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">crop_height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_top_left</span><span class="p">,</span> <span class="n">box_top_right</span><span class="p">,</span> <span class="n">box_bottom_left</span><span class="p">,</span> <span class="n">box_bottom_right</span><span class="p">]</span>

        <span class="c1"># Only keep box pixels</span>
        <span class="n">cropped_pixel_arrays</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">pixel_array</span><span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span>
        <span class="p">]</span>

        <span class="c1"># Combine the cropped pixel arrays</span>
        <span class="n">cropped_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">cropped_pixel_arrays</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cropped_array</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_most_common_pixel_value</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the most common pixel value.</span>

<span class="sd">        :param instance: A singe DICOM instance.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Determines how box color is selected.</span>
<span class="sd">        &#39;contrast&#39; - Masks stand out relative to background.</span>
<span class="sd">        &#39;background&#39; - Masks are same color as background.</span>

<span class="sd">        :return: Most or least common pixel value (depending on fill).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Crop down to just only look at image corners</span>
        <span class="n">cropped_array</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_array_corners</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">pixel_array</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">)</span>

        <span class="c1"># Get flattened pixel array</span>
        <span class="n">flat_pixel_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cropped_array</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="c1"># Get most common value</span>
            <span class="n">values</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">flat_pixel_array</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">flat_pixel_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flat_pixel_array</span><span class="p">)</span>
            <span class="n">common_value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">counts</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Most common pixel value retrieval is only supported for greyscale images at this point.&quot;</span>  <span class="c1"># noqa: E501</span>
            <span class="p">)</span>

        <span class="c1"># Invert color as necessary</span>
        <span class="k">if</span> <span class="n">fill</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">,</span> <span class="s2">&quot;invert&quot;</span><span class="p">,</span> <span class="s2">&quot;inverted&quot;</span><span class="p">,</span> <span class="s2">&quot;inverse&quot;</span><span class="p">]:</span>
            <span class="n">pixel_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">flat_pixel_array</span><span class="p">)</span> <span class="o">-</span> <span class="n">common_value</span>
        <span class="k">elif</span> <span class="n">fill</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;bg&quot;</span><span class="p">]:</span>
            <span class="n">pixel_value</span> <span class="o">=</span> <span class="n">common_value</span>

        <span class="k">return</span> <span class="n">pixel_value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_add_padding</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span>
        <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add border to image using most common color.</span>

<span class="sd">        :param image: Loaded PIL image.</span>
<span class="sd">        :param is_greyscale: Whether image is in grayscale or not.</span>
<span class="sd">        :param padding_width: Pixel width of padding (uniform).</span>

<span class="sd">        :return: PIL image with padding.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check padding width value</span>
        <span class="k">if</span> <span class="n">padding_width</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Enter a positive value for padding&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">padding_width</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Excessive padding width entered. Please use a width under 100 pixels.&quot;</span>  <span class="c1"># noqa: E501</span>
            <span class="p">)</span>

        <span class="c1"># Select most common color as border color</span>
        <span class="n">border_color</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_bg_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>

        <span class="c1"># Add padding</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">padding_width</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">padding_width</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">padding_width</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="n">padding_width</span>

        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>

        <span class="n">new_width</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="n">right</span> <span class="o">+</span> <span class="n">left</span>
        <span class="n">new_height</span> <span class="o">=</span> <span class="n">height</span> <span class="o">+</span> <span class="n">top</span> <span class="o">+</span> <span class="n">bottom</span>

        <span class="n">image_with_padding</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
            <span class="n">image</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="p">(</span><span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span><span class="p">),</span> <span class="n">border_color</span>
        <span class="p">)</span>
        <span class="n">image_with_padding</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">image_with_padding</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_copy_files_for_processing</span><span class="p">(</span><span class="n">src_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dst_parent_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy DICOM files. All processing should be done on the copies.</span>

<span class="sd">        :param src_path: String path to DICOM file or directory containing DICOM files.</span>
<span class="sd">        :param dst_parent_dir: String path to parent directory of output location.</span>

<span class="sd">        :return: Output location of the file(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Identify output path</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span><span class="o">.</span><span class="n">parts</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dst_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dst_parent_dir</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>

        <span class="c1"># Copy file(s)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
                    <span class="s2">&quot;Destination files already exist. Please clear the destination files or specify a different dst_parent_dir.&quot;</span>  <span class="c1"># noqa: E501</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Create the output dir manually if working with a single file</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_path</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dst_path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_text_metadata</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all text metadata from the DICOM image.</span>

<span class="sd">        :param instance: Loaded DICOM instance.</span>

<span class="sd">        :return: List of all the instance&#39;s element values (excluding pixel data),</span>
<span class="sd">        bool for if the element is specified as being a name,</span>
<span class="sd">        bool for if the element is specified as being related to the patient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata_text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">is_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">is_patient</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">:</span>
            <span class="c1"># Save all metadata except the DICOM image itself</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;Pixel Data&quot;</span><span class="p">:</span>
                <span class="c1"># Save the metadata</span>
                <span class="n">metadata_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                <span class="c1"># Track whether this particular element is a name</span>
                <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">is_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">is_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

                <span class="c1"># Track whether this particular element is directly tied to the patient</span>
                <span class="k">if</span> <span class="s2">&quot;patient&quot;</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">is_patient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">is_patient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">metadata_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">is_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">is_patient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">metadata_text</span><span class="p">,</span> <span class="n">is_name</span><span class="p">,</span> <span class="n">is_patient</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply multiple types of casing to the provided string.</span>

<span class="sd">        :param words: String containing the word or term of interest.</span>
<span class="sd">        :param case_sensitive: True if we want to preserve casing.</span>

<span class="sd">        :return: List of the same string with different casings and spacing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="c1"># Replacing separator character with space, if any</span>
            <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">text_no_separator</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
                <span class="n">word_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_no_separator</span><span class="p">)</span>
                <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Capitalize all characters in string</span>
                <span class="n">text_upper</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

                <span class="c1"># Lowercase all characters in string</span>
                <span class="n">text_lower</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="c1"># Capitalize first letter in each part of string</span>
                <span class="n">text_title</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

                <span class="c1"># Append iterations</span>
                <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">text_no_separator</span><span class="p">,</span> <span class="n">text_upper</span><span class="p">,</span> <span class="n">text_lower</span><span class="p">,</span> <span class="n">text_title</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="c1"># Adding each term as a separate item in the list</span>
                <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                        <span class="n">text_upper</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                        <span class="n">text_lower</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                        <span class="n">text_title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>

            <span class="c1"># Flatten list</span>
            <span class="n">flat_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">flat_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="c1"># Remove any duplicates and empty strings</span>
            <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flat_list</span><span class="p">))</span>
            <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">word_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">word_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_process_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">text_metadata</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">is_name</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process names to have multiple iterations in our PHI list.</span>

<span class="sd">        :param metadata_text: List of all the instance&#39;s element values</span>
<span class="sd">        (excluding pixel data).</span>
<span class="sd">        :param is_name: True if the element is specified as being a name.</span>

<span class="sd">        :return: Metadata text with additional name iterations appended.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi_list</span> <span class="o">=</span> <span class="n">text_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_metadata</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">is_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">original_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text_metadata</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">phi_list</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">augment_word</span><span class="p">(</span><span class="n">original_text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">phi_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_add_known_generic_phi</span><span class="p">(</span><span class="n">phi_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add known potential generic PHI values.</span>

<span class="sd">        :param phi_list: List of PHI to use with Presidio ad-hoc recognizer.</span>

<span class="sd">        :return: Same list with added known values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">known_generic_phi</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;[M]&quot;</span><span class="p">,</span> <span class="s2">&quot;[F]&quot;</span><span class="p">,</span> <span class="s2">&quot;[X]&quot;</span><span class="p">,</span> <span class="s2">&quot;[U]&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">]</span>
        <span class="n">phi_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">known_generic_phi</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">phi_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_make_phi_list</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">original_metadata</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">multival</span><span class="o">.</span><span class="n">MultiValue</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]],</span>
        <span class="n">is_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
        <span class="n">is_patient</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make the list of PHI to use in Presidio ad-hoc recognizer.</span>

<span class="sd">        :param original_metadata: List of all the instance&#39;s element values</span>
<span class="sd">        (excluding pixel data).</span>
<span class="sd">        :param is_name: True if the element is specified as being a name.</span>
<span class="sd">        :param is_patient: True if the element is specified as being</span>
<span class="sd">        related to the patient.</span>

<span class="sd">        :return: List of PHI (str) to use with Presidio ad-hoc recognizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Process names</span>
        <span class="n">phi_list</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_process_names</span><span class="p">(</span><span class="n">original_metadata</span><span class="p">,</span> <span class="n">is_name</span><span class="p">)</span>

        <span class="c1"># Add known potential phi values</span>
        <span class="n">phi_list</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_add_known_generic_phi</span><span class="p">(</span><span class="n">phi_list</span><span class="p">)</span>

        <span class="c1"># Flatten any nested lists</span>
        <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">phi_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">multival</span><span class="o">.</span><span class="n">MultiValue</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">:</span>
                    <span class="n">phi_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">phi_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="c1"># Convert all items to strings</span>
        <span class="n">phi_str_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">phi_list</span><span class="p">]</span>

        <span class="c1"># Remove duplicates</span>
        <span class="n">phi_str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">phi_str_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">phi_str_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_set_bbox_color</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the bounding box color.</span>

<span class="sd">        :param instance: A single DICOM instance.</span>
<span class="sd">        :param fill: Determines how box color is selected.</span>
<span class="sd">        &#39;contrast&#39; - Masks stand out relative to background.</span>
<span class="sd">        &#39;background&#39; - Masks are same color as background.</span>

<span class="sd">        :return: int or tuple of int values determining masking box color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if we want the box color to contrast with the background</span>
        <span class="k">if</span> <span class="n">fill</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">,</span> <span class="s2">&quot;invert&quot;</span><span class="p">,</span> <span class="s2">&quot;inverted&quot;</span><span class="p">,</span> <span class="s2">&quot;inverse&quot;</span><span class="p">]:</span>
            <span class="n">invert_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">fill</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;bg&quot;</span><span class="p">]:</span>
            <span class="n">invert_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;fill must be &#39;contrast&#39; or &#39;background&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Temporarily save as PNG to get color</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
            <span class="n">dst_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/temp.dcm&quot;</span><span class="p">)</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">save_as</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_convert_dcm_to_png</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">tmpdirname</span><span class="p">)</span>

            <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dst_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
            <span class="n">box_color</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_bg_color</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">invert_flag</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">box_color</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_if_compressed</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the pixel data is compressed.</span>

<span class="sd">        :param instance: DICOM instance.</span>

<span class="sd">        :return: Boolean for whether the pixel data is compressed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate expected bytes</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">Rows</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">Columns</span>
        <span class="n">samples_per_pixel</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">SamplesPerPixel</span>
        <span class="n">bits_allocated</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">BitsAllocated</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">number_of_frames</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mh">0x0028</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">number_of_frames</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">expected_num_bytes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">rows</span> <span class="o">*</span> <span class="n">columns</span> <span class="o">*</span> <span class="n">number_of_frames</span> <span class="o">*</span> <span class="n">samples_per_pixel</span> <span class="o">*</span> <span class="p">(</span><span class="n">bits_allocated</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Compare expected vs actual</span>
        <span class="n">is_compressed</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">expected_num_bytes</span><span class="p">))</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">PixelData</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">is_compressed</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compress_pixel_data</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recompress pixel data that was decompressed during redaction.</span>

<span class="sd">        :param instance: Loaded DICOM instance.</span>

<span class="sd">        :return: Instance with compressed pixel data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compression_method</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">uid</span><span class="o">.</span><span class="n">RLELossless</span>

        <span class="c1"># Temporarily change syntax to an &quot;uncompressed&quot; method</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">file_meta</span><span class="o">.</span><span class="n">TransferSyntaxUID</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">uid</span><span class="o">.</span><span class="n">UID</span><span class="p">(</span><span class="s2">&quot;1.2.840.10008.1.2&quot;</span><span class="p">)</span>

        <span class="c1"># Compress and update syntax</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">compression_method</span><span class="p">,</span> <span class="n">encoding_plugin</span><span class="o">=</span><span class="s2">&quot;gdcm&quot;</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">file_meta</span><span class="o">.</span><span class="n">TransferSyntaxUID</span> <span class="o">=</span> <span class="n">compression_method</span>

        <span class="k">return</span> <span class="n">instance</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_if_has_image_icon_sequence</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if there is an image icon sequence tag in the metadata.</span>

<span class="sd">        This leads to pixel data being present in multiple locations.</span>

<span class="sd">        :param instance: DICOM instance.</span>

<span class="sd">        :return: Boolean for whether the instance has an image icon sequence tag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_image_icon_sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mh">0x0088</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">]</span>
            <span class="n">has_image_icon_sequence</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">has_image_icon_sequence</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">has_image_icon_sequence</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_add_redact_box</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">bounding_boxes_coordinates</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add redaction bounding boxes on a DICOM instance.</span>

<span class="sd">        :param instance: A single DICOM instance.</span>
<span class="sd">        :param bounding_boxes_coordinates: Bounding box coordinates.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Determines how box color is selected.</span>
<span class="sd">        &#39;contrast&#39; - Masks stand out relative to background.</span>
<span class="sd">        &#39;background&#39; - Masks are same color as background.</span>

<span class="sd">        :return: A new dicom instance with redaction bounding boxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Copy instance</span>
        <span class="n">redacted_instance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">is_compressed</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_compressed</span><span class="p">(</span><span class="n">redacted_instance</span><span class="p">)</span>
        <span class="n">has_image_icon_sequence</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_has_image_icon_sequence</span><span class="p">(</span>
            <span class="n">redacted_instance</span>
        <span class="p">)</span>

        <span class="c1"># Select masking box color</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="n">box_color</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_most_common_pixel_value</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">box_color</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_set_bbox_color</span><span class="p">(</span><span class="n">redacted_instance</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>

        <span class="c1"># Apply mask</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounding_boxes_coordinates</span><span class="p">)):</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">bounding_boxes_coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
            <span class="n">redacted_instance</span><span class="o">.</span><span class="n">pixel_array</span><span class="p">[</span><span class="n">top</span> <span class="p">:</span> <span class="n">top</span> <span class="o">+</span> <span class="n">height</span><span class="p">,</span> <span class="n">left</span> <span class="p">:</span> <span class="n">left</span> <span class="o">+</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">box_color</span>
            <span class="p">)</span>

        <span class="n">redacted_instance</span><span class="o">.</span><span class="n">PixelData</span> <span class="o">=</span> <span class="n">redacted_instance</span><span class="o">.</span><span class="n">pixel_array</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>

        <span class="c1"># If original pixel data is compressed, recompress after redaction</span>
        <span class="k">if</span> <span class="n">is_compressed</span> <span class="ow">or</span> <span class="n">has_image_icon_sequence</span><span class="p">:</span>
            <span class="c1"># Temporary &quot;fix&quot; to manually set all YBR photometric interp as YBR_FULL</span>
            <span class="k">if</span> <span class="s2">&quot;YBR&quot;</span> <span class="ow">in</span> <span class="n">redacted_instance</span><span class="o">.</span><span class="n">PhotometricInterpretation</span><span class="p">:</span>
                <span class="n">redacted_instance</span><span class="o">.</span><span class="n">PhotometricInterpretation</span> <span class="o">=</span> <span class="s2">&quot;YBR_FULL&quot;</span>
            <span class="n">redacted_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_compress_pixel_data</span><span class="p">(</span><span class="n">redacted_instance</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redacted_instance</span>

    <span class="k">def</span> <span class="nf">_get_analyzer_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]],</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze image with selected redaction approach.</span>

<span class="sd">        :param image: DICOM pixel data as PIL image.</span>
<span class="sd">        :param instance: DICOM instance (with metadata).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine (e.g., allow_list).</span>

<span class="sd">        :return: Analyzer results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check the ad-hoc recognizers list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

        <span class="c1"># Create custom recognizer using DICOM metadata</span>
        <span class="k">if</span> <span class="n">use_metadata</span><span class="p">:</span>
            <span class="n">original_metadata</span><span class="p">,</span> <span class="n">is_name</span><span class="p">,</span> <span class="n">is_patient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text_metadata</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="n">phi_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_phi_list</span><span class="p">(</span><span class="n">original_metadata</span><span class="p">,</span> <span class="n">is_name</span><span class="p">,</span> <span class="n">is_patient</span><span class="p">)</span>
            <span class="n">deny_list_recognizer</span> <span class="o">=</span> <span class="n">PatternRecognizer</span><span class="p">(</span>
                <span class="n">supported_entity</span><span class="o">=</span><span class="s2">&quot;PERSON&quot;</span><span class="p">,</span> <span class="n">deny_list</span><span class="o">=</span><span class="n">phi_list</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ad_hoc_recognizers</span> <span class="o">=</span> <span class="p">[</span><span class="n">deny_list_recognizer</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deny_list_recognizer</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">analyzer_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_save_bbox_json</span><span class="p">(</span><span class="n">output_dcm_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the redacted bounding box info as a json file.</span>

<span class="sd">        :param output_dcm_path: Path to the redacted DICOM file.</span>

<span class="sd">        :param bboxes: Bounding boxes used in redaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_json_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dcm_path</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_json_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">bboxes</span><span class="p">,</span> <span class="n">write_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_redact_single_dicom_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dcm_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact text PHI present on a DICOM image.</span>

<span class="sd">        :param dcm_path: String path to the DICOM file.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Color setting to use for bounding boxes</span>
<span class="sd">        (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param padding_width: Pixel width of padding (uniform).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param overwrite: Only set to True if you are providing the</span>
<span class="sd">        duplicated DICOM path in dcm_path.</span>
<span class="sd">        :param dst_parent_dir: String path to parent directory of where to store copies.</span>
<span class="sd">        :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: Path to the output DICOM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure we are working on a single file</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcm_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Please ensure dcm_path is a single file&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcm_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dcm_path</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="c1"># Copy file before processing if overwrite==False</span>
        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">dcm_path</span><span class="p">,</span> <span class="n">dst_parent_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dst_path</span> <span class="o">=</span> <span class="n">dcm_path</span>

        <span class="c1"># Load instance</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dcmread</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">PixelData</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Provided DICOM file lacks pixel data.&quot;</span><span class="p">)</span>

        <span class="c1"># Load image for processing</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
            <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_dcm_to_png</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">tmpdirname</span><span class="p">)</span>
            <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dst_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Redact all bounding boxes from DICOM file</span>
        <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">remove_bbox_padding</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>
        <span class="n">redacted_dicom_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_redact_box</span><span class="p">(</span>
            <span class="n">instance</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span>
        <span class="p">)</span>
        <span class="n">redacted_dicom_instance</span><span class="o">.</span><span class="n">save_as</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>

        <span class="c1"># Save redacted bboxes</span>
        <span class="k">if</span> <span class="n">save_bboxes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_bbox_json</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dst_path</span>

    <span class="k">def</span> <span class="nf">_redact_multiple_dicom_images</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dcm_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact text PHI present on all DICOM images in a directory.</span>

<span class="sd">        :param dcm_dir: String path to directory containing DICOM files (can be nested).</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Color setting to use for bounding boxes</span>
<span class="sd">        (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param padding_width: Pixel width of padding (uniform).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param overwrite: Only set to True if you are providing</span>
<span class="sd">        the duplicated DICOM dir in dcm_dir.</span>
<span class="sd">        :param dst_parent_dir: String path to parent directory of where to store copies.</span>
<span class="sd">        :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        Return:</span>
<span class="sd">            dst_dir (str): Path to the output DICOM directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure we are working on a directory (can have sub-directories)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcm_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Please ensure dcm_path is a directory&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcm_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dcm_dir</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="c1"># List of files to process directly</span>
        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">dst_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">dcm_dir</span><span class="p">,</span> <span class="n">dst_parent_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dst_dir</span> <span class="o">=</span> <span class="n">dcm_dir</span>

        <span class="c1"># Process each DICOM file directly</span>
        <span class="n">all_dcm_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_dcm_files</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dst_dir</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">dst_path</span> <span class="ow">in</span> <span class="n">all_dcm_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redact_single_dicom_image</span><span class="p">(</span>
                <span class="n">dst_path</span><span class="p">,</span>
                <span class="n">crop_ratio</span><span class="p">,</span>
                <span class="n">fill</span><span class="p">,</span>
                <span class="n">padding_width</span><span class="p">,</span>
                <span class="n">use_metadata</span><span class="p">,</span>
                <span class="n">overwrite</span><span class="p">,</span>
                <span class="n">dst_parent_dir</span><span class="p">,</span>
                <span class="n">save_bboxes</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">dst_dir</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_and_return_bbox" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_and_return_bbox</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_and_return_bbox</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given DICOM image and return redacted bboxes.</p>
<p>Please note, this method duplicates the image, creates a
new instance and manipulates it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Fill setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="pydicom.dataset.FileDataset">FileDataset</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, int]]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>DICOM instance with redacted pixel data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_and_return_bbox</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image and return redacted bboxes.</span>

<span class="sd">    Please note, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulates it.</span>

<span class="sd">    :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: DICOM instance with redacted pixel data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check input</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The provided image must be a loaded DICOM instance.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">image</span><span class="o">.</span><span class="n">PixelData</span>
    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided DICOM instance lacks pixel data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to access pixel data (may not exist): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IsADirectoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IsADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DICOM instance is a directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">instance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Load image for processing</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

        <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Redact all bounding boxes from DICOM file</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">remove_bbox_padding</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>
    <span class="n">redacted_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_redact_box</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">redacted_image</span><span class="p">,</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given DICOM image.</p>
<p>Please note, this method duplicates the image, creates a
new instance and manipulates it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Fill setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>DICOM instance with redacted pixel data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image.</span>

<span class="sd">    Please note, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulates it.</span>

<span class="sd">    :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: DICOM instance with redacted pixel data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">redacted_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redact_and_return_bbox</span><span class="p">(</span>
        <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">redacted_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_from_file</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_from_file</span><span class="p">(</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact from a given file.</p>
<p>Please notice, this method duplicates the file, creates
new instance and manipulate them.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_dicom_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to DICOM image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to parent output directory.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code></code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>padding_width</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Color setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to save boundings boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to print where redacted file was written to.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_from_file</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a given file.</span>

<span class="sd">    Please notice, this method duplicates the file, creates</span>
<span class="sd">    new instance and manipulate them.</span>

<span class="sd">    :param input_dicom_path: String path to DICOM image.</span>
<span class="sd">    :param output_dir: String path to parent output directory.</span>
<span class="sd">    :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">    :param fill: Color setting to use for redaction box</span>
<span class="sd">    (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">    :param verbose: True to print where redacted file was written to.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify the given paths</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be file (not dir)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid file&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create duplicate</span>
    <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

    <span class="c1"># Process DICOM file</span>
    <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_single_dicom_image</span><span class="p">(</span>
        <span class="n">dcm_path</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.redact_from_directory" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_from_directory</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_from_directory</span><span class="p">(</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact from a directory of files.</p>
<p>Please notice, this method duplicates the files, creates
new instances and manipulate them.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_dicom_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to directory of DICOM images.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to parent output directory.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code></code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>padding_width</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Color setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to save boundings boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_from_directory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a directory of files.</span>

<span class="sd">    Please notice, this method duplicates the files, creates</span>
<span class="sd">    new instances and manipulate them.</span>

<span class="sd">    :param input_dicom_path: String path to directory of DICOM images.</span>
<span class="sd">    :param output_dir: String path to parent output directory.</span>
<span class="sd">    :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param fill: Color setting to use for redaction box</span>
<span class="sd">    (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify the given paths</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid directory&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a directory (not file)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create duplicates</span>
    <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

    <span class="c1"># Process DICOM files</span>
    <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_multiple_dicom_images</span><span class="p">(</span>
        <span class="n">dcm_dir</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_redactor_engine.DicomImageRedactorEngine.augment_word" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">augment_word</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply multiple types of casing to the provided string.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>words</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String containing the word or term of interest.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>case_sensitive</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to preserve casing.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>list</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of the same string with different casings and spacing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply multiple types of casing to the provided string.</span>

<span class="sd">    :param words: String containing the word or term of interest.</span>
<span class="sd">    :param case_sensitive: True if we want to preserve casing.</span>

<span class="sd">    :return: List of the same string with different casings and spacing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="c1"># Replacing separator character with space, if any</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_no_separator</span><span class="p">)</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Capitalize all characters in string</span>
            <span class="n">text_upper</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

            <span class="c1"># Lowercase all characters in string</span>
            <span class="n">text_lower</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># Capitalize first letter in each part of string</span>
            <span class="n">text_title</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

            <span class="c1"># Append iterations</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span><span class="n">text_no_separator</span><span class="p">,</span> <span class="n">text_upper</span><span class="p">,</span> <span class="n">text_lower</span><span class="p">,</span> <span class="n">text_title</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Adding each term as a separate item in the list</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_upper</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_lower</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Flatten list</span>
        <span class="n">flat_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">flat_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># Remove any duplicates and empty strings</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flat_list</span><span class="p">))</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">word_list</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">word_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.tesseract_ocr" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">tesseract_ocr</span>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">











<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.tesseract_ocr.TesseractOCR" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">TesseractOCR</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.OCR" href="#presidio_image_redactor.OCR">OCR</a></code></p>


        <p>OCR class that performs OCR on a given image.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.tesseract_ocr.TesseractOCR.get_text_from_ocr_dict" href="#presidio_image_redactor.tesseract_ocr.TesseractOCR.get_text_from_ocr_dict">get_text_from_ocr_dict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Combine the text from the OCR dict to full text.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.tesseract_ocr.TesseractOCR.perform_ocr" href="#presidio_image_redactor.tesseract_ocr.TesseractOCR.perform_ocr">perform_ocr</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Perform OCR on a given image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/tesseract_ocr.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TesseractOCR</span><span class="p">(</span><span class="n">OCR</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OCR class that performs OCR on a given image.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform OCR on a given image.</span>

<span class="sd">        :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">        :param kwargs: Additional values for OCR image_to_data</span>

<span class="sd">        :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_type</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">DICT</span>
        <span class="k">return</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_data</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">output_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.tesseract_ocr.TesseractOCR.get_text_from_ocr_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_text_from_ocr_dict</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Combine the text from the OCR dict to full text.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dictionary containing the ocr results per word</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>separator to use when joining the words  return: str containing the full extracted text as string</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39; &#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the text from the OCR dict to full text.</span>

<span class="sd">    :param ocr_result: dictionary containing the ocr results per word</span>
<span class="sd">    :param separator: separator to use when joining the words</span>

<span class="sd">    return: str containing the full extracted text as string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_result</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.tesseract_ocr.TesseractOCR.perform_ocr" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_ocr</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform OCR on a given image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image/numpy array or file path(str) to be processed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>object</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for OCR image_to_data</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>results dictionary containing bboxes and text for each detected word</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/tesseract_ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform OCR on a given image.</span>

<span class="sd">    :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">    :param kwargs: Additional values for OCR image_to_data</span>

<span class="sd">    :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_type</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">DICT</span>
    <span class="k">return</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_data</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">output_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.dicom_image_pii_verify_engine" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">dicom_image_pii_verify_engine</span>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">



































<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DicomImagePiiVerifyEngine</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImagePiiVerifyEngine" href="#presidio_image_redactor.ImagePiiVerifyEngine">ImagePiiVerifyEngine</a></code>, <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImageRedactorEngine" href="#presidio_image_redactor.DicomImageRedactorEngine">DicomImageRedactorEngine</a></code></p>


        <p>Class to handle verification and evaluation for DICOM de-identification.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact">redact</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given DICOM image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_and_return_bbox" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_and_return_bbox">redact_and_return_bbox</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given DICOM image and return redacted bboxes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_file" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_file">redact_from_file</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact from a given file.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_directory" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_directory">redact_from_directory</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact from a directory of files.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.augment_word" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.augment_word">augment_word</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Apply multiple types of casing to the provided string.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify">verify</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Annotate image with the detect PII entity.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify_dicom_instance" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify_dicom_instance">verify_dicom_instance</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Verify PII on a single DICOM instance.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.eval_dicom_instance" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.eval_dicom_instance">eval_dicom_instance</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Evaluate performance for a single DICOM instance.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_precision" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_precision">calculate_precision</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Calculate precision.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_recall" href="#presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_recall">calculate_recall</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Calculate recall.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DicomImagePiiVerifyEngine</span><span class="p">(</span><span class="n">ImagePiiVerifyEngine</span><span class="p">,</span> <span class="n">DicomImageRedactorEngine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle verification and evaluation for DICOM de-identification.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ocr_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OCR</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">image_analyzer_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageAnalyzerEngine</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize DicomImagePiiVerifyEngine object.</span>

<span class="sd">        :param ocr_engine: OCR engine to use.</span>
<span class="sd">        :param image_analyzer_engine: Image analyzer engine to use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize OCR engine</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_engine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ocr_engine</span> <span class="o">=</span> <span class="n">TesseractOCR</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ocr_engine</span> <span class="o">=</span> <span class="n">ocr_engine</span>

        <span class="c1"># Initialize image analyzer engine</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_analyzer_engine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span> <span class="o">=</span> <span class="n">ImageAnalyzerEngine</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span> <span class="o">=</span> <span class="n">image_analyzer_engine</span>

        <span class="c1"># Initialize bbox processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span> <span class="o">=</span> <span class="n">BboxProcessor</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">verify_dicom_instance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify PII on a single DICOM instance.</span>

<span class="sd">        :param instance: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">        :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">        :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">        :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">        image with bounding boxes.</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in ImageAnalyzerEngine.</span>

<span class="sd">        :return: Image with boxes identifying PHI, OCR results,</span>
<span class="sd">        and analyzer results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">instance_copy</span><span class="o">.</span><span class="n">PixelData</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Provided DICOM instance lacks pixel data.&quot;</span><span class="p">)</span>

        <span class="c1"># Load image for processing</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
            <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
            <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance_copy</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance_copy</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="s2">&quot;tmp_dcm&quot;</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

            <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/tmp_dcm.png&quot;</span>
            <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

        <span class="c1"># Get OCR results</span>
        <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># noqa: E501</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr_engine</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
            <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
                <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
            <span class="p">)</span>
        <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

        <span class="c1"># Get analyzer results</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>

        <span class="c1"># Prepare for plotting</span>
        <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
            <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Get image with verification boxes</span>
        <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">display_image</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">verify_image</span><span class="p">,</span> <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>

    <span class="k">def</span> <span class="nf">eval_dicom_instance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate performance for a single DICOM instance.</span>

<span class="sd">        :param instance: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">        :param ground_truth: Dictionary containing ground truth labels for the instance.</span>
<span class="sd">        :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">        :param tolerance: Pixel distance tolerance for matching to ground truth.</span>
<span class="sd">        :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in ImageAnalyzerEngine.</span>

<span class="sd">        :return: Evaluation comparing redactor engine results vs ground truth.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verify detected PHI</span>
        <span class="n">verify_image</span><span class="p">,</span> <span class="n">ocr_results</span><span class="p">,</span> <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_dicom_instance</span><span class="p">(</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">padding_width</span><span class="p">,</span>
            <span class="n">display_image</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">formatted_ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span>
            <span class="n">ocr_results</span>
        <span class="p">)</span>
        <span class="n">detected_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>

        <span class="c1"># Remove duplicate entities in results</span>
        <span class="n">detected_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicate_entities</span><span class="p">(</span><span class="n">detected_phi</span><span class="p">)</span>

        <span class="c1"># Get correct PHI text (all TP and FP)</span>
        <span class="n">all_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_all_positives</span><span class="p">(</span>
            <span class="n">ground_truth</span><span class="p">,</span> <span class="n">formatted_ocr_results</span><span class="p">,</span> <span class="n">detected_phi</span><span class="p">,</span> <span class="n">tolerance</span>
        <span class="p">)</span>

        <span class="c1"># Calculate evaluation metrics</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_precision</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">)</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_recall</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">)</span>

        <span class="n">eval_results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;all_positives&quot;</span><span class="p">:</span> <span class="n">all_pos</span><span class="p">,</span>
            <span class="s2">&quot;ground_truth&quot;</span><span class="p">:</span> <span class="n">ground_truth</span><span class="p">,</span>
            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">verify_image</span><span class="p">,</span> <span class="n">eval_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_duplicate_entities</span><span class="p">(</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">dup_pix_tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle when a word is detected multiple times as different types of entities.</span>

<span class="sd">        :param results: List of detected PHI with bbox info.</span>
<span class="sd">        :param dup_pix_tolerance: Pixel difference tolerance for identifying duplicates.</span>
<span class="sd">        :return: Detected PHI with no duplicate entities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">results_no_dups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">]</span>

        <span class="c1"># Check for duplicates</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">i_dims</span> <span class="o">=</span> <span class="p">{</span><span class="n">dim</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">}</span>

            <span class="c1"># Ignore if we&#39;ve already detected this dup combination</span>
            <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results_no_dups</span><span class="p">:</span>
                    <span class="n">other_dims</span> <span class="o">=</span> <span class="p">{</span><span class="n">dim</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="n">other</span><span class="p">][</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">}</span>
                    <span class="n">matching_dims</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">dim</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i_dims</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">-</span> <span class="n">other_dims</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">dup_pix_tolerance</span>
                        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span>
                    <span class="p">}</span>
                    <span class="n">matching</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">matching_dims</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">matching</span><span class="p">):</span>
                        <span class="n">lower_scored_index</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">other</span>
                            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="n">other</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
                            <span class="k">else</span> <span class="n">i</span>
                        <span class="p">)</span>
                        <span class="n">dups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lower_scored_index</span><span class="p">)</span>

        <span class="c1"># Remove duplicates</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dups</span><span class="p">:</span>
                <span class="n">results_no_dups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">results_no_dups</span>

    <span class="k">def</span> <span class="nf">_label_all_positives</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gt_labels_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">ocr_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">detected_phi</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Label all entities detected as PHI by using ground truth and OCR results.</span>

<span class="sd">        All positives (detected_phi) do not contain PHI labels and are thus</span>
<span class="sd">        difficult to work with intuitively. This method maps back to the</span>
<span class="sd">        actual PHI to each detected sensitive entity.</span>

<span class="sd">        :param gt_labels_dict: Dictionary with ground truth labels for a</span>
<span class="sd">        single DICOM instance.</span>
<span class="sd">        :param ocr_results: All detected text.</span>
<span class="sd">        :param detected_phi: Formatted analyzer_results.</span>
<span class="sd">        :param tolerance: Tolerance for exact coordinates and size data.</span>
<span class="sd">        :return: List of all positives, labeled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_pos</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Cycle through each positive (TP or FP)</span>
        <span class="k">for</span> <span class="n">analyzer_result</span> <span class="ow">in</span> <span class="n">detected_phi</span><span class="p">:</span>
            <span class="c1"># See if there are any ground truth matches</span>
            <span class="n">all_pos</span><span class="p">,</span> <span class="n">gt_match_found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">match_with_source</span><span class="p">(</span>
                <span class="n">all_pos</span><span class="p">,</span> <span class="n">gt_labels_dict</span><span class="p">,</span> <span class="n">analyzer_result</span><span class="p">,</span> <span class="n">tolerance</span>
            <span class="p">)</span>

            <span class="c1"># If not, check back with OCR</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gt_match_found</span><span class="p">:</span>
                <span class="n">all_pos</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">match_with_source</span><span class="p">(</span>
                    <span class="n">all_pos</span><span class="p">,</span> <span class="n">ocr_results</span><span class="p">,</span> <span class="n">analyzer_result</span><span class="p">,</span> <span class="n">tolerance</span>
                <span class="p">)</span>

        <span class="c1"># Remove any duplicates</span>
        <span class="n">all_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicate_entities</span><span class="p">(</span><span class="n">all_pos</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_pos</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calculate_precision</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate precision.</span>

<span class="sd">        :param gt: List of ground truth labels.</span>
<span class="sd">        :param all_pos: All Detected PHI (mapped back to have actual PHI text).</span>
<span class="sd">        :return: Precision value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find True Positive (TP) and precision</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_pos</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">precision</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calculate_recall</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate recall.</span>

<span class="sd">        :param gt: List of ground truth labels.</span>
<span class="sd">        :param all_pos: All Detected PHI (mapped back to have actual PHI text).</span>
<span class="sd">        :return: Recall value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find True Positive (TP) and precision</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">recall</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">recall</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">recall</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given DICOM image.</p>
<p>Please note, this method duplicates the image, creates a
new instance and manipulates it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Fill setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>DICOM instance with redacted pixel data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image.</span>

<span class="sd">    Please note, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulates it.</span>

<span class="sd">    :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: DICOM instance with redacted pixel data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">redacted_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redact_and_return_bbox</span><span class="p">(</span>
        <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">redacted_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_and_return_bbox" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_and_return_bbox</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_and_return_bbox</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given DICOM image and return redacted bboxes.</p>
<p>Please note, this method duplicates the image, creates a
new instance and manipulates it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Fill setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="pydicom.dataset.FileDataset">FileDataset</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, int]]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>DICOM instance with redacted pixel data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_and_return_bbox</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image and return redacted bboxes.</span>

<span class="sd">    Please note, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulates it.</span>

<span class="sd">    :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: DICOM instance with redacted pixel data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check input</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The provided image must be a loaded DICOM instance.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">image</span><span class="o">.</span><span class="n">PixelData</span>
    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided DICOM instance lacks pixel data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to access pixel data (may not exist): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IsADirectoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IsADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DICOM instance is a directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">instance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Load image for processing</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

        <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Redact all bounding boxes from DICOM file</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">remove_bbox_padding</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>
    <span class="n">redacted_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_redact_box</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">redacted_image</span><span class="p">,</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_from_file</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_from_file</span><span class="p">(</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact from a given file.</p>
<p>Please notice, this method duplicates the file, creates
new instance and manipulate them.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_dicom_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to DICOM image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to parent output directory.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code></code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>padding_width</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Color setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to save boundings boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to print where redacted file was written to.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_from_file</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a given file.</span>

<span class="sd">    Please notice, this method duplicates the file, creates</span>
<span class="sd">    new instance and manipulate them.</span>

<span class="sd">    :param input_dicom_path: String path to DICOM image.</span>
<span class="sd">    :param output_dir: String path to parent output directory.</span>
<span class="sd">    :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">    :param fill: Color setting to use for redaction box</span>
<span class="sd">    (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">    :param verbose: True to print where redacted file was written to.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify the given paths</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be file (not dir)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid file&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create duplicate</span>
    <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

    <span class="c1"># Process DICOM file</span>
    <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_single_dicom_image</span><span class="p">(</span>
        <span class="n">dcm_path</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.redact_from_directory" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_from_directory</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_from_directory</span><span class="p">(</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact from a directory of files.</p>
<p>Please notice, this method duplicates the files, creates
new instances and manipulate them.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_dicom_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to directory of DICOM images.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to parent output directory.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code></code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>padding_width</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Color setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to save boundings boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_from_directory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a directory of files.</span>

<span class="sd">    Please notice, this method duplicates the files, creates</span>
<span class="sd">    new instances and manipulate them.</span>

<span class="sd">    :param input_dicom_path: String path to directory of DICOM images.</span>
<span class="sd">    :param output_dir: String path to parent output directory.</span>
<span class="sd">    :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param fill: Color setting to use for redaction box</span>
<span class="sd">    (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify the given paths</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid directory&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a directory (not file)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create duplicates</span>
    <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

    <span class="c1"># Process DICOM files</span>
    <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_multiple_dicom_images</span><span class="p">(</span>
        <span class="n">dcm_dir</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.augment_word" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">augment_word</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply multiple types of casing to the provided string.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>words</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String containing the word or term of interest.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>case_sensitive</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to preserve casing.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>list</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of the same string with different casings and spacing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply multiple types of casing to the provided string.</span>

<span class="sd">    :param words: String containing the word or term of interest.</span>
<span class="sd">    :param case_sensitive: True if we want to preserve casing.</span>

<span class="sd">    :return: List of the same string with different casings and spacing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="c1"># Replacing separator character with space, if any</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_no_separator</span><span class="p">)</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Capitalize all characters in string</span>
            <span class="n">text_upper</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

            <span class="c1"># Lowercase all characters in string</span>
            <span class="n">text_lower</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># Capitalize first letter in each part of string</span>
            <span class="n">text_title</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

            <span class="c1"># Append iterations</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span><span class="n">text_no_separator</span><span class="p">,</span> <span class="n">text_upper</span><span class="p">,</span> <span class="n">text_lower</span><span class="p">,</span> <span class="n">text_title</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Adding each term as a separate item in the list</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_upper</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_lower</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Flatten list</span>
        <span class="n">flat_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">flat_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># Remove any duplicates and empty strings</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flat_list</span><span class="p">))</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">word_list</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">word_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">verify</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">verify</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Annotate image with the detect PII entity.</p>
<p>Please notice, this method duplicates the image, creates a
new instance and manipulate it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether the image is greyscale or not.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the verificationimage is displayed and returned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_text_annotation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to display entity type when displaying image with bounding boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the annotated image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Annotate image with the detect PII entity.</span>

<span class="sd">    Please notice, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulate it.</span>

<span class="sd">    :param image: PIL Image to be processed.</span>
<span class="sd">    :param is_greyscale: Whether the image is greyscale or not.</span>
<span class="sd">    :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">    :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">    image with bounding boxes.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in ImageAnalyzerEngine.</span>

<span class="sd">    :return: the annotated image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Check the ad-hoc recognizers list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

    <span class="c1"># Detect text</span>
    <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># noqa: E501</span>
    <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
            <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
        <span class="p">)</span>
    <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>

    <span class="c1"># Prepare for plotting</span>
    <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
        <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Get image with verification boxes</span>
    <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">display_image</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">verify_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.verify_dicom_instance" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">verify_dicom_instance</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">verify_dicom_instance</span><span class="p">(</span>
    <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Verify PII on a single DICOM instance.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>instance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the verificationimage is displayed and returned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_text_annotation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to display entity type when displaying image with bounding boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Optional">Optional</span>[<span title="PIL.Image.Image">Image</span>], dict, list]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Image with boxes identifying PHI, OCR results, and analyzer results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify_dicom_instance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify PII on a single DICOM instance.</span>

<span class="sd">    :param instance: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">    :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">    image with bounding boxes.</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in ImageAnalyzerEngine.</span>

<span class="sd">    :return: Image with boxes identifying PHI, OCR results,</span>
<span class="sd">    and analyzer results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">instance_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">instance_copy</span><span class="o">.</span><span class="n">PixelData</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Provided DICOM instance lacks pixel data.&quot;</span><span class="p">)</span>

    <span class="c1"># Load image for processing</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance_copy</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance_copy</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="s2">&quot;tmp_dcm&quot;</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

        <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/tmp_dcm.png&quot;</span>
        <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

    <span class="c1"># Get OCR results</span>
    <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># noqa: E501</span>
    <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr_engine</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
            <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
        <span class="p">)</span>
    <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

    <span class="c1"># Get analyzer results</span>
    <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>

    <span class="c1"># Prepare for plotting</span>
    <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
        <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Get image with verification boxes</span>
    <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">display_image</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">verify_image</span><span class="p">,</span> <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.eval_dicom_instance" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">eval_dicom_instance</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">eval_dicom_instance</span><span class="p">(</span>
    <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Evaluate performance for a single DICOM instance.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>instance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ground_truth</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary containing ground truth labels for the instance.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel distance tolerance for matching to ground truth.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>50</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the verificationimage is displayed and returned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Optional">Optional</span>[<span title="PIL.Image.Image">Image</span>], dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Evaluation comparing redactor engine results vs ground truth.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eval_dicom_instance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate performance for a single DICOM instance.</span>

<span class="sd">    :param instance: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param ground_truth: Dictionary containing ground truth labels for the instance.</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param tolerance: Pixel distance tolerance for matching to ground truth.</span>
<span class="sd">    :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in ImageAnalyzerEngine.</span>

<span class="sd">    :return: Evaluation comparing redactor engine results vs ground truth.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify detected PHI</span>
    <span class="n">verify_image</span><span class="p">,</span> <span class="n">ocr_results</span><span class="p">,</span> <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_dicom_instance</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">,</span>
        <span class="n">display_image</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">formatted_ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span>
        <span class="n">ocr_results</span>
    <span class="p">)</span>
    <span class="n">detected_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>

    <span class="c1"># Remove duplicate entities in results</span>
    <span class="n">detected_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicate_entities</span><span class="p">(</span><span class="n">detected_phi</span><span class="p">)</span>

    <span class="c1"># Get correct PHI text (all TP and FP)</span>
    <span class="n">all_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_all_positives</span><span class="p">(</span>
        <span class="n">ground_truth</span><span class="p">,</span> <span class="n">formatted_ocr_results</span><span class="p">,</span> <span class="n">detected_phi</span><span class="p">,</span> <span class="n">tolerance</span>
    <span class="p">)</span>

    <span class="c1"># Calculate evaluation metrics</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_precision</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_recall</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">)</span>

    <span class="n">eval_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;all_positives&quot;</span><span class="p">:</span> <span class="n">all_pos</span><span class="p">,</span>
        <span class="s2">&quot;ground_truth&quot;</span><span class="p">:</span> <span class="n">ground_truth</span><span class="p">,</span>
        <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
        <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">verify_image</span><span class="p">,</span> <span class="n">eval_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_precision" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_precision</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate_precision</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate precision.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gt</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of ground truth labels.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_pos</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>All Detected PHI (mapped back to have actual PHI text).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>float</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Precision value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">calculate_precision</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate precision.</span>

<span class="sd">    :param gt: List of ground truth labels.</span>
<span class="sd">    :param all_pos: All Detected PHI (mapped back to have actual PHI text).</span>
<span class="sd">    :return: Precision value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find True Positive (TP) and precision</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_pos</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">precision</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.dicom_image_pii_verify_engine.DicomImagePiiVerifyEngine.calculate_recall" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_recall</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate_recall</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate recall.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gt</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of ground truth labels.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_pos</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>All Detected PHI (mapped back to have actual PHI text).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>float</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Recall value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">calculate_recall</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate recall.</span>

<span class="sd">    :param gt: List of ground truth labels.</span>
<span class="sd">    :param all_pos: All Detected PHI (mapped back to have actual PHI text).</span>
<span class="sd">    :return: Recall value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find True Positive (TP) and precision</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gt</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">recall</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.bbox" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">bbox</span>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">











<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.bbox.BboxProcessor" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">BboxProcessor</span>


</h4>


    <div class="doc doc-contents ">


        <p>Common module for general bounding box operators.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_ocr_results" href="#presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_ocr_results">get_bboxes_from_ocr_results</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Get bounding boxes on padded image for all detected words from ocr_results.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_analyzer_results" href="#presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_analyzer_results">get_bboxes_from_analyzer_results</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Organize bounding box info from analyzer results.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.bbox.BboxProcessor.remove_bbox_padding" href="#presidio_image_redactor.bbox.BboxProcessor.remove_bbox_padding">remove_bbox_padding</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Remove added padding in bounding box coordinates.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.bbox.BboxProcessor.match_with_source" href="#presidio_image_redactor.bbox.BboxProcessor.match_with_source">match_with_source</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Match returned redacted PII bbox data with some source of truth for PII.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BboxProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common module for general bounding box operators.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_bboxes_from_ocr_results</span><span class="p">(</span>
        <span class="n">ocr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get bounding boxes on padded image for all detected words from ocr_results.</span>

<span class="sd">        :param ocr_results: Raw results from OCR.</span>
<span class="sd">        :return: Bounding box information per word.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])):</span>
            <span class="n">detected_text</span> <span class="o">=</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">detected_text</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;conf&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">detected_text</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Organize bounding box info from analyzer results.</span>

<span class="sd">        :param analyzer_results: Results from using ImageAnalyzerEngine.</span>

<span class="sd">        :return: Bounding box info organized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analyzer_results</span><span class="p">)):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="n">bbox_item</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox_item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_bbox_padding</span><span class="p">(</span>
        <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove added padding in bounding box coordinates.</span>

<span class="sd">        :param analyzer_bboxes: The bounding boxes from analyzer results.</span>
<span class="sd">        :param padding_width: Pixel width used for padding (0 if no padding).</span>

<span class="sd">        :return: Bounding box information per word.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">padding_width</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Padding width must be a non-negative integer.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Get fields</span>
            <span class="n">has_label</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
                <span class="n">has_label</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">has_label</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]</span>
                <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Remove padding from all bounding boxes</span>
            <span class="k">if</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">match_with_source</span><span class="p">(</span>
        <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">pii_source_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">detected_pii</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Match returned redacted PII bbox data with some source of truth for PII.</span>

<span class="sd">        :param all_pos: Dictionary storing all positives.</span>
<span class="sd">        :param pii_source_dict: List of PII labels for this instance.</span>
<span class="sd">        :param detected_pii: Detected PII (single entity from analyzer_results).</span>
<span class="sd">        :param tolerance: Tolerance for exact coordinates and size data.</span>
<span class="sd">        :return: List of all positive with PII mapped back as possible</span>
<span class="sd">        and whether a match was found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_pos_match</span> <span class="o">=</span> <span class="n">all_pos</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Get info from detected PII (positive)</span>
        <span class="n">results_left</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
        <span class="n">results_top</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
        <span class="n">results_width</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
        <span class="n">results_height</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results_score</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># Handle matching when no score available</span>
            <span class="n">results_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">match_found</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># See what in the ground truth this positive matches</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">pii_source_dict</span><span class="p">:</span>
            <span class="n">source_left</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
            <span class="n">source_top</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
            <span class="n">source_width</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="n">source_height</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>

            <span class="n">match_left</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_left</span> <span class="o">-</span> <span class="n">results_left</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
            <span class="n">match_top</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_top</span> <span class="o">-</span> <span class="n">results_top</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
            <span class="n">match_width</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_width</span> <span class="o">-</span> <span class="n">results_width</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
            <span class="n">match_height</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_height</span> <span class="o">-</span> <span class="n">results_height</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
            <span class="n">matching</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_left</span><span class="p">,</span> <span class="n">match_top</span><span class="p">,</span> <span class="n">match_width</span><span class="p">,</span> <span class="n">match_height</span><span class="p">]</span>

            <span class="k">if</span> <span class="kc">False</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matching</span><span class="p">:</span>
                <span class="c1"># If match is found, carry over ground truth info</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="n">label</span>
                <span class="n">positive</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_score</span>
                <span class="n">all_pos_match</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">positive</span><span class="p">)</span>
                <span class="n">match_found</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">all_pos_match</span><span class="p">,</span> <span class="n">match_found</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_ocr_results" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_bboxes_from_ocr_results</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_bboxes_from_ocr_results</span><span class="p">(</span>
    <span class="n">ocr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get bounding boxes on padded image for all detected words from ocr_results.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_results</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Raw results from OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, <span title="typing.List">List</span>[<span title="typing.Union">Union</span>[int, str]]]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[int, float, str]]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Bounding box information per word.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_bboxes_from_ocr_results</span><span class="p">(</span>
    <span class="n">ocr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get bounding boxes on padded image for all detected words from ocr_results.</span>

<span class="sd">    :param ocr_results: Raw results from OCR.</span>
<span class="sd">    :return: Bounding box information per word.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])):</span>
        <span class="n">detected_text</span> <span class="o">=</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">detected_text</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;conf&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">detected_text</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.bbox.BboxProcessor.get_bboxes_from_analyzer_results" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_bboxes_from_analyzer_results</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_bboxes_from_analyzer_results</span><span class="p">(</span>
    <span class="n">analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Organize bounding box info from analyzer results.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>analyzer_results</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Results from using ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult" href="#presidio_image_redactor.entities.ImageRecognizerResult">ImageRecognizerResult</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, float, int]]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Bounding box info organized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_bboxes_from_analyzer_results</span><span class="p">(</span>
    <span class="n">analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Organize bounding box info from analyzer results.</span>

<span class="sd">    :param analyzer_results: Results from using ImageAnalyzerEngine.</span>

<span class="sd">    :return: Bounding box info organized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analyzer_results</span><span class="p">)):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="n">bbox_item</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
            <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox_item</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.bbox.BboxProcessor.remove_bbox_padding" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">remove_bbox_padding</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">remove_bbox_padding</span><span class="p">(</span>
    <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Remove added padding in bounding box coordinates.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>analyzer_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The bounding boxes from analyzer results.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, float, int]]]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel width used for padding (0 if no padding).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, int]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Bounding box information per word.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">remove_bbox_padding</span><span class="p">(</span>
    <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove added padding in bounding box coordinates.</span>

<span class="sd">    :param analyzer_bboxes: The bounding boxes from analyzer results.</span>
<span class="sd">    :param padding_width: Pixel width used for padding (0 if no padding).</span>

<span class="sd">    :return: Bounding box information per word.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">padding_width</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Padding width must be a non-negative integer.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Get fields</span>
        <span class="n">has_label</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
            <span class="n">has_label</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">has_label</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]</span>
            <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Remove padding from all bounding boxes</span>
        <span class="k">if</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
            <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.bbox.BboxProcessor.match_with_source" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">match_with_source</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">match_with_source</span><span class="p">(</span>
    <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">pii_source_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">detected_pii</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Match returned redacted PII bbox data with some source of truth for PII.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>all_pos</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary storing all positives.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int, float]]]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pii_source_dict</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PII labels for this instance.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int, float]]]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>detected_pii</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Detected PII (single entity from analyzer_results).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, float, int]]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tolerance for exact coordinates and size data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>50</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int, float]]], bool]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of all positive with PII mapped back as possible and whether a match was found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">match_with_source</span><span class="p">(</span>
    <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">pii_source_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">detected_pii</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Match returned redacted PII bbox data with some source of truth for PII.</span>

<span class="sd">    :param all_pos: Dictionary storing all positives.</span>
<span class="sd">    :param pii_source_dict: List of PII labels for this instance.</span>
<span class="sd">    :param detected_pii: Detected PII (single entity from analyzer_results).</span>
<span class="sd">    :param tolerance: Tolerance for exact coordinates and size data.</span>
<span class="sd">    :return: List of all positive with PII mapped back as possible</span>
<span class="sd">    and whether a match was found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_pos_match</span> <span class="o">=</span> <span class="n">all_pos</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Get info from detected PII (positive)</span>
    <span class="n">results_left</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
    <span class="n">results_top</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
    <span class="n">results_width</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
    <span class="n">results_height</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">results_score</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># Handle matching when no score available</span>
        <span class="n">results_score</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">match_found</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># See what in the ground truth this positive matches</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">pii_source_dict</span><span class="p">:</span>
        <span class="n">source_left</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
        <span class="n">source_top</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
        <span class="n">source_width</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
        <span class="n">source_height</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>

        <span class="n">match_left</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_left</span> <span class="o">-</span> <span class="n">results_left</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
        <span class="n">match_top</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_top</span> <span class="o">-</span> <span class="n">results_top</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
        <span class="n">match_width</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_width</span> <span class="o">-</span> <span class="n">results_width</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
        <span class="n">match_height</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_height</span> <span class="o">-</span> <span class="n">results_height</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
        <span class="n">matching</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_left</span><span class="p">,</span> <span class="n">match_top</span><span class="p">,</span> <span class="n">match_width</span><span class="p">,</span> <span class="n">match_height</span><span class="p">]</span>

        <span class="k">if</span> <span class="kc">False</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matching</span><span class="p">:</span>
            <span class="c1"># If match is found, carry over ground truth info</span>
            <span class="n">positive</span> <span class="o">=</span> <span class="n">label</span>
            <span class="n">positive</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_score</span>
            <span class="n">all_pos_match</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">positive</span><span class="p">)</span>
            <span class="n">match_found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">all_pos_match</span><span class="p">,</span> <span class="n">match_found</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.ocr" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">ocr</span>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">







<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.ocr.OCR" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">OCR</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>OCR class that performs OCR on a given image.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ocr.OCR.perform_ocr" href="#presidio_image_redactor.ocr.OCR.perform_ocr">perform_ocr</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Perform OCR on a given image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ocr.OCR.get_text_from_ocr_dict" href="#presidio_image_redactor.ocr.OCR.get_text_from_ocr_dict">get_text_from_ocr_dict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Combine the text from the OCR dict to full text.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OCR</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OCR class that performs OCR on a given image.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform OCR on a given image.</span>

<span class="sd">        :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">        :param kwargs: Additional values for perform OCR method</span>

<span class="sd">        :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine the text from the OCR dict to full text.</span>

<span class="sd">        :param ocr_result: dictionary containing the ocr results per word</span>
<span class="sd">        :param separator: separator to use when joining the words</span>

<span class="sd">        return: str containing the full extracted text as string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_result</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.ocr.OCR.perform_ocr" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_ocr</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform OCR on a given image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image/numpy array or file path(str) to be processed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>object</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for perform OCR method</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>results dictionary containing bboxes and text for each detected word</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform OCR on a given image.</span>

<span class="sd">    :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">    :param kwargs: Additional values for perform OCR method</span>

<span class="sd">    :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.ocr.OCR.get_text_from_ocr_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_text_from_ocr_dict</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Combine the text from the OCR dict to full text.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dictionary containing the ocr results per word</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>separator to use when joining the words  return: str containing the full extracted text as string</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39; &#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the text from the OCR dict to full text.</span>

<span class="sd">    :param ocr_result: dictionary containing the ocr results per word</span>
<span class="sd">    :param separator: separator to use when joining the words</span>

<span class="sd">    return: str containing the full extracted text as string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_result</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.image_redactor_engine" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">image_redactor_engine</span>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">























<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.image_redactor_engine.ImageRedactorEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImageRedactorEngine</span>


</h4>


    <div class="doc doc-contents ">


        <p>ImageRedactorEngine performs OCR + PII detection + bounding box redaction.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_analyzer_engine</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Engine which performs OCR + PII detection.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine" href="#presidio_image_redactor.ImageAnalyzerEngine">ImageAnalyzerEngine</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_redactor_engine.ImageRedactorEngine.redact" href="#presidio_image_redactor.image_redactor_engine.ImageRedactorEngine.redact">redact</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_redactor_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageRedactorEngine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImageRedactorEngine performs OCR + PII detection + bounding box redaction.</span>

<span class="sd">    :param image_analyzer_engine: Engine which performs OCR + PII detection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image_analyzer_engine</span><span class="p">:</span> <span class="n">ImageAnalyzerEngine</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_analyzer_engine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span> <span class="o">=</span> <span class="n">ImageAnalyzerEngine</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span> <span class="o">=</span> <span class="n">image_analyzer_engine</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span> <span class="o">=</span> <span class="n">BboxProcessor</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given image.</span>

<span class="sd">        Please notice, this method duplicates the image, creates a new instance and</span>
<span class="sd">        manipulate it.</span>
<span class="sd">        :param image: PIL Image to be processed.</span>
<span class="sd">        :param fill: colour to fill the shape - int (0-255) for</span>
<span class="sd">        grayscale or Tuple(R, G, B) for RGB.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: the redacted image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Check the ad-hoc recognizers list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">left</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">top</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
            <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_ad_hoc_recognizer_list</span><span class="p">(</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the provided ad-hoc recognizer list is valid.</span>

<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">are_recognizers</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                        <span class="nb">isinstance</span><span class="p">(</span>
                            <span class="n">x</span><span class="p">,</span> <span class="n">presidio_analyzer</span><span class="o">.</span><span class="n">pattern_recognizer</span><span class="o">.</span><span class="n">PatternRecognizer</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ad_hoc_recognizers</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">are_recognizers</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span class="w">                            </span><span class="sd">&quot;&quot;&quot;All items in ad_hoc_recognizers list must be</span>
<span class="sd">                            PatternRecognizer objects&quot;&quot;&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;ad_hoc_recognizers must be None or list of PatternRecognizer&quot;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;ad_hoc_recognizers must be None or list of PatternRecognizer&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_redactor_engine.ImageRedactorEngine.redact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given image.</p>
<p>Please notice, this method duplicates the image, creates a new instance and
manipulate it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>colour to fill the shape - int (0-255) for grayscale or Tuple(R, G, B) for RGB.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[int, <span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 0, 0)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the redacted image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given image.</span>

<span class="sd">    Please notice, this method duplicates the image, creates a new instance and</span>
<span class="sd">    manipulate it.</span>
<span class="sd">    :param image: PIL Image to be processed.</span>
<span class="sd">    :param fill: colour to fill the shape - int (0-255) for</span>
<span class="sd">    grayscale or Tuple(R, G, B) for RGB.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: the redacted image</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Check the ad-hoc recognizers list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">left</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">top</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.image_analyzer_engine" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">image_analyzer_engine</span>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">































<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImageAnalyzerEngine</span>


</h4>


    <div class="doc doc-contents ">


        <p>ImageAnalyzerEngine class.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>analyzer_engine</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The Presidio AnalyzerEngine instance to be used to detect PII in text</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.AnalyzerEngine" href="../analyzer_python/#presidio_analyzer.AnalyzerEngine">AnalyzerEngine</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the OCR object to be used to detect text in images.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="presidio_image_redactor.OCR" href="#presidio_image_redactor.OCR">OCR</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_preprocessor</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The ImagePreprocessor object to be used to preprocess the image</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="presidio_image_redactor.ImagePreprocessor" href="#presidio_image_redactor.ImagePreprocessor">ImagePreprocessor</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.analyze" href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.analyze">analyze</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Analyse method to analyse the given image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.threshold_ocr_result" href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.threshold_ocr_result">threshold_ocr_result</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Filter out OCR results below confidence threshold.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.remove_space_boxes" href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.remove_space_boxes">remove_space_boxes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Remove OCR bboxes that are for spaces.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes" href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes">map_analyzer_results_to_bounding_boxes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Map extracted PII entities to image bounding boxes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.fig2img" href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.fig2img">fig2img</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert a Matplotlib figure to a PIL Image and return it.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.get_pii_bboxes" href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.get_pii_bboxes">get_pii_bboxes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Get a list of bboxes with is_PII property.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.add_custom_bboxes" href="#presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.add_custom_bboxes">add_custom_bboxes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Add custom bounding boxes to image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageAnalyzerEngine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImageAnalyzerEngine class.</span>

<span class="sd">    :param analyzer_engine: The Presidio AnalyzerEngine instance</span>
<span class="sd">        to be used to detect PII in text</span>
<span class="sd">    :param ocr: the OCR object to be used to detect text in images.</span>
<span class="sd">    :param image_preprocessor: The ImagePreprocessor object to be</span>
<span class="sd">        used to preprocess the image</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">analyzer_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnalyzerEngine</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ocr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OCR</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">image_preprocessor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImagePreprocessor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">analyzer_engine</span><span class="p">:</span>
            <span class="n">analyzer_engine</span> <span class="o">=</span> <span class="n">AnalyzerEngine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer_engine</span> <span class="o">=</span> <span class="n">analyzer_engine</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr</span><span class="p">:</span>
            <span class="n">ocr</span> <span class="o">=</span> <span class="n">TesseractOCR</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span> <span class="o">=</span> <span class="n">ocr</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_preprocessor</span><span class="p">:</span>
            <span class="n">image_preprocessor</span> <span class="o">=</span> <span class="n">ImagePreprocessor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_preprocessor</span> <span class="o">=</span> <span class="n">image_preprocessor</span>

    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyse method to analyse the given image.</span>

<span class="sd">        :param image: PIL Image/numpy array or file path(str) to be processed.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: List of the extract entities with image bounding boxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Perform OCR</span>
        <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
        <span class="n">image</span><span class="p">,</span> <span class="n">preprocessing_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_preprocessor</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span><span class="p">)</span>
        <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">preprocessing_metadata</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;scale_factor&quot;</span> <span class="ow">in</span> <span class="n">preprocessing_metadata</span><span class="p">):</span>
            <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_bbox_results</span><span class="p">(</span>
                <span class="n">ocr_result</span><span class="p">,</span> <span class="n">preprocessing_metadata</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Apply OCR confidence threshold if it is passed in</span>
        <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
            <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">)</span>

        <span class="c1"># Analyze text</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>

        <span class="c1"># Difines English as default language, if not specified</span>
        <span class="k">if</span> <span class="s2">&quot;language&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">text_analyzer_kwargs</span><span class="p">:</span>
            <span class="n">text_analyzer_kwargs</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>
        <span class="n">analyzer_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
        <span class="p">)</span>
        <span class="n">allow_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_allow_list</span><span class="p">(</span><span class="n">text_analyzer_kwargs</span><span class="p">)</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
            <span class="n">analyzer_result</span><span class="p">,</span> <span class="n">ocr_result</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">allow_list</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter out OCR results below confidence threshold.</span>

<span class="sd">        :param ocr_result: OCR results (raw).</span>
<span class="sd">        :param ocr_threshold: Threshold value between -1 and 100.</span>

<span class="sd">        :return: OCR results with low confidence items removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ocr_threshold</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ocr_threshold</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ocr_threshold must be between -1 and 100&quot;</span><span class="p">)</span>

        <span class="c1"># Get indices of items above threshold</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;conf&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ocr_threshold</span><span class="p">:</span>
                <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Only retain high confidence items</span>
        <span class="n">filtered_ocr_result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">filtered_ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">filtered_ocr_result</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove OCR bboxes that are for spaces.</span>

<span class="sd">        :param ocr_result: OCR results (raw or thresholded).</span>
<span class="sd">        :return: OCR results with empty words removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get indices of items with no text</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]):</span>
            <span class="n">is_not_space</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">is_not_space</span><span class="p">:</span>
                <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Only retain items with text</span>
        <span class="n">filtered_ocr_result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">filtered_ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">filtered_ocr_result</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
        <span class="n">text_analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RecognizerResult</span><span class="p">],</span>
        <span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">allow_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map extracted PII entities to image bounding boxes.</span>

<span class="sd">        Matching is based on the position of the recognized entity from analyzer</span>
<span class="sd">        and word (in ocr dict) in the text.</span>

<span class="sd">        :param text_analyzer_results: PII entities recognized by presidio analyzer</span>
<span class="sd">        :param ocr_result: dict results with words and bboxes from OCR</span>
<span class="sd">        :param text: text the results are based on</span>
<span class="sd">        :param allow_list: List of words to not redact</span>

<span class="sd">        return: list of extracted entities with image bounding boxes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ocr_result</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">text_analyzer_results</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">proc_indexes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_analyzer_results</span><span class="p">)</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iter_ocr</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">iter_ocr</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">text_analyzer_results</span><span class="p">:</span>
                    <span class="n">text_element</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">start</span> <span class="p">:</span> <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">]</span>
                    <span class="c1"># check position and text of ocr word matches recognized entity</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
                    <span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">text_element</span> <span class="ow">in</span> <span class="n">word</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">text_element</span><span class="p">)):</span>
                        <span class="n">yes_make_bbox_for_word</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="p">(</span><span class="n">word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_list</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="c1"># Do not add bbox for standalone spaces / empty strings</span>
                        <span class="k">if</span> <span class="n">yes_make_bbox_for_word</span><span class="p">:</span>
                            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">ImageRecognizerResult</span><span class="p">(</span>
                                    <span class="n">element</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
                                    <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                    <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                                    <span class="n">element</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                                    <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                    <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                    <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                    <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                <span class="p">)</span>
                            <span class="p">)</span>

                            <span class="c1"># add bounding boxes for all words in ocr dict</span>
                            <span class="c1"># contained within the text of recognized entity</span>
                            <span class="c1"># based on relative position in the full text</span>
                            <span class="k">while</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                                <span class="n">prev_word</span> <span class="o">=</span> <span class="n">word</span>
                                <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iter_ocr</span><span class="p">)</span>
                                <span class="n">yes_make_bbox_for_word</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="p">(</span><span class="n">word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                                    <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                                    <span class="ow">and</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
                                    <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_list</span><span class="p">)</span>
                                <span class="p">)</span>
                                <span class="k">if</span> <span class="n">yes_make_bbox_for_word</span><span class="p">:</span>
                                    <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                        <span class="n">ImageRecognizerResult</span><span class="p">(</span>
                                            <span class="n">element</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
                                            <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                            <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                                            <span class="n">element</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                                            <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                            <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                            <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                            <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev_word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="n">proc_indexes</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">proc_indexes</span> <span class="o">==</span> <span class="n">indexes</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_scale_bbox_results</span><span class="p">(</span>
        <span class="n">ocr_result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span> <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale down the bounding box results based on a scale percentage.</span>

<span class="sd">        :param ocr_result: OCR results (raw).</span>
<span class="sd">        :param scale_percent: Scale percentage for resizing the bounding box.</span>

<span class="sd">        :return: OCR results (scaled).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scaled_results</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>
        <span class="n">coordinate_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">]</span>
        <span class="n">dimension_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">coord_key</span> <span class="ow">in</span> <span class="n">coordinate_keys</span><span class="p">:</span>
            <span class="n">scaled_results</span><span class="p">[</span><span class="n">coord_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale_factor</span><span class="p">)))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scaled_results</span><span class="p">[</span><span class="n">coord_key</span><span class="p">]</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">dim_key</span> <span class="ow">in</span> <span class="n">dimension_keys</span><span class="p">:</span>
            <span class="n">scaled_results</span><span class="p">[</span><span class="n">dim_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale_factor</span><span class="p">))))</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scaled_results</span><span class="p">[</span><span class="n">dim_key</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="n">scaled_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_bbox_padding</span><span class="p">(</span>
        <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove added padding in bounding box coordinates.</span>

<span class="sd">        :param analyzer_bboxes: The bounding boxes from analyzer results.</span>
<span class="sd">        :param padding_width: Pixel width used for padding (0 if no padding).</span>

<span class="sd">        :return: Bounding box information per word.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">unpadded_results</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">padding_width</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Padding width must be a non-negative integer.&quot;</span><span class="p">)</span>

        <span class="n">coordinate_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">coord_key</span> <span class="ow">in</span> <span class="n">coordinate_keys</span><span class="p">:</span>
            <span class="n">unpadded_results</span><span class="p">[</span><span class="n">coord_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unpadded_results</span><span class="p">[</span><span class="n">coord_key</span><span class="p">]</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">unpadded_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the OCR-related kwargs.</span>

<span class="sd">        :param ocr_kwargs: Parameters for OCR operations.</span>

<span class="sd">        :return: Params for ocr.perform_ocr and ocr_threshold</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">ocr_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;ocr_threshold&quot;</span> <span class="ow">in</span> <span class="n">ocr_kwargs</span><span class="p">:</span>
                <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="n">ocr_kwargs</span><span class="p">[</span><span class="s2">&quot;ocr_threshold&quot;</span><span class="p">]</span>
                <span class="n">ocr_kwargs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ocr_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;ocr_threshold&quot;</span>
                <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ocr_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_for_allow_list</span><span class="p">(</span><span class="n">text_analyzer_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the text_analyzer_kwargs for an allow_list.</span>

<span class="sd">        :param text_analyzer_kwargs: Text analyzer kwargs.</span>
<span class="sd">        :return: The allow list if it exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allow_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">text_analyzer_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;allow_list&quot;</span> <span class="ow">in</span> <span class="n">text_analyzer_kwargs</span><span class="p">:</span>
                <span class="n">allow_list</span> <span class="o">=</span> <span class="n">text_analyzer_kwargs</span><span class="p">[</span><span class="s2">&quot;allow_list&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">allow_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a Matplotlib figure to a PIL Image and return it.</span>

<span class="sd">        :param fig: Matplotlib figure.</span>

<span class="sd">        :return: Image of figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_pii_bboxes</span><span class="p">(</span>
        <span class="n">ocr_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of bboxes with is_PII property.</span>

<span class="sd">        :param ocr_bboxes: Bboxes from OCR results.</span>
<span class="sd">        :param analyzer_bboxes: Bboxes from analyzer results.</span>

<span class="sd">        :return: All bboxes with appropriate label for whether it is PHI or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ocr_bbox</span> <span class="ow">in</span> <span class="n">ocr_bboxes</span><span class="p">:</span>
            <span class="n">has_match</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Check if we have the same bbox in analyzer results</span>
            <span class="k">for</span> <span class="n">analyzer_bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span><span class="p">:</span>
                <span class="n">has_same_position</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># noqa: E501</span>
                <span class="n">has_same_dimension</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># noqa: E501</span>
                <span class="n">is_same</span> <span class="o">=</span> <span class="n">has_same_position</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_same_dimension</span> <span class="ow">is</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">is_same</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">current_bbox</span> <span class="o">=</span> <span class="n">analyzer_bbox</span>
                    <span class="n">current_bbox</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">has_match</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">has_match</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">current_bbox</span> <span class="o">=</span> <span class="n">ocr_bbox</span>
                <span class="n">current_bbox</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_bbox</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_custom_bboxes</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
        <span class="n">bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_greyscale_cmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add custom bounding boxes to image.</span>

<span class="sd">        :param image: Standard image of DICOM pixels.</span>
<span class="sd">        :param bboxes: List of bounding boxes to display (with is_PII field).</span>
<span class="sd">        :param gt_bboxes: Ground truth bboxes (list of dictionaries).</span>
<span class="sd">        :param show_text_annotation: True if you want text annotation for</span>
<span class="sd">        PHI status to display.</span>
<span class="sd">        :param use_greyscale_cmap: Use greyscale color map.</span>
<span class="sd">        :return: Image with bounding boxes drawn on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image_custom</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span> <span class="o">=</span> <span class="n">image_custom</span><span class="o">.</span><span class="n">size</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">image_r</span> <span class="o">=</span> <span class="mi">70</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">image_x</span> <span class="o">/</span> <span class="n">image_r</span><span class="p">,</span> <span class="n">image_y</span> <span class="o">/</span> <span class="n">image_r</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bboxes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">image_custom</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">entity_type</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">entity_type</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]:</span>
                        <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>

                <span class="c1"># Get coordinates and dimensions</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
                <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
                <span class="n">rect</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">bbox_color</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">show_text_annotation</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                        <span class="n">entity_type</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round4,pad=.5&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;0.9&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">use_greyscale_cmap</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">)</span>
            <span class="n">im_from_fig</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">im_resized</span> <span class="o">=</span> <span class="n">im_from_fig</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">im_resized</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.analyze" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">analyze</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">analyze</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Analyse method to analyse the given image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image/numpy array or file path(str) to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>object</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult" href="#presidio_image_redactor.entities.ImageRecognizerResult">ImageRecognizerResult</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of the extract entities with image bounding boxes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse method to analyse the given image.</span>

<span class="sd">    :param image: PIL Image/numpy array or file path(str) to be processed.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: List of the extract entities with image bounding boxes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Perform OCR</span>
    <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">preprocessing_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_preprocessor</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span><span class="p">)</span>
    <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">preprocessing_metadata</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;scale_factor&quot;</span> <span class="ow">in</span> <span class="n">preprocessing_metadata</span><span class="p">):</span>
        <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_bbox_results</span><span class="p">(</span>
            <span class="n">ocr_result</span><span class="p">,</span> <span class="n">preprocessing_metadata</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># Apply OCR confidence threshold if it is passed in</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
        <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">)</span>

    <span class="c1"># Analyze text</span>
    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>

    <span class="c1"># Difines English as default language, if not specified</span>
    <span class="k">if</span> <span class="s2">&quot;language&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">text_analyzer_kwargs</span><span class="p">:</span>
        <span class="n">text_analyzer_kwargs</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>
    <span class="n">analyzer_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
    <span class="p">)</span>
    <span class="n">allow_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_allow_list</span><span class="p">(</span><span class="n">text_analyzer_kwargs</span><span class="p">)</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
        <span class="n">analyzer_result</span><span class="p">,</span> <span class="n">ocr_result</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">allow_list</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.threshold_ocr_result" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">threshold_ocr_result</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Filter out OCR results below confidence threshold.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>OCR results (raw).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_threshold</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Threshold value between -1 and 100.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>OCR results with low confidence items removed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter out OCR results below confidence threshold.</span>

<span class="sd">    :param ocr_result: OCR results (raw).</span>
<span class="sd">    :param ocr_threshold: Threshold value between -1 and 100.</span>

<span class="sd">    :return: OCR results with low confidence items removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ocr_threshold</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ocr_threshold must be between -1 and 100&quot;</span><span class="p">)</span>

    <span class="c1"># Get indices of items above threshold</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;conf&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ocr_threshold</span><span class="p">:</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Only retain high confidence items</span>
    <span class="n">filtered_ocr_result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">filtered_ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">filtered_ocr_result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.remove_space_boxes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">remove_space_boxes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Remove OCR bboxes that are for spaces.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>OCR results (raw or thresholded).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>OCR results with empty words removed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove OCR bboxes that are for spaces.</span>

<span class="sd">    :param ocr_result: OCR results (raw or thresholded).</span>
<span class="sd">    :return: OCR results with empty words removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get indices of items with no text</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]):</span>
        <span class="n">is_not_space</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">is_not_space</span><span class="p">:</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Only retain items with text</span>
    <span class="n">filtered_ocr_result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">filtered_ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">filtered_ocr_result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">map_analyzer_results_to_bounding_boxes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
    <span class="n">text_analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RecognizerResult</span><span class="p">],</span>
    <span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">allow_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Map extracted PII entities to image bounding boxes.</p>
<p>Matching is based on the position of the recognized entity from analyzer
and word (in ocr dict) in the text.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_results</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PII entities recognized by presidio analyzer</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dict results with words and bboxes from OCR</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>text the results are based on</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_list</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of words to not redact  return: list of extracted entities with image bounding boxes</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[str]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
    <span class="n">text_analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RecognizerResult</span><span class="p">],</span>
    <span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">allow_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Map extracted PII entities to image bounding boxes.</span>

<span class="sd">    Matching is based on the position of the recognized entity from analyzer</span>
<span class="sd">    and word (in ocr dict) in the text.</span>

<span class="sd">    :param text_analyzer_results: PII entities recognized by presidio analyzer</span>
<span class="sd">    :param ocr_result: dict results with words and bboxes from OCR</span>
<span class="sd">    :param text: text the results are based on</span>
<span class="sd">    :param allow_list: List of words to not redact</span>

<span class="sd">    return: list of extracted entities with image bounding boxes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ocr_result</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">text_analyzer_results</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">proc_indexes</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_analyzer_results</span><span class="p">)</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iter_ocr</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">iter_ocr</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">text_analyzer_results</span><span class="p">:</span>
                <span class="n">text_element</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">start</span> <span class="p">:</span> <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">]</span>
                <span class="c1"># check position and text of ocr word matches recognized entity</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">text_element</span> <span class="ow">in</span> <span class="n">word</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">text_element</span><span class="p">)):</span>
                    <span class="n">yes_make_bbox_for_word</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_list</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="c1"># Do not add bbox for standalone spaces / empty strings</span>
                    <span class="k">if</span> <span class="n">yes_make_bbox_for_word</span><span class="p">:</span>
                        <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ImageRecognizerResult</span><span class="p">(</span>
                                <span class="n">element</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
                                <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                                <span class="n">element</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                                <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                        <span class="c1"># add bounding boxes for all words in ocr dict</span>
                        <span class="c1"># contained within the text of recognized entity</span>
                        <span class="c1"># based on relative position in the full text</span>
                        <span class="k">while</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                            <span class="n">prev_word</span> <span class="o">=</span> <span class="n">word</span>
                            <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iter_ocr</span><span class="p">)</span>
                            <span class="n">yes_make_bbox_for_word</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="p">(</span><span class="n">word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_list</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">yes_make_bbox_for_word</span><span class="p">:</span>
                                <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">ImageRecognizerResult</span><span class="p">(</span>
                                        <span class="n">element</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
                                        <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                        <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                                        <span class="n">element</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                                        <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                        <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                        <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                        <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev_word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">proc_indexes</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">proc_indexes</span> <span class="o">==</span> <span class="n">indexes</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.fig2img" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fig2img</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a Matplotlib figure to a PIL Image and return it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Matplotlib figure.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="matplotlib.figure.Figure">Figure</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Image of figure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a Matplotlib figure to a PIL Image and return it.</span>

<span class="sd">    :param fig: Matplotlib figure.</span>

<span class="sd">    :return: Image of figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.get_pii_bboxes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_pii_bboxes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_pii_bboxes</span><span class="p">(</span>
    <span class="n">ocr_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get a list of bboxes with is_PII property.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Bboxes from OCR results.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>analyzer_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Bboxes from analyzer results.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>All bboxes with appropriate label for whether it is PHI or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_pii_bboxes</span><span class="p">(</span>
    <span class="n">ocr_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of bboxes with is_PII property.</span>

<span class="sd">    :param ocr_bboxes: Bboxes from OCR results.</span>
<span class="sd">    :param analyzer_bboxes: Bboxes from analyzer results.</span>

<span class="sd">    :return: All bboxes with appropriate label for whether it is PHI or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ocr_bbox</span> <span class="ow">in</span> <span class="n">ocr_bboxes</span><span class="p">:</span>
        <span class="n">has_match</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Check if we have the same bbox in analyzer results</span>
        <span class="k">for</span> <span class="n">analyzer_bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span><span class="p">:</span>
            <span class="n">has_same_position</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># noqa: E501</span>
            <span class="n">has_same_dimension</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># noqa: E501</span>
            <span class="n">is_same</span> <span class="o">=</span> <span class="n">has_same_position</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_same_dimension</span> <span class="ow">is</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">is_same</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">current_bbox</span> <span class="o">=</span> <span class="n">analyzer_bbox</span>
                <span class="n">current_bbox</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">has_match</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">has_match</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">current_bbox</span> <span class="o">=</span> <span class="n">ocr_bbox</span>
            <span class="n">current_bbox</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_bbox</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_analyzer_engine.ImageAnalyzerEngine.add_custom_bboxes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_custom_bboxes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_custom_bboxes</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_greyscale_cmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add custom bounding boxes to image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Standard image of DICOM pixels.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of bounding boxes to display (with is_PII field).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gt_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Ground truth bboxes (list of dictionaries).</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_text_annotation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if you want text annotation for PHI status to display.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_greyscale_cmap</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Use greyscale color map.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Image with bounding boxes drawn on.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">add_custom_bboxes</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_greyscale_cmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add custom bounding boxes to image.</span>

<span class="sd">    :param image: Standard image of DICOM pixels.</span>
<span class="sd">    :param bboxes: List of bounding boxes to display (with is_PII field).</span>
<span class="sd">    :param gt_bboxes: Ground truth bboxes (list of dictionaries).</span>
<span class="sd">    :param show_text_annotation: True if you want text annotation for</span>
<span class="sd">    PHI status to display.</span>
<span class="sd">    :param use_greyscale_cmap: Use greyscale color map.</span>
<span class="sd">    :return: Image with bounding boxes drawn on.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image_custom</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span> <span class="o">=</span> <span class="n">image_custom</span><span class="o">.</span><span class="n">size</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">image_r</span> <span class="o">=</span> <span class="mi">70</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">image_x</span> <span class="o">/</span> <span class="n">image_r</span><span class="p">,</span> <span class="n">image_y</span> <span class="o">/</span> <span class="n">image_r</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bboxes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_custom</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">entity_type</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">entity_type</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]:</span>
                    <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>

            <span class="c1"># Get coordinates and dimensions</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">bbox_color</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_text_annotation</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                    <span class="n">entity_type</span><span class="p">,</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round4,pad=.5&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;0.9&quot;</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">use_greyscale_cmap</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">)</span>
        <span class="n">im_from_fig</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">im_resized</span> <span class="o">=</span> <span class="n">im_from_fig</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">im_resized</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.document_intelligence_ocr" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">document_intelligence_ocr</span>


</h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">











<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DocumentIntelligenceOCR</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.OCR" href="#presidio_image_redactor.OCR">OCR</a></code></p>


        <p>OCR class that uses Azure AI Document Intelligence OCR engine.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The API key</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The API endpoint</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_id</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Which model to use  For details, see https://learn.microsoft.com/en-us/azure/ai-services/document-intelligence/</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;prebuilt-document&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_text_from_ocr_dict" href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_text_from_ocr_dict">get_text_from_ocr_dict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Combine the text from the OCR dict to full text.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_imgbytes" href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_imgbytes">get_imgbytes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Retrieve the image bytes from the image object.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.analyze_document" href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.analyze_document">analyze_document</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Analyze the document and return the result.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.perform_ocr" href="#presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.perform_ocr">perform_ocr</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Perform OCR on the image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/document_intelligence_ocr.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DocumentIntelligenceOCR</span><span class="p">(</span><span class="n">OCR</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OCR class that uses Azure AI Document Intelligence OCR engine.</span>

<span class="sd">    :param key: The API key</span>
<span class="sd">    :param endpoint: The API endpoint</span>
<span class="sd">    :param model_id: Which model to use</span>

<span class="sd">    For details, see</span>
<span class="sd">    https://learn.microsoft.com/en-us/azure/ai-services/document-intelligence/</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUPPORTED_MODELS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;prebuilt-document&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-read&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-layout&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-contract&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-healthInsuranceCard.us&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-invoice&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-receipt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-idDocument&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-businessCard&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prebuilt-document&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DocumentIntelligenceOCR</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported model id: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">model_id</span><span class="p">)</span>

        <span class="c1"># If endpoint and/or key are not passed, attempt to get from environment</span>
        <span class="c1"># variables</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DOCUMENT_INTELLIGENCE_ENDPOINT&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DOCUMENT_INTELLIGENCE_KEY&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Endpoint and key must be specified&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">DocumentAnalysisClient</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">credential</span><span class="o">=</span><span class="n">AzureKeyCredential</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span> <span class="o">=</span> <span class="n">model_id</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_polygon_to_bbox</span><span class="p">(</span><span class="n">polygon</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert polygon to a tuple of left/top/width/height.</span>

<span class="sd">        The returned bounding box should entirely cover the passed polygon.</span>

<span class="sd">        :param polygon: A sequence of points</span>

<span class="sd">        :return a tuple of left/top/width/height in pixel dimensions</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We need at least two points for a valid bounding box.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">left</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span>
        <span class="n">right</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">right</span> <span class="o">-</span> <span class="n">left</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_page_to_bboxes</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="n">DocumentPage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert bounding boxes to uniform format.</span>

<span class="sd">        Presidio supports tesseract format of output only, so we format in the same</span>
<span class="sd">        way.</span>
<span class="sd">        Expected format looks like:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;left&quot;: [123, 345],</span>
<span class="sd">            &quot;top&quot;: [0, 15],</span>
<span class="sd">            &quot;width&quot;: [100, 75],</span>
<span class="sd">            &quot;height&quot;: [25, 30],</span>
<span class="sd">            &quot;conf&quot;: [&quot;1&quot;, &quot;0.87&quot;],</span>
<span class="sd">            &quot;text&quot;: [&quot;JOHN&quot;, &quot;DOE&quot;],</span>
<span class="sd">        }</span>

<span class="sd">        :param page: The documentpage object from the DI client library</span>

<span class="sd">        :return dictionary in the expected format for presidio</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DocumentIntelligenceOCR</span><span class="o">.</span><span class="n">_polygon_to_bbox</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">polygon</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">words</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">],</span>
            <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">],</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">],</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">],</span>
            <span class="s2">&quot;conf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">confidence</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">words</span><span class="p">],</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">content</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">words</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_imgbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the image bytes from the image object.</span>

<span class="sd">        :param image:  Any of bytes/numpy array /PIL image object</span>

<span class="sd">        :return raw image bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">image</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="c1"># Fallthrough to process PIL image</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
            <span class="c1"># Image is a PIL image, write to bytes stream</span>
            <span class="n">ostream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ostream</span><span class="p">,</span> <span class="s2">&quot;PNG&quot;</span><span class="p">)</span>
            <span class="n">imgbytes</span> <span class="o">=</span> <span class="n">ostream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># image is a filename</span>
            <span class="n">imgbytes</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported image type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">imgbytes</span>

    <span class="k">def</span> <span class="nf">analyze_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgbytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalyzedDocument</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze the document and return the result.</span>

<span class="sd">        :param imgbytes: The bytes to send to the API endpoint</span>
<span class="sd">        :param kwargs: additional arguments for begin_analyze_document</span>

<span class="sd">        :return the result of the poller, an AnalyzedDocument object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">poller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">begin_analyze_document</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">imgbytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">poller</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform OCR on the image.</span>

<span class="sd">        :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">        :param kwargs: Additional values for begin_analyze_document</span>

<span class="sd">        :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imgbytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_imgbytes</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_document</span><span class="p">(</span><span class="n">imgbytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Currently cannot handle more than one page.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">pages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DocumentIntelligenceOCR only supports 1 page documents&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">DocumentIntelligenceOCR</span><span class="o">.</span><span class="n">_page_to_bboxes</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_text_from_ocr_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_text_from_ocr_dict</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Combine the text from the OCR dict to full text.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dictionary containing the ocr results per word</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>separator to use when joining the words  return: str containing the full extracted text as string</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39; &#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the text from the OCR dict to full text.</span>

<span class="sd">    :param ocr_result: dictionary containing the ocr results per word</span>
<span class="sd">    :param separator: separator to use when joining the words</span>

<span class="sd">    return: str containing the full extracted text as string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_result</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.get_imgbytes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_imgbytes</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_imgbytes</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieve the image bytes from the image object.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Any of bytes/numpy array /PIL image object</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[bytes, <span title="numpy.ndarray">ndarray</span>, <span title="PIL.Image.Image">Image</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/document_intelligence_ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_imgbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the image bytes from the image object.</span>

<span class="sd">    :param image:  Any of bytes/numpy array /PIL image object</span>

<span class="sd">    :return raw image bytes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="c1"># Fallthrough to process PIL image</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
        <span class="c1"># Image is a PIL image, write to bytes stream</span>
        <span class="n">ostream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ostream</span><span class="p">,</span> <span class="s2">&quot;PNG&quot;</span><span class="p">)</span>
        <span class="n">imgbytes</span> <span class="o">=</span> <span class="n">ostream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># image is a filename</span>
        <span class="n">imgbytes</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported image type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">imgbytes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.analyze_document" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">analyze_document</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">analyze_document</span><span class="p">(</span><span class="n">imgbytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalyzedDocument</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Analyze the document and return the result.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>imgbytes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The bytes to send to the API endpoint</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bytes</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>additional arguments for begin_analyze_document</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/document_intelligence_ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">analyze_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgbytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalyzedDocument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze the document and return the result.</span>

<span class="sd">    :param imgbytes: The bytes to send to the API endpoint</span>
<span class="sd">    :param kwargs: additional arguments for begin_analyze_document</span>

<span class="sd">    :return the result of the poller, an AnalyzedDocument object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">poller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">begin_analyze_document</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">imgbytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">poller</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.document_intelligence_ocr.DocumentIntelligenceOCR.perform_ocr" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_ocr</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform OCR on the image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image/numpy array or file path(str) to be processed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>object</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for begin_analyze_document</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>results dictionary containing bboxes and text for each detected word</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/document_intelligence_ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform OCR on the image.</span>

<span class="sd">    :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">    :param kwargs: Additional values for begin_analyze_document</span>

<span class="sd">    :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">imgbytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_imgbytes</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_document</span><span class="p">(</span><span class="n">imgbytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Currently cannot handle more than one page.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">pages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DocumentIntelligenceOCR only supports 1 page documents&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">DocumentIntelligenceOCR</span><span class="o">.</span><span class="n">_page_to_bboxes</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.image_pii_verify_engine" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">image_pii_verify_engine</span>


</h3>

    <div class="doc doc-contents ">







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_pii_verify_engine.fig2img" href="#presidio_image_redactor.image_pii_verify_engine.fig2img">fig2img</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert a Matplotlib figure to a PIL Image and return it.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>




  <div class="doc doc-children">















<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.image_pii_verify_engine.fig2img" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fig2img</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a Matplotlib figure to a PIL Image and return it.</p>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a Matplotlib figure to a PIL Image and return it.&quot;&quot;&quot;</span>

    <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImagePiiVerifyEngine</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_redactor_engine.ImageRedactorEngine" href="#presidio_image_redactor.image_redactor_engine.ImageRedactorEngine">ImageRedactorEngine</a></code></p>


        <p>ImagePiiVerifyEngine class only supporting Pii verification currently.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.redact" href="#presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.redact">redact</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.verify" href="#presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.verify">verify</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Annotate image with the detect PII entity.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_pii_verify_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImagePiiVerifyEngine</span><span class="p">(</span><span class="n">ImageRedactorEngine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImagePiiVerifyEngine class only supporting Pii verification currently.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
        <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Annotate image with the detect PII entity.</span>

<span class="sd">        Please notice, this method duplicates the image, creates a</span>
<span class="sd">        new instance and manipulate it.</span>

<span class="sd">        :param image: PIL Image to be processed.</span>
<span class="sd">        :param is_greyscale: Whether the image is greyscale or not.</span>
<span class="sd">        :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">        :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">        image with bounding boxes.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in ImageAnalyzerEngine.</span>

<span class="sd">        :return: the annotated image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Check the ad-hoc recognizers list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

        <span class="c1"># Detect text</span>
        <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># noqa: E501</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
            <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
                <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
            <span class="p">)</span>
        <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>

        <span class="c1"># Prepare for plotting</span>
        <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
            <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Get image with verification boxes</span>
        <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">display_image</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">verify_image</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.redact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given image.</p>
<p>Please notice, this method duplicates the image, creates a new instance and
manipulate it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>colour to fill the shape - int (0-255) for grayscale or Tuple(R, G, B) for RGB.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[int, <span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 0, 0)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the redacted image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given image.</span>

<span class="sd">    Please notice, this method duplicates the image, creates a new instance and</span>
<span class="sd">    manipulate it.</span>
<span class="sd">    :param image: PIL Image to be processed.</span>
<span class="sd">    :param fill: colour to fill the shape - int (0-255) for</span>
<span class="sd">    grayscale or Tuple(R, G, B) for RGB.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: the redacted image</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Check the ad-hoc recognizers list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">left</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">top</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.image_pii_verify_engine.ImagePiiVerifyEngine.verify" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">verify</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">verify</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Annotate image with the detect PII entity.</p>
<p>Please notice, this method duplicates the image, creates a
new instance and manipulate it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether the image is greyscale or not.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the verificationimage is displayed and returned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_text_annotation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to display entity type when displaying image with bounding boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the annotated image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Annotate image with the detect PII entity.</span>

<span class="sd">    Please notice, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulate it.</span>

<span class="sd">    :param image: PIL Image to be processed.</span>
<span class="sd">    :param is_greyscale: Whether the image is greyscale or not.</span>
<span class="sd">    :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">    :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">    image with bounding boxes.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in ImageAnalyzerEngine.</span>

<span class="sd">    :return: the annotated image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Check the ad-hoc recognizers list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

    <span class="c1"># Detect text</span>
    <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># noqa: E501</span>
    <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
            <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
        <span class="p">)</span>
    <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>

    <span class="c1"># Prepare for plotting</span>
    <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
        <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Get image with verification boxes</span>
    <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">display_image</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">verify_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h3 id="presidio_image_redactor.entities" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">entities</span>


</h3>

    <div class="doc doc-contents ">

        <p>Image Redactor entities.</p>









  <div class="doc doc-children">







<div class="doc doc-object doc-module">



<h4 id="presidio_image_redactor.entities.image_recognizer_result" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">image_recognizer_result</span>


</h4>

    <div class="doc doc-contents ">









  <div class="doc doc-children">











<div class="doc doc-object doc-class">



<h5 id="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImageRecognizerResult</span>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_analyzer.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code></p>


        <p>ImageRecognizerResult represents the results of analysing the image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>entity_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the type of the entity</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the start location of the detected entity in the text</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the end location of the detected entity in the text</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the score of the detection</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>left</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>x coord of the top left corner of the bbox in pixels</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>y coord of the top left corner of the bbox in pixels</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>width of the bbox in pixels</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>height of the bbox in pixels</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.append_analysis_explanation_text" href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.append_analysis_explanation_text">append_analysis_explanation_text</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Add text to the analysis explanation.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.to_dict" href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.to_dict">to_dict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Serialize self to dictionary.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.from_json" href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.from_json">from_json</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Create RecognizerResult from json.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.intersects" href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.intersects">intersects</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if self intersects with a different RecognizerResult.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contained_in" href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contained_in">contained_in</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if self is contained in a different RecognizerResult.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contains" href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contains">contains</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if one result is contained or equal to another result.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.equal_indices" href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.equal_indices">equal_indices</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if the indices are equal between two results.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.has_conflict" href="#presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.has_conflict">has_conflict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if two recognizer results are conflicted or not.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/entities/image_recognizer_result.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageRecognizerResult</span><span class="p">(</span><span class="n">RecognizerResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ImageRecognizerResult represents the results of analysing the image.</span>

<span class="sd">    :param entity_type: the type of the entity</span>
<span class="sd">    :param start: the start location of the detected entity in the text</span>
<span class="sd">    :param end: the end location of the detected entity in the text</span>
<span class="sd">    :param score: the score of the detection</span>
<span class="sd">    :param left: x coord of the top left corner of the bbox in pixels</span>
<span class="sd">    :param top: y coord of the top left corner of the bbox in pixels</span>
<span class="sd">    :param width: width of the bbox in pixels</span>
<span class="sd">    :param height: height of the bbox in pixels</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">score</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">top</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check two ImageRecognizerResult objects are equal by using all class fields.</span>

<span class="sd">        :param other: another ImageRecognizerResult object</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">equal_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">entity_type</span>
        <span class="n">equal_pos</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
        <span class="n">equal_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">score</span>
        <span class="n">equal_box1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">left</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="n">equal_box2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="n">equal_box</span> <span class="o">=</span> <span class="n">equal_box1</span> <span class="ow">and</span> <span class="n">equal_box2</span>
        <span class="k">return</span> <span class="n">equal_type</span> <span class="ow">and</span> <span class="n">equal_pos</span> <span class="ow">and</span> <span class="n">equal_score</span> <span class="ow">and</span> <span class="n">equal_box</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representation of the instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_type</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;start: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;end: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;score: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;left: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;top: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;width: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;height: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h6 id="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.append_analysis_explanation_text" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">append_analysis_explanation_text</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">append_analysis_explanation_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add text to the analysis explanation.</p>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">append_analysis_explanation_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add text to the analysis explanation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_explanation</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_explanation</span><span class="o">.</span><span class="n">append_textual_explanation_line</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h6 id="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.to_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">to_dict</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_dict</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Serialize self to dictionary.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Dict">Dict</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialize self to dictionary.</span>

<span class="sd">    :return: a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h6 id="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.from_json" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">from_json</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">from_json</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecognizerResult</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create RecognizerResult from json.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>e.g. { "start": 24, "end": 32, "score": 0.8, "entity_type": "NAME" }</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="presidio_analyzer.recognizer_result.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>RecognizerResult</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create RecognizerResult from json.</span>

<span class="sd">    :param data: e.g. {</span>
<span class="sd">        &quot;start&quot;: 24,</span>
<span class="sd">        &quot;end&quot;: 32,</span>
<span class="sd">        &quot;score&quot;: 0.8,</span>
<span class="sd">        &quot;entity_type&quot;: &quot;NAME&quot;</span>
<span class="sd">    }</span>
<span class="sd">    :return: RecognizerResult</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">)</span>
    <span class="n">entity_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entity_type&quot;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h6 id="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.intersects" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">intersects</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if self intersects with a different RecognizerResult.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>int</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>If intersecting, returns the number of intersecting characters. If not, returns 0</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if self intersects with a different RecognizerResult.</span>

<span class="sd">    :return: If intersecting, returns the number of</span>
<span class="sd">    intersecting characters.</span>
<span class="sd">    If not, returns 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if they do not overlap the intersection is 0</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># otherwise the intersection is min(end) - max(start)</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span><span class="p">)</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h6 id="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contained_in" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">contained_in</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">contained_in</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if self is contained in a different RecognizerResult.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>true if contained</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">contained_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if self is contained in a different RecognizerResult.</span>

<span class="sd">    :return: true if contained</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h6 id="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.contains" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">contains</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">contains</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if one result is contained or equal to another result.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>another RecognizerResult</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_analyzer.recognizer_result.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if one result is contained or equal to another result.</span>

<span class="sd">    :param other: another RecognizerResult</span>
<span class="sd">    :return: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h6 id="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.equal_indices" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">equal_indices</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">equal_indices</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the indices are equal between two results.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>another RecognizerResult</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_analyzer.recognizer_result.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">equal_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the indices are equal between two results.</span>

<span class="sd">    :param other: another RecognizerResult</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h6 id="presidio_image_redactor.entities.image_recognizer_result.ImageRecognizerResult.has_conflict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">has_conflict</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">has_conflict</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if two recognizer results are conflicted or not.</p>
<p>I have a conflict if:
1. My indices are the same as the other and my score is lower.
2. If my indices are contained in another.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>RecognizerResult</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_analyzer.recognizer_result.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_conflict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if two recognizer results are conflicted or not.</span>

<span class="sd">    I have a conflict if:</span>
<span class="sd">    1. My indices are the same as the other and my score is lower.</span>
<span class="sd">    2. If my indices are contained in another.</span>

<span class="sd">    :param other: RecognizerResult</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">equal_indices</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">score</span>
    <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h4 id="presidio_image_redactor.entities.api_request_convertor" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">api_request_convertor</span>


</h4>

    <div class="doc doc-contents ">







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">FUNCTION</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.api_request_convertor.get_json_data" href="#presidio_image_redactor.entities.api_request_convertor.get_json_data">get_json_data</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Validate incoming json.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.api_request_convertor.color_fill_string_to_value" href="#presidio_image_redactor.entities.api_request_convertor.color_fill_string_to_value">color_fill_string_to_value</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Get color_fill and checks it is valid for image redaction.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.api_request_convertor.image_to_byte_array" href="#presidio_image_redactor.entities.api_request_convertor.image_to_byte_array">image_to_byte_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Get an image and return a byte array.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>




  <div class="doc doc-children">











<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.api_request_convertor.get_json_data" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_json_data</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_json_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate incoming json.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>json with added values for image redaction. For now, {"color_fill":"1,1,1"}</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/entities/api_request_convertor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_json_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate incoming json.</span>

<span class="sd">    :param data: json with added values for image redaction.</span>
<span class="sd">    For now, {&quot;color_fill&quot;:&quot;1,1,1&quot;}</span>
<span class="sd">    :return: dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed to parse json from string &#39;</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&#39; with error </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">InvalidParamError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid json format &#39;</span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.api_request_convertor.color_fill_string_to_value" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">color_fill_string_to_value</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">color_fill_string_to_value</span><span class="p">(</span>
    <span class="n">json_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get color_fill and checks it is valid for image redaction.</p>
<p>color_fill can be an int or Tuple[int, int, int] of (R, G, B)</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>json_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>{"color_fill":"1,1,1"}</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Union">Union</span>[int, <span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>int or Tuple[int, int, int]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/entities/api_request_convertor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">color_fill_string_to_value</span><span class="p">(</span><span class="n">json_params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get color_fill and checks it is valid for image redaction.</span>

<span class="sd">    color_fill can be an int or Tuple[int, int, int] of (R, G, B)</span>
<span class="sd">    :param json_params: {&quot;color_fill&quot;:&quot;1,1,1&quot;}</span>
<span class="sd">    :return: int or Tuple[int, int, int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filling_str</span> <span class="o">=</span> <span class="n">json_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color_fill&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filling_str</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">filling_str_split</span> <span class="o">=</span> <span class="n">filling_str</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filling_str_split</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">filling_str_split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filling_str_split</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidParamError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid color fill &#39;</span><span class="si">{</span><span class="n">filling_str</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">filling_str_split</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed to color fill &#39;</span><span class="si">{</span><span class="n">filling_str</span><span class="si">}</span><span class="s2">&#39; with error </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">InvalidParamError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid color fill &#39;</span><span class="si">{</span><span class="n">filling_str</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.api_request_convertor.image_to_byte_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">image_to_byte_array</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">image_to_byte_array</span><span class="p">(</span><span class="n">redacted_image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span> <span class="n">image_format</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get an image and return a byte array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>redacted_image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the image which was redacted</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_format</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the format of the original image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/entities/api_request_convertor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">image_to_byte_array</span><span class="p">(</span><span class="n">redacted_image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span> <span class="n">image_format</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get an image and return a byte array.</span>

<span class="sd">    :param redacted_image: the image which was redacted</span>
<span class="sd">    :param image_format: the format of the original image.</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">img_byte_arr</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">redacted_image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">img_byte_arr</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">image_format</span><span class="p">)</span>
    <span class="n">img_byte_arr</span> <span class="o">=</span> <span class="n">img_byte_arr</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">img_byte_arr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-module">



<h4 id="presidio_image_redactor.entities.invalid_exception" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">invalid_exception</span>


</h4>

    <div class="doc doc-contents ">

        <p>Exception to indicate the request we received is invalid.</p>









  <div class="doc doc-children">







<div class="doc doc-object doc-class">



<h5 id="presidio_image_redactor.entities.invalid_exception.InvalidParamError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">InvalidParamError</span>


</h5>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Exception</code></p>


        <p>Throw exception with error when user input is not valid.</p>







              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/entities/invalid_exception.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InvalidParamError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Throw exception with error when user input is not valid.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">err_msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.entities.ImageRecognizerResult" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImageRecognizerResult</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_analyzer.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code></p>


        <p>ImageRecognizerResult represents the results of analysing the image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>entity_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the type of the entity</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the start location of the detected entity in the text</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the end location of the detected entity in the text</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the score of the detection</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>left</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>x coord of the top left corner of the bbox in pixels</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>y coord of the top left corner of the bbox in pixels</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>width of the bbox in pixels</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>height of the bbox in pixels</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult.append_analysis_explanation_text" href="#presidio_image_redactor.entities.ImageRecognizerResult.append_analysis_explanation_text">append_analysis_explanation_text</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Add text to the analysis explanation.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult.to_dict" href="#presidio_image_redactor.entities.ImageRecognizerResult.to_dict">to_dict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Serialize self to dictionary.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult.from_json" href="#presidio_image_redactor.entities.ImageRecognizerResult.from_json">from_json</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Create RecognizerResult from json.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult.intersects" href="#presidio_image_redactor.entities.ImageRecognizerResult.intersects">intersects</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if self intersects with a different RecognizerResult.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult.contained_in" href="#presidio_image_redactor.entities.ImageRecognizerResult.contained_in">contained_in</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if self is contained in a different RecognizerResult.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult.contains" href="#presidio_image_redactor.entities.ImageRecognizerResult.contains">contains</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if one result is contained or equal to another result.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult.equal_indices" href="#presidio_image_redactor.entities.ImageRecognizerResult.equal_indices">equal_indices</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if the indices are equal between two results.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult.has_conflict" href="#presidio_image_redactor.entities.ImageRecognizerResult.has_conflict">has_conflict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Check if two recognizer results are conflicted or not.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/entities/image_recognizer_result.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageRecognizerResult</span><span class="p">(</span><span class="n">RecognizerResult</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ImageRecognizerResult represents the results of analysing the image.</span>

<span class="sd">    :param entity_type: the type of the entity</span>
<span class="sd">    :param start: the start location of the detected entity in the text</span>
<span class="sd">    :param end: the end location of the detected entity in the text</span>
<span class="sd">    :param score: the score of the detection</span>
<span class="sd">    :param left: x coord of the top left corner of the bbox in pixels</span>
<span class="sd">    :param top: y coord of the top left corner of the bbox in pixels</span>
<span class="sd">    :param width: width of the bbox in pixels</span>
<span class="sd">    :param height: height of the bbox in pixels</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">entity_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">start</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">end</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">score</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">left</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">top</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">height</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">=</span> <span class="n">left</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">top</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check two ImageRecognizerResult objects are equal by using all class fields.</span>

<span class="sd">        :param other: another ImageRecognizerResult object</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">equal_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">entity_type</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">entity_type</span>
        <span class="n">equal_pos</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span><span class="p">)</span>
        <span class="n">equal_score</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">score</span>
        <span class="n">equal_box1</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">left</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
        <span class="n">equal_box2</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
        <span class="n">equal_box</span> <span class="o">=</span> <span class="n">equal_box1</span> <span class="ow">and</span> <span class="n">equal_box2</span>
        <span class="k">return</span> <span class="n">equal_type</span> <span class="ow">and</span> <span class="n">equal_pos</span> <span class="ow">and</span> <span class="n">equal_score</span> <span class="ow">and</span> <span class="n">equal_box</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a string representation of the instance.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;type: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_type</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;start: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;end: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;score: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">score</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;left: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">left</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;top: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;width: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="si">}</span><span class="s2">, &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;height: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.ImageRecognizerResult.append_analysis_explanation_text" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">append_analysis_explanation_text</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">append_analysis_explanation_text</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add text to the analysis explanation.</p>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">append_analysis_explanation_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add text to the analysis explanation.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_explanation</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_explanation</span><span class="o">.</span><span class="n">append_textual_explanation_line</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.ImageRecognizerResult.to_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">to_dict</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">to_dict</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Serialize self to dictionary.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Dict">Dict</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>a dictionary</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialize self to dictionary.</span>

<span class="sd">    :return: a dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.ImageRecognizerResult.from_json" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">from_json</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">from_json</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RecognizerResult</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create RecognizerResult from json.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>e.g. { "start": 24, "end": 32, "score": 0.8, "entity_type": "NAME" }</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><a class="autorefs autorefs-internal" title="presidio_analyzer.recognizer_result.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>RecognizerResult</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_json</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create RecognizerResult from json.</span>

<span class="sd">    :param data: e.g. {</span>
<span class="sd">        &quot;start&quot;: 24,</span>
<span class="sd">        &quot;end&quot;: 32,</span>
<span class="sd">        &quot;score&quot;: 0.8,</span>
<span class="sd">        &quot;entity_type&quot;: &quot;NAME&quot;</span>
<span class="sd">    }</span>
<span class="sd">    :return: RecognizerResult</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;score&quot;</span><span class="p">)</span>
    <span class="n">entity_type</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;entity_type&quot;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.ImageRecognizerResult.intersects" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">intersects</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">intersects</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if self intersects with a different RecognizerResult.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>int</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>If intersecting, returns the number of intersecting characters. If not, returns 0</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">intersects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if self intersects with a different RecognizerResult.</span>

<span class="sd">    :return: If intersecting, returns the number of</span>
<span class="sd">    intersecting characters.</span>
<span class="sd">    If not, returns 0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if they do not overlap the intersection is 0</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

    <span class="c1"># otherwise the intersection is min(end) - max(start)</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span><span class="p">)</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.ImageRecognizerResult.contained_in" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">contained_in</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">contained_in</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if self is contained in a different RecognizerResult.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>true if contained</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">contained_in</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if self is contained in a different RecognizerResult.</span>

<span class="sd">    :return: true if contained</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.ImageRecognizerResult.contains" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">contains</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">contains</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if one result is contained or equal to another result.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>another RecognizerResult</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_analyzer.recognizer_result.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>bool</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if one result is contained or equal to another result.</span>

<span class="sd">    :param other: another RecognizerResult</span>
<span class="sd">    :return: bool</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.ImageRecognizerResult.equal_indices" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">equal_indices</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">equal_indices</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the indices are equal between two results.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>another RecognizerResult</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_analyzer.recognizer_result.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">equal_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if the indices are equal between two results.</span>

<span class="sd">    :param other: another RecognizerResult</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">start</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h5 id="presidio_image_redactor.entities.ImageRecognizerResult.has_conflict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">has_conflict</span>


</h5>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">has_conflict</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="n">RecognizerResult</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if two recognizer results are conflicted or not.</p>
<p>I have a conflict if:
1. My indices are the same as the other and my score is lower.
2. If my indices are contained in another.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>other</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>RecognizerResult</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_analyzer.recognizer_result.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>bool</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_analyzer/recognizer_result.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">has_conflict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="s2">&quot;RecognizerResult&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check if two recognizer results are conflicted or not.</span>

<span class="sd">    I have a conflict if:</span>
<span class="sd">    1. My indices are the same as the other and my score is lower.</span>
<span class="sd">    2. If my indices are contained in another.</span>

<span class="sd">    :param other: RecognizerResult</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">equal_indices</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">score</span> <span class="o">&lt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">score</span>
    <span class="k">return</span> <span class="n">other</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h4 id="presidio_image_redactor.entities.InvalidParamError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">InvalidParamError</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>Exception</code></p>


        <p>Throw exception with error when user input is not valid.</p>







              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/entities/invalid_exception.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">InvalidParamError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Throw exception with error when user input is not valid.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">err_msg</span> <span class="o">=</span> <span class="n">msg</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">err_msg</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





  </div>

    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.OCR" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">OCR</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="abc.ABC">ABC</span></code></p>


        <p>OCR class that performs OCR on a given image.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.OCR.perform_ocr" href="#presidio_image_redactor.OCR.perform_ocr">perform_ocr</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Perform OCR on a given image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.OCR.get_text_from_ocr_dict" href="#presidio_image_redactor.OCR.get_text_from_ocr_dict">get_text_from_ocr_dict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Combine the text from the OCR dict to full text.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">OCR</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OCR class that performs OCR on a given image.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform OCR on a given image.</span>

<span class="sd">        :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">        :param kwargs: Additional values for perform OCR method</span>

<span class="sd">        :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Combine the text from the OCR dict to full text.</span>

<span class="sd">        :param ocr_result: dictionary containing the ocr results per word</span>
<span class="sd">        :param separator: separator to use when joining the words</span>

<span class="sd">        return: str containing the full extracted text as string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_result</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.OCR.perform_ocr" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_ocr</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform OCR on a given image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image/numpy array or file path(str) to be processed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>object</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for perform OCR method</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>results dictionary containing bboxes and text for each detected word</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform OCR on a given image.</span>

<span class="sd">    :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">    :param kwargs: Additional values for perform OCR method</span>

<span class="sd">    :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.OCR.get_text_from_ocr_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_text_from_ocr_dict</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Combine the text from the OCR dict to full text.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dictionary containing the ocr results per word</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>separator to use when joining the words  return: str containing the full extracted text as string</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39; &#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the text from the OCR dict to full text.</span>

<span class="sd">    :param ocr_result: dictionary containing the ocr results per word</span>
<span class="sd">    :param separator: separator to use when joining the words</span>

<span class="sd">    return: str containing the full extracted text as string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_result</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.TesseractOCR" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">TesseractOCR</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.OCR" href="#presidio_image_redactor.OCR">OCR</a></code></p>


        <p>OCR class that performs OCR on a given image.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.TesseractOCR.get_text_from_ocr_dict" href="#presidio_image_redactor.TesseractOCR.get_text_from_ocr_dict">get_text_from_ocr_dict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Combine the text from the OCR dict to full text.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.TesseractOCR.perform_ocr" href="#presidio_image_redactor.TesseractOCR.perform_ocr">perform_ocr</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Perform OCR on a given image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/tesseract_ocr.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TesseractOCR</span><span class="p">(</span><span class="n">OCR</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OCR class that performs OCR on a given image.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform OCR on a given image.</span>

<span class="sd">        :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">        :param kwargs: Additional values for OCR image_to_data</span>

<span class="sd">        :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_type</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">DICT</span>
        <span class="k">return</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_data</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">output_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.TesseractOCR.get_text_from_ocr_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_text_from_ocr_dict</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Combine the text from the OCR dict to full text.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dictionary containing the ocr results per word</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>separator to use when joining the words  return: str containing the full extracted text as string</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39; &#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the text from the OCR dict to full text.</span>

<span class="sd">    :param ocr_result: dictionary containing the ocr results per word</span>
<span class="sd">    :param separator: separator to use when joining the words</span>

<span class="sd">    return: str containing the full extracted text as string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_result</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.TesseractOCR.perform_ocr" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_ocr</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform OCR on a given image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image/numpy array or file path(str) to be processed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>object</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for OCR image_to_data</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>results dictionary containing bboxes and text for each detected word</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/tesseract_ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform OCR on a given image.</span>

<span class="sd">    :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">    :param kwargs: Additional values for OCR image_to_data</span>

<span class="sd">    :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output_type</span> <span class="o">=</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">Output</span><span class="o">.</span><span class="n">DICT</span>
    <span class="k">return</span> <span class="n">pytesseract</span><span class="o">.</span><span class="n">image_to_data</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="n">output_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.DocumentIntelligenceOCR" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DocumentIntelligenceOCR</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.OCR" href="#presidio_image_redactor.OCR">OCR</a></code></p>


        <p>OCR class that uses Azure AI Document Intelligence OCR engine.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The API key</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>endpoint</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The API endpoint</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_id</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Which model to use  For details, see https://learn.microsoft.com/en-us/azure/ai-services/document-intelligence/</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[str]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;prebuilt-document&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DocumentIntelligenceOCR.get_text_from_ocr_dict" href="#presidio_image_redactor.DocumentIntelligenceOCR.get_text_from_ocr_dict">get_text_from_ocr_dict</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Combine the text from the OCR dict to full text.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DocumentIntelligenceOCR.get_imgbytes" href="#presidio_image_redactor.DocumentIntelligenceOCR.get_imgbytes">get_imgbytes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Retrieve the image bytes from the image object.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DocumentIntelligenceOCR.analyze_document" href="#presidio_image_redactor.DocumentIntelligenceOCR.analyze_document">analyze_document</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Analyze the document and return the result.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DocumentIntelligenceOCR.perform_ocr" href="#presidio_image_redactor.DocumentIntelligenceOCR.perform_ocr">perform_ocr</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Perform OCR on the image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/document_intelligence_ocr.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DocumentIntelligenceOCR</span><span class="p">(</span><span class="n">OCR</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;OCR class that uses Azure AI Document Intelligence OCR engine.</span>

<span class="sd">    :param key: The API key</span>
<span class="sd">    :param endpoint: The API endpoint</span>
<span class="sd">    :param model_id: Which model to use</span>

<span class="sd">    For details, see</span>
<span class="sd">    https://learn.microsoft.com/en-us/azure/ai-services/document-intelligence/</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">SUPPORTED_MODELS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;prebuilt-document&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-read&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-layout&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-contract&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-healthInsuranceCard.us&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-invoice&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-receipt&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-idDocument&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prebuilt-businessCard&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">endpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">model_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;prebuilt-document&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">model_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DocumentIntelligenceOCR</span><span class="o">.</span><span class="n">SUPPORTED_MODELS</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported model id: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">model_id</span><span class="p">)</span>

        <span class="c1"># If endpoint and/or key are not passed, attempt to get from environment</span>
        <span class="c1"># variables</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DOCUMENT_INTELLIGENCE_ENDPOINT&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DOCUMENT_INTELLIGENCE_KEY&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">endpoint</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Endpoint and key must be specified&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">DocumentAnalysisClient</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="o">=</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">credential</span><span class="o">=</span><span class="n">AzureKeyCredential</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_id</span> <span class="o">=</span> <span class="n">model_id</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_polygon_to_bbox</span><span class="p">(</span><span class="n">polygon</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Point</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert polygon to a tuple of left/top/width/height.</span>

<span class="sd">        The returned bounding box should entirely cover the passed polygon.</span>

<span class="sd">        :param polygon: A sequence of points</span>

<span class="sd">        :return a tuple of left/top/width/height in pixel dimensions</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># We need at least two points for a valid bounding box.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">polygon</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="n">left</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span>
        <span class="n">top</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span>
        <span class="n">right</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">])</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">right</span> <span class="o">-</span> <span class="n">left</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">bottom</span> <span class="o">-</span> <span class="n">top</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_page_to_bboxes</span><span class="p">(</span><span class="n">page</span><span class="p">:</span> <span class="n">DocumentPage</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert bounding boxes to uniform format.</span>

<span class="sd">        Presidio supports tesseract format of output only, so we format in the same</span>
<span class="sd">        way.</span>
<span class="sd">        Expected format looks like:</span>
<span class="sd">        {</span>
<span class="sd">            &quot;left&quot;: [123, 345],</span>
<span class="sd">            &quot;top&quot;: [0, 15],</span>
<span class="sd">            &quot;width&quot;: [100, 75],</span>
<span class="sd">            &quot;height&quot;: [25, 30],</span>
<span class="sd">            &quot;conf&quot;: [&quot;1&quot;, &quot;0.87&quot;],</span>
<span class="sd">            &quot;text&quot;: [&quot;JOHN&quot;, &quot;DOE&quot;],</span>
<span class="sd">        }</span>

<span class="sd">        :param page: The documentpage object from the DI client library</span>

<span class="sd">        :return dictionary in the expected format for presidio</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">DocumentIntelligenceOCR</span><span class="o">.</span><span class="n">_polygon_to_bbox</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">polygon</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">words</span>
        <span class="p">]</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">],</span>
            <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">],</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">],</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">],</span>
            <span class="s2">&quot;conf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">confidence</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">words</span><span class="p">],</span>
            <span class="s2">&quot;text&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">content</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">words</span><span class="p">],</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">get_imgbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve the image bytes from the image object.</span>

<span class="sd">        :param image:  Any of bytes/numpy array /PIL image object</span>

<span class="sd">        :return raw image bytes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">image</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
            <span class="c1"># Fallthrough to process PIL image</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
            <span class="c1"># Image is a PIL image, write to bytes stream</span>
            <span class="n">ostream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ostream</span><span class="p">,</span> <span class="s2">&quot;PNG&quot;</span><span class="p">)</span>
            <span class="n">imgbytes</span> <span class="o">=</span> <span class="n">ostream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># image is a filename</span>
            <span class="n">imgbytes</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported image type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">imgbytes</span>

    <span class="k">def</span> <span class="nf">analyze_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgbytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalyzedDocument</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze the document and return the result.</span>

<span class="sd">        :param imgbytes: The bytes to send to the API endpoint</span>
<span class="sd">        :param kwargs: additional arguments for begin_analyze_document</span>

<span class="sd">        :return the result of the poller, an AnalyzedDocument object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">poller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">begin_analyze_document</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">imgbytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">poller</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform OCR on the image.</span>

<span class="sd">        :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">        :param kwargs: Additional values for begin_analyze_document</span>

<span class="sd">        :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">imgbytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_imgbytes</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_document</span><span class="p">(</span><span class="n">imgbytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># Currently cannot handle more than one page.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">pages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DocumentIntelligenceOCR only supports 1 page documents&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">DocumentIntelligenceOCR</span><span class="o">.</span><span class="n">_page_to_bboxes</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DocumentIntelligenceOCR.get_text_from_ocr_dict" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_text_from_ocr_dict</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Combine the text from the OCR dict to full text.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dictionary containing the ocr results per word</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>separator</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>separator to use when joining the words  return: str containing the full extracted text as string</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39; &#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">separator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Combine the text from the OCR dict to full text.</span>

<span class="sd">    :param ocr_result: dictionary containing the ocr results per word</span>
<span class="sd">    :param separator: separator to use when joining the words</span>

<span class="sd">    return: str containing the full extracted text as string</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_result</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">separator</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DocumentIntelligenceOCR.get_imgbytes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_imgbytes</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_imgbytes</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Retrieve the image bytes from the image object.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Any of bytes/numpy array /PIL image object</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[bytes, <span title="numpy.ndarray">ndarray</span>, <span title="PIL.Image.Image">Image</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/document_intelligence_ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_imgbytes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve the image bytes from the image object.</span>

<span class="sd">    :param image:  Any of bytes/numpy array /PIL image object</span>

<span class="sd">    :return raw image bytes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">image</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="c1"># Fallthrough to process PIL image</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
        <span class="c1"># Image is a PIL image, write to bytes stream</span>
        <span class="n">ostream</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">image</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">ostream</span><span class="p">,</span> <span class="s2">&quot;PNG&quot;</span><span class="p">)</span>
        <span class="n">imgbytes</span> <span class="o">=</span> <span class="n">ostream</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># image is a filename</span>
        <span class="n">imgbytes</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported image type: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">imgbytes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DocumentIntelligenceOCR.analyze_document" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">analyze_document</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">analyze_document</span><span class="p">(</span><span class="n">imgbytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalyzedDocument</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Analyze the document and return the result.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>imgbytes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The bytes to send to the API endpoint</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bytes</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>additional arguments for begin_analyze_document</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/document_intelligence_ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">analyze_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">imgbytes</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AnalyzedDocument</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyze the document and return the result.</span>

<span class="sd">    :param imgbytes: The bytes to send to the API endpoint</span>
<span class="sd">    :param kwargs: additional arguments for begin_analyze_document</span>

<span class="sd">    :return the result of the poller, an AnalyzedDocument object.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">poller</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">begin_analyze_document</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_id</span><span class="p">,</span> <span class="n">imgbytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">poller</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DocumentIntelligenceOCR.perform_ocr" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_ocr</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform OCR on the image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image/numpy array or file path(str) to be processed</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>object</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for begin_analyze_document</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>results dictionary containing bboxes and text for each detected word</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/document_intelligence_ocr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_ocr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform OCR on the image.</span>

<span class="sd">    :param image: PIL Image/numpy array or file path(str) to be processed</span>
<span class="sd">    :param kwargs: Additional values for begin_analyze_document</span>

<span class="sd">    :return: results dictionary containing bboxes and text for each detected word</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">imgbytes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_imgbytes</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_document</span><span class="p">(</span><span class="n">imgbytes</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="c1"># Currently cannot handle more than one page.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">pages</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;DocumentIntelligenceOCR only supports 1 page documents&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">DocumentIntelligenceOCR</span><span class="o">.</span><span class="n">_page_to_bboxes</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">pages</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.BboxProcessor" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">BboxProcessor</span>


</h3>


    <div class="doc doc-contents ">


        <p>Common module for general bounding box operators.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.BboxProcessor.get_bboxes_from_ocr_results" href="#presidio_image_redactor.BboxProcessor.get_bboxes_from_ocr_results">get_bboxes_from_ocr_results</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Get bounding boxes on padded image for all detected words from ocr_results.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.BboxProcessor.get_bboxes_from_analyzer_results" href="#presidio_image_redactor.BboxProcessor.get_bboxes_from_analyzer_results">get_bboxes_from_analyzer_results</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Organize bounding box info from analyzer results.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.BboxProcessor.remove_bbox_padding" href="#presidio_image_redactor.BboxProcessor.remove_bbox_padding">remove_bbox_padding</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Remove added padding in bounding box coordinates.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.BboxProcessor.match_with_source" href="#presidio_image_redactor.BboxProcessor.match_with_source">match_with_source</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Match returned redacted PII bbox data with some source of truth for PII.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BboxProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Common module for general bounding box operators.&quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_bboxes_from_ocr_results</span><span class="p">(</span>
        <span class="n">ocr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get bounding boxes on padded image for all detected words from ocr_results.</span>

<span class="sd">        :param ocr_results: Raw results from OCR.</span>
<span class="sd">        :return: Bounding box information per word.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])):</span>
            <span class="n">detected_text</span> <span class="o">=</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">detected_text</span><span class="p">:</span>
                <span class="n">bbox</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                    <span class="s2">&quot;conf&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">detected_text</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Organize bounding box info from analyzer results.</span>

<span class="sd">        :param analyzer_results: Results from using ImageAnalyzerEngine.</span>

<span class="sd">        :return: Bounding box info organized.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analyzer_results</span><span class="p">)):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

            <span class="n">bbox_item</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
            <span class="p">}</span>
            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox_item</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_bbox_padding</span><span class="p">(</span>
        <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove added padding in bounding box coordinates.</span>

<span class="sd">        :param analyzer_bboxes: The bounding boxes from analyzer results.</span>
<span class="sd">        :param padding_width: Pixel width used for padding (0 if no padding).</span>

<span class="sd">        :return: Bounding box information per word.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">padding_width</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Padding width must be a non-negative integer.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Get fields</span>
            <span class="n">has_label</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
                <span class="n">has_label</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">has_label</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">_</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]</span>
                <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Remove padding from all bounding boxes</span>
            <span class="k">if</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
                <span class="p">]</span>
            <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
                <span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">match_with_source</span><span class="p">(</span>
        <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">pii_source_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
        <span class="n">detected_pii</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Match returned redacted PII bbox data with some source of truth for PII.</span>

<span class="sd">        :param all_pos: Dictionary storing all positives.</span>
<span class="sd">        :param pii_source_dict: List of PII labels for this instance.</span>
<span class="sd">        :param detected_pii: Detected PII (single entity from analyzer_results).</span>
<span class="sd">        :param tolerance: Tolerance for exact coordinates and size data.</span>
<span class="sd">        :return: List of all positive with PII mapped back as possible</span>
<span class="sd">        and whether a match was found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_pos_match</span> <span class="o">=</span> <span class="n">all_pos</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Get info from detected PII (positive)</span>
        <span class="n">results_left</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
        <span class="n">results_top</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
        <span class="n">results_width</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
        <span class="n">results_height</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">results_score</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="c1"># Handle matching when no score available</span>
            <span class="n">results_score</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">match_found</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># See what in the ground truth this positive matches</span>
        <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">pii_source_dict</span><span class="p">:</span>
            <span class="n">source_left</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
            <span class="n">source_top</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
            <span class="n">source_width</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="n">source_height</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>

            <span class="n">match_left</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_left</span> <span class="o">-</span> <span class="n">results_left</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
            <span class="n">match_top</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_top</span> <span class="o">-</span> <span class="n">results_top</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
            <span class="n">match_width</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_width</span> <span class="o">-</span> <span class="n">results_width</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
            <span class="n">match_height</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_height</span> <span class="o">-</span> <span class="n">results_height</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
            <span class="n">matching</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_left</span><span class="p">,</span> <span class="n">match_top</span><span class="p">,</span> <span class="n">match_width</span><span class="p">,</span> <span class="n">match_height</span><span class="p">]</span>

            <span class="k">if</span> <span class="kc">False</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matching</span><span class="p">:</span>
                <span class="c1"># If match is found, carry over ground truth info</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="n">label</span>
                <span class="n">positive</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_score</span>
                <span class="n">all_pos_match</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">positive</span><span class="p">)</span>
                <span class="n">match_found</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">all_pos_match</span><span class="p">,</span> <span class="n">match_found</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.BboxProcessor.get_bboxes_from_ocr_results" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_bboxes_from_ocr_results</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_bboxes_from_ocr_results</span><span class="p">(</span>
    <span class="n">ocr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get bounding boxes on padded image for all detected words from ocr_results.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_results</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Raw results from OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, <span title="typing.List">List</span>[<span title="typing.Union">Union</span>[int, str]]]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[int, float, str]]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Bounding box information per word.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_bboxes_from_ocr_results</span><span class="p">(</span>
    <span class="n">ocr_results</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get bounding boxes on padded image for all detected words from ocr_results.</span>

<span class="sd">    :param ocr_results: Raw results from OCR.</span>
<span class="sd">    :return: Bounding box information per word.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])):</span>
        <span class="n">detected_text</span> <span class="o">=</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">detected_text</span><span class="p">:</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
                <span class="s2">&quot;conf&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">[</span><span class="s2">&quot;conf&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
                <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">detected_text</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.BboxProcessor.get_bboxes_from_analyzer_results" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_bboxes_from_analyzer_results</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_bboxes_from_analyzer_results</span><span class="p">(</span>
    <span class="n">analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Organize bounding box info from analyzer results.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>analyzer_results</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Results from using ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult" href="#presidio_image_redactor.entities.ImageRecognizerResult">ImageRecognizerResult</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, float, int]]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Bounding box info organized.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_bboxes_from_analyzer_results</span><span class="p">(</span>
    <span class="n">analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Organize bounding box info from analyzer results.</span>

<span class="sd">    :param analyzer_results: Results from using ImageAnalyzerEngine.</span>

<span class="sd">    :return: Bounding box info organized.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">analyzer_results</span><span class="p">)):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">analyzer_results</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>

        <span class="n">bbox_item</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
            <span class="s2">&quot;score&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span>
            <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">],</span>
            <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">],</span>
            <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
            <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bbox_item</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.BboxProcessor.remove_bbox_padding" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">remove_bbox_padding</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">remove_bbox_padding</span><span class="p">(</span>
    <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span> <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Remove added padding in bounding box coordinates.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>analyzer_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The bounding boxes from analyzer results.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, float, int]]]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel width used for padding (0 if no padding).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, int]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Bounding box information per word.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">remove_bbox_padding</span><span class="p">(</span>
    <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove added padding in bounding box coordinates.</span>

<span class="sd">    :param analyzer_bboxes: The bounding boxes from analyzer results.</span>
<span class="sd">    :param padding_width: Pixel width used for padding (0 if no padding).</span>

<span class="sd">    :return: Bounding box information per word.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">padding_width</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Padding width must be a non-negative integer.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Get fields</span>
        <span class="n">has_label</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
            <span class="n">has_label</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">has_label</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]</span>
            <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">has_entity_type</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Remove padding from all bounding boxes</span>
        <span class="k">if</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;entity_type&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">has_label</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">has_entity_type</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;left&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">),</span>
                    <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">],</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span>
            <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="n">analyzer_bboxes</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.BboxProcessor.match_with_source" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">match_with_source</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">match_with_source</span><span class="p">(</span>
    <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">pii_source_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">detected_pii</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Match returned redacted PII bbox data with some source of truth for PII.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>all_pos</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary storing all positives.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int, float]]]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pii_source_dict</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PII labels for this instance.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int, float]]]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>detected_pii</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Detected PII (single entity from analyzer_results).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, float, int]]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tolerance for exact coordinates and size data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>50</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, <span title="typing.Union">Union</span>[str, int, float]]], bool]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of all positive with PII mapped back as possible and whether a match was found.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/bbox.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">match_with_source</span><span class="p">(</span>
    <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">pii_source_dict</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span>
    <span class="n">detected_pii</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]],</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]],</span> <span class="nb">bool</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Match returned redacted PII bbox data with some source of truth for PII.</span>

<span class="sd">    :param all_pos: Dictionary storing all positives.</span>
<span class="sd">    :param pii_source_dict: List of PII labels for this instance.</span>
<span class="sd">    :param detected_pii: Detected PII (single entity from analyzer_results).</span>
<span class="sd">    :param tolerance: Tolerance for exact coordinates and size data.</span>
<span class="sd">    :return: List of all positive with PII mapped back as possible</span>
<span class="sd">    and whether a match was found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_pos_match</span> <span class="o">=</span> <span class="n">all_pos</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># Get info from detected PII (positive)</span>
    <span class="n">results_left</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
    <span class="n">results_top</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
    <span class="n">results_width</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
    <span class="n">results_height</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">results_score</span> <span class="o">=</span> <span class="n">detected_pii</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># Handle matching when no score available</span>
        <span class="n">results_score</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">match_found</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># See what in the ground truth this positive matches</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">pii_source_dict</span><span class="p">:</span>
        <span class="n">source_left</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
        <span class="n">source_top</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
        <span class="n">source_width</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
        <span class="n">source_height</span> <span class="o">=</span> <span class="n">label</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>

        <span class="n">match_left</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_left</span> <span class="o">-</span> <span class="n">results_left</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
        <span class="n">match_top</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_top</span> <span class="o">-</span> <span class="n">results_top</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
        <span class="n">match_width</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_width</span> <span class="o">-</span> <span class="n">results_width</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
        <span class="n">match_height</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">source_height</span> <span class="o">-</span> <span class="n">results_height</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">tolerance</span>
        <span class="n">matching</span> <span class="o">=</span> <span class="p">[</span><span class="n">match_left</span><span class="p">,</span> <span class="n">match_top</span><span class="p">,</span> <span class="n">match_width</span><span class="p">,</span> <span class="n">match_height</span><span class="p">]</span>

        <span class="k">if</span> <span class="kc">False</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">matching</span><span class="p">:</span>
            <span class="c1"># If match is found, carry over ground truth info</span>
            <span class="n">positive</span> <span class="o">=</span> <span class="n">label</span>
            <span class="n">positive</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results_score</span>
            <span class="n">all_pos_match</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">positive</span><span class="p">)</span>
            <span class="n">match_found</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">all_pos_match</span><span class="p">,</span> <span class="n">match_found</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.ImagePreprocessor" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImagePreprocessor</span>


</h3>


    <div class="doc doc-contents ">


        <p>ImagePreprocessor class.</p>
<p>Parent class for image preprocessing objects.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImagePreprocessor.preprocess_image" href="#presidio_image_redactor.ImagePreprocessor.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image to be analyzed.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImagePreprocessor.convert_image_to_array" href="#presidio_image_redactor.ImagePreprocessor.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImagePreprocessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImagePreprocessor class.</span>

<span class="sd">    Parent class for image preprocessing objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ImagePreprocessor class.</span>

<span class="sd">        :param use_greyscale: Whether to convert the image to greyscale.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span> <span class="o">=</span> <span class="n">use_greyscale</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and any metadata regarding the</span>
<span class="sd">             preprocessing approach.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">        :param image: Loaded PIL image.</span>
<span class="sd">        :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">        :return: image pixels as a numpy array.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_bg_color</span><span class="p">(</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select most common color as background color.</span>

<span class="sd">        :param image: Loaded PIL image.</span>
<span class="sd">        :param is_greyscale: Whether the image is greyscale.</span>
<span class="sd">        :param invert: TRUE if you want to get the inverse of the bg color.</span>

<span class="sd">        :return: Background color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Invert colors if invert flag is True</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;RGBA&quot;</span><span class="p">:</span>
                <span class="c1"># Handle transparency as needed</span>
                <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">rgb_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">inverted_image</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">ImageOps</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">rgb_image</span><span class="p">)</span>
                <span class="n">r2</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">inverted_image</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">ImageOps</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Get background color</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="c1"># Select most common color as color</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span><span class="o">.</span><span class="n">argmax</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Reduce size of image to 1 pixel to get dominant color</span>
            <span class="n">tmp_image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tmp_image</span> <span class="o">=</span> <span class="n">tmp_image</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">resample</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="n">tmp_image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">bg_color</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compute the contrast level and mean intensity of an image.</span>

<span class="sd">        :param image: Input image pixels (as a numpy array).</span>

<span class="sd">        :return: A tuple containing the contrast level and mean intensity of the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contrast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">mean_intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contrast</span><span class="p">,</span> <span class="n">mean_intensity</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImagePreprocessor.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image to be analyzed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and any metadata regarding the preprocessing approach.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and any metadata regarding the</span>
<span class="sd">         preprocessing approach.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImagePreprocessor.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.ImageAnalyzerEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImageAnalyzerEngine</span>


</h3>


    <div class="doc doc-contents ">


        <p>ImageAnalyzerEngine class.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>analyzer_engine</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The Presidio AnalyzerEngine instance to be used to detect PII in text</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.AnalyzerEngine" href="../analyzer_python/#presidio_analyzer.AnalyzerEngine">AnalyzerEngine</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>the OCR object to be used to detect text in images.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="presidio_image_redactor.OCR" href="#presidio_image_redactor.OCR">OCR</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_preprocessor</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The ImagePreprocessor object to be used to preprocess the image</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="presidio_image_redactor.ImagePreprocessor" href="#presidio_image_redactor.ImagePreprocessor">ImagePreprocessor</a>]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine.analyze" href="#presidio_image_redactor.ImageAnalyzerEngine.analyze">analyze</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Analyse method to analyse the given image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine.threshold_ocr_result" href="#presidio_image_redactor.ImageAnalyzerEngine.threshold_ocr_result">threshold_ocr_result</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Filter out OCR results below confidence threshold.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine.remove_space_boxes" href="#presidio_image_redactor.ImageAnalyzerEngine.remove_space_boxes">remove_space_boxes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Remove OCR bboxes that are for spaces.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes" href="#presidio_image_redactor.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes">map_analyzer_results_to_bounding_boxes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Map extracted PII entities to image bounding boxes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine.fig2img" href="#presidio_image_redactor.ImageAnalyzerEngine.fig2img">fig2img</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert a Matplotlib figure to a PIL Image and return it.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine.get_pii_bboxes" href="#presidio_image_redactor.ImageAnalyzerEngine.get_pii_bboxes">get_pii_bboxes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Get a list of bboxes with is_PII property.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine.add_custom_bboxes" href="#presidio_image_redactor.ImageAnalyzerEngine.add_custom_bboxes">add_custom_bboxes</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Add custom bounding boxes to image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageAnalyzerEngine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImageAnalyzerEngine class.</span>

<span class="sd">    :param analyzer_engine: The Presidio AnalyzerEngine instance</span>
<span class="sd">        to be used to detect PII in text</span>
<span class="sd">    :param ocr: the OCR object to be used to detect text in images.</span>
<span class="sd">    :param image_preprocessor: The ImagePreprocessor object to be</span>
<span class="sd">        used to preprocess the image</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">analyzer_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnalyzerEngine</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ocr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OCR</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">image_preprocessor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImagePreprocessor</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">analyzer_engine</span><span class="p">:</span>
            <span class="n">analyzer_engine</span> <span class="o">=</span> <span class="n">AnalyzerEngine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analyzer_engine</span> <span class="o">=</span> <span class="n">analyzer_engine</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr</span><span class="p">:</span>
            <span class="n">ocr</span> <span class="o">=</span> <span class="n">TesseractOCR</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span> <span class="o">=</span> <span class="n">ocr</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_preprocessor</span><span class="p">:</span>
            <span class="n">image_preprocessor</span> <span class="o">=</span> <span class="n">ImagePreprocessor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_preprocessor</span> <span class="o">=</span> <span class="n">image_preprocessor</span>

    <span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyse method to analyse the given image.</span>

<span class="sd">        :param image: PIL Image/numpy array or file path(str) to be processed.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: List of the extract entities with image bounding boxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Perform OCR</span>
        <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
        <span class="n">image</span><span class="p">,</span> <span class="n">preprocessing_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_preprocessor</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span><span class="p">)</span>
        <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">preprocessing_metadata</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;scale_factor&quot;</span> <span class="ow">in</span> <span class="n">preprocessing_metadata</span><span class="p">):</span>
            <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_bbox_results</span><span class="p">(</span>
                <span class="n">ocr_result</span><span class="p">,</span> <span class="n">preprocessing_metadata</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Apply OCR confidence threshold if it is passed in</span>
        <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
            <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">)</span>

        <span class="c1"># Analyze text</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>

        <span class="c1"># Difines English as default language, if not specified</span>
        <span class="k">if</span> <span class="s2">&quot;language&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">text_analyzer_kwargs</span><span class="p">:</span>
            <span class="n">text_analyzer_kwargs</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>
        <span class="n">analyzer_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
        <span class="p">)</span>
        <span class="n">allow_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_allow_list</span><span class="p">(</span><span class="n">text_analyzer_kwargs</span><span class="p">)</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
            <span class="n">analyzer_result</span><span class="p">,</span> <span class="n">ocr_result</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">allow_list</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Filter out OCR results below confidence threshold.</span>

<span class="sd">        :param ocr_result: OCR results (raw).</span>
<span class="sd">        :param ocr_threshold: Threshold value between -1 and 100.</span>

<span class="sd">        :return: OCR results with low confidence items removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ocr_threshold</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ocr_threshold</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ocr_threshold must be between -1 and 100&quot;</span><span class="p">)</span>

        <span class="c1"># Get indices of items above threshold</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;conf&quot;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ocr_threshold</span><span class="p">:</span>
                <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Only retain high confidence items</span>
        <span class="n">filtered_ocr_result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">filtered_ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">filtered_ocr_result</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove OCR bboxes that are for spaces.</span>

<span class="sd">        :param ocr_result: OCR results (raw or thresholded).</span>
<span class="sd">        :return: OCR results with empty words removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get indices of items with no text</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]):</span>
            <span class="n">is_not_space</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">is_not_space</span><span class="p">:</span>
                <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

        <span class="c1"># Only retain items with text</span>
        <span class="n">filtered_ocr_result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="n">filtered_ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">filtered_ocr_result</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
        <span class="n">text_analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RecognizerResult</span><span class="p">],</span>
        <span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">allow_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Map extracted PII entities to image bounding boxes.</span>

<span class="sd">        Matching is based on the position of the recognized entity from analyzer</span>
<span class="sd">        and word (in ocr dict) in the text.</span>

<span class="sd">        :param text_analyzer_results: PII entities recognized by presidio analyzer</span>
<span class="sd">        :param ocr_result: dict results with words and bboxes from OCR</span>
<span class="sd">        :param text: text the results are based on</span>
<span class="sd">        :param allow_list: List of words to not redact</span>

<span class="sd">        return: list of extracted entities with image bounding boxes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ocr_result</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">text_analyzer_results</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">proc_indexes</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">indexes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_analyzer_results</span><span class="p">)</span>

        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">iter_ocr</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">iter_ocr</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">text_analyzer_results</span><span class="p">:</span>
                    <span class="n">text_element</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">start</span> <span class="p">:</span> <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">]</span>
                    <span class="c1"># check position and text of ocr word matches recognized entity</span>
                    <span class="k">if</span> <span class="p">(</span>
                        <span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
                    <span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">text_element</span> <span class="ow">in</span> <span class="n">word</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">text_element</span><span class="p">)):</span>
                        <span class="n">yes_make_bbox_for_word</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="p">(</span><span class="n">word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
                            <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_list</span><span class="p">)</span>
                        <span class="p">)</span>
                        <span class="c1"># Do not add bbox for standalone spaces / empty strings</span>
                        <span class="k">if</span> <span class="n">yes_make_bbox_for_word</span><span class="p">:</span>
                            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                <span class="n">ImageRecognizerResult</span><span class="p">(</span>
                                    <span class="n">element</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
                                    <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                    <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                                    <span class="n">element</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                                    <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                    <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                    <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                    <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                <span class="p">)</span>
                            <span class="p">)</span>

                            <span class="c1"># add bounding boxes for all words in ocr dict</span>
                            <span class="c1"># contained within the text of recognized entity</span>
                            <span class="c1"># based on relative position in the full text</span>
                            <span class="k">while</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                                <span class="n">prev_word</span> <span class="o">=</span> <span class="n">word</span>
                                <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iter_ocr</span><span class="p">)</span>
                                <span class="n">yes_make_bbox_for_word</span> <span class="o">=</span> <span class="p">(</span>
                                    <span class="p">(</span><span class="n">word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                                    <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                                    <span class="ow">and</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
                                    <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_list</span><span class="p">)</span>
                                <span class="p">)</span>
                                <span class="k">if</span> <span class="n">yes_make_bbox_for_word</span><span class="p">:</span>
                                    <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                        <span class="n">ImageRecognizerResult</span><span class="p">(</span>
                                            <span class="n">element</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
                                            <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                            <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                                            <span class="n">element</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                                            <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                            <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                            <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                            <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev_word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                            <span class="n">proc_indexes</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="k">if</span> <span class="n">proc_indexes</span> <span class="o">==</span> <span class="n">indexes</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_scale_bbox_results</span><span class="p">(</span>
        <span class="n">ocr_result</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]],</span> <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Scale down the bounding box results based on a scale percentage.</span>

<span class="sd">        :param ocr_result: OCR results (raw).</span>
<span class="sd">        :param scale_percent: Scale percentage for resizing the bounding box.</span>

<span class="sd">        :return: OCR results (scaled).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">scaled_results</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>
        <span class="n">coordinate_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">]</span>
        <span class="n">dimension_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">coord_key</span> <span class="ow">in</span> <span class="n">coordinate_keys</span><span class="p">:</span>
            <span class="n">scaled_results</span><span class="p">[</span><span class="n">coord_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">((</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale_factor</span><span class="p">)))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scaled_results</span><span class="p">[</span><span class="n">coord_key</span><span class="p">]</span>
            <span class="p">]</span>

        <span class="k">for</span> <span class="n">dim_key</span> <span class="ow">in</span> <span class="n">dimension_keys</span><span class="p">:</span>
            <span class="n">scaled_results</span><span class="p">[</span><span class="n">dim_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="n">scale_factor</span><span class="p">))))</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">scaled_results</span><span class="p">[</span><span class="n">dim_key</span><span class="p">]</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="n">scaled_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_bbox_padding</span><span class="p">(</span>
        <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]],</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove added padding in bounding box coordinates.</span>

<span class="sd">        :param analyzer_bboxes: The bounding boxes from analyzer results.</span>
<span class="sd">        :param padding_width: Pixel width used for padding (0 if no padding).</span>

<span class="sd">        :return: Bounding box information per word.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">unpadded_results</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">padding_width</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Padding width must be a non-negative integer.&quot;</span><span class="p">)</span>

        <span class="n">coordinate_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">coord_key</span> <span class="ow">in</span> <span class="n">coordinate_keys</span><span class="p">:</span>
            <span class="n">unpadded_results</span><span class="p">[</span><span class="n">coord_key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">padding_width</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">unpadded_results</span><span class="p">[</span><span class="n">coord_key</span><span class="p">]</span>
            <span class="p">]</span>

        <span class="k">return</span> <span class="n">unpadded_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the OCR-related kwargs.</span>

<span class="sd">        :param ocr_kwargs: Parameters for OCR operations.</span>

<span class="sd">        :return: Params for ocr.perform_ocr and ocr_threshold</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">ocr_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;ocr_threshold&quot;</span> <span class="ow">in</span> <span class="n">ocr_kwargs</span><span class="p">:</span>
                <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="n">ocr_kwargs</span><span class="p">[</span><span class="s2">&quot;ocr_threshold&quot;</span><span class="p">]</span>
                <span class="n">ocr_kwargs</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
                    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">ocr_kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;ocr_threshold&quot;</span>
                <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ocr_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_for_allow_list</span><span class="p">(</span><span class="n">text_analyzer_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check the text_analyzer_kwargs for an allow_list.</span>

<span class="sd">        :param text_analyzer_kwargs: Text analyzer kwargs.</span>
<span class="sd">        :return: The allow list if it exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">allow_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">text_analyzer_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;allow_list&quot;</span> <span class="ow">in</span> <span class="n">text_analyzer_kwargs</span><span class="p">:</span>
                <span class="n">allow_list</span> <span class="o">=</span> <span class="n">text_analyzer_kwargs</span><span class="p">[</span><span class="s2">&quot;allow_list&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">allow_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert a Matplotlib figure to a PIL Image and return it.</span>

<span class="sd">        :param fig: Matplotlib figure.</span>

<span class="sd">        :return: Image of figure.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
        <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_pii_bboxes</span><span class="p">(</span>
        <span class="n">ocr_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a list of bboxes with is_PII property.</span>

<span class="sd">        :param ocr_bboxes: Bboxes from OCR results.</span>
<span class="sd">        :param analyzer_bboxes: Bboxes from analyzer results.</span>

<span class="sd">        :return: All bboxes with appropriate label for whether it is PHI or not.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ocr_bbox</span> <span class="ow">in</span> <span class="n">ocr_bboxes</span><span class="p">:</span>
            <span class="n">has_match</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Check if we have the same bbox in analyzer results</span>
            <span class="k">for</span> <span class="n">analyzer_bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span><span class="p">:</span>
                <span class="n">has_same_position</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># noqa: E501</span>
                <span class="n">has_same_dimension</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
                    <span class="ow">and</span> <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
                <span class="p">)</span>  <span class="c1"># noqa: E501</span>
                <span class="n">is_same</span> <span class="o">=</span> <span class="n">has_same_position</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_same_dimension</span> <span class="ow">is</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">is_same</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">current_bbox</span> <span class="o">=</span> <span class="n">analyzer_bbox</span>
                    <span class="n">current_bbox</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">has_match</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">has_match</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">current_bbox</span> <span class="o">=</span> <span class="n">ocr_bbox</span>
                <span class="n">current_bbox</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_bbox</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">bboxes</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_custom_bboxes</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
        <span class="n">bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_greyscale_cmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add custom bounding boxes to image.</span>

<span class="sd">        :param image: Standard image of DICOM pixels.</span>
<span class="sd">        :param bboxes: List of bounding boxes to display (with is_PII field).</span>
<span class="sd">        :param gt_bboxes: Ground truth bboxes (list of dictionaries).</span>
<span class="sd">        :param show_text_annotation: True if you want text annotation for</span>
<span class="sd">        PHI status to display.</span>
<span class="sd">        :param use_greyscale_cmap: Use greyscale color map.</span>
<span class="sd">        :return: Image with bounding boxes drawn on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image_custom</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span> <span class="o">=</span> <span class="n">image_custom</span><span class="o">.</span><span class="n">size</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">image_r</span> <span class="o">=</span> <span class="mi">70</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">image_x</span> <span class="o">/</span> <span class="n">image_r</span><span class="p">,</span> <span class="n">image_y</span> <span class="o">/</span> <span class="n">image_r</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bboxes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">image_custom</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">entity_type</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">entity_type</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]:</span>
                        <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>

                <span class="c1"># Get coordinates and dimensions</span>
                <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
                <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
                <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
                <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
                <span class="n">rect</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">bbox_color</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">show_text_annotation</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                        <span class="n">entity_type</span><span class="p">,</span>
                        <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>
                        <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                        <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round4,pad=.5&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;0.9&quot;</span><span class="p">),</span>
                    <span class="p">)</span>
            <span class="k">if</span> <span class="n">use_greyscale_cmap</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">)</span>
            <span class="n">im_from_fig</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            <span class="n">im_resized</span> <span class="o">=</span> <span class="n">im_from_fig</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">im_resized</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageAnalyzerEngine.analyze" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">analyze</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">analyze</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Analyse method to analyse the given image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image/numpy array or file path(str) to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>object</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_image_redactor.entities.ImageRecognizerResult" href="#presidio_image_redactor.entities.ImageRecognizerResult">ImageRecognizerResult</a>]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of the extract entities with image bounding boxes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">analyze</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="nb">object</span><span class="p">,</span> <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Analyse method to analyse the given image.</span>

<span class="sd">    :param image: PIL Image/numpy array or file path(str) to be processed.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: List of the extract entities with image bounding boxes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Perform OCR</span>
    <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">preprocessing_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_preprocessor</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span><span class="p">)</span>
    <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">preprocessing_metadata</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;scale_factor&quot;</span> <span class="ow">in</span> <span class="n">preprocessing_metadata</span><span class="p">):</span>
        <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scale_bbox_results</span><span class="p">(</span>
            <span class="n">ocr_result</span><span class="p">,</span> <span class="n">preprocessing_metadata</span><span class="p">[</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># Apply OCR confidence threshold if it is passed in</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
        <span class="n">ocr_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">)</span>

    <span class="c1"># Analyze text</span>
    <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">get_text_from_ocr_dict</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">)</span>

    <span class="c1"># Difines English as default language, if not specified</span>
    <span class="k">if</span> <span class="s2">&quot;language&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">text_analyzer_kwargs</span><span class="p">:</span>
        <span class="n">text_analyzer_kwargs</span><span class="p">[</span><span class="s2">&quot;language&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;en&quot;</span>
    <span class="n">analyzer_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
        <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
    <span class="p">)</span>
    <span class="n">allow_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_allow_list</span><span class="p">(</span><span class="n">text_analyzer_kwargs</span><span class="p">)</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
        <span class="n">analyzer_result</span><span class="p">,</span> <span class="n">ocr_result</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">allow_list</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageAnalyzerEngine.threshold_ocr_result" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">threshold_ocr_result</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Filter out OCR results below confidence threshold.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>OCR results (raw).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_threshold</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Threshold value between -1 and 100.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>OCR results with low confidence items removed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">threshold_ocr_result</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ocr_threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Filter out OCR results below confidence threshold.</span>

<span class="sd">    :param ocr_result: OCR results (raw).</span>
<span class="sd">    :param ocr_threshold: Threshold value between -1 and 100.</span>

<span class="sd">    :return: OCR results with low confidence items removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">ocr_threshold</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ocr_threshold must be between -1 and 100&quot;</span><span class="p">)</span>

    <span class="c1"># Get indices of items above threshold</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;conf&quot;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ocr_threshold</span><span class="p">:</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Only retain high confidence items</span>
    <span class="n">filtered_ocr_result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">filtered_ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">filtered_ocr_result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageAnalyzerEngine.remove_space_boxes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">remove_space_boxes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Remove OCR bboxes that are for spaces.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>OCR results (raw or thresholded).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>dict</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>OCR results with empty words removed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">remove_space_boxes</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove OCR bboxes that are for spaces.</span>

<span class="sd">    :param ocr_result: OCR results (raw or thresholded).</span>
<span class="sd">    :return: OCR results with empty words removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get indices of items with no text</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]):</span>
        <span class="n">is_not_space</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">is_not_space</span><span class="p">:</span>
            <span class="n">idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Only retain items with text</span>
    <span class="n">filtered_ocr_result</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">ocr_result</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">filtered_ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ocr_result</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">filtered_ocr_result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageAnalyzerEngine.map_analyzer_results_to_bounding_boxes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">map_analyzer_results_to_bounding_boxes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
    <span class="n">text_analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RecognizerResult</span><span class="p">],</span>
    <span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">allow_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Map extracted PII entities to image bounding boxes.</p>
<p>Matching is based on the position of the recognized entity from analyzer
and word (in ocr dict) in the text.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_results</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PII entities recognized by presidio analyzer</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.RecognizerResult" href="../analyzer_python/#presidio_analyzer.recognizer_result.RecognizerResult">RecognizerResult</a>]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_result</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>dict results with words and bboxes from OCR</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>text the results are based on</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_list</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of words to not redact  return: list of extracted entities with image bounding boxes</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[str]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">map_analyzer_results_to_bounding_boxes</span><span class="p">(</span>
    <span class="n">text_analyzer_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">RecognizerResult</span><span class="p">],</span>
    <span class="n">ocr_result</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">allow_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Map extracted PII entities to image bounding boxes.</span>

<span class="sd">    Matching is based on the position of the recognized entity from analyzer</span>
<span class="sd">    and word (in ocr dict) in the text.</span>

<span class="sd">    :param text_analyzer_results: PII entities recognized by presidio analyzer</span>
<span class="sd">    :param ocr_result: dict results with words and bboxes from OCR</span>
<span class="sd">    :param text: text the results are based on</span>
<span class="sd">    :param allow_list: List of words to not redact</span>

<span class="sd">    return: list of extracted entities with image bounding boxes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">ocr_result</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">text_analyzer_results</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">proc_indexes</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">indexes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_analyzer_results</span><span class="p">)</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iter_ocr</span> <span class="o">=</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">iter_ocr</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">text_analyzer_results</span><span class="p">:</span>
                <span class="n">text_element</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">start</span> <span class="p">:</span> <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">]</span>
                <span class="c1"># check position and text of ocr word matches recognized entity</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="nb">max</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">))</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="p">((</span><span class="n">text_element</span> <span class="ow">in</span> <span class="n">word</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">word</span> <span class="ow">in</span> <span class="n">text_element</span><span class="p">)):</span>
                    <span class="n">yes_make_bbox_for_word</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
                        <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_list</span><span class="p">)</span>
                    <span class="p">)</span>
                    <span class="c1"># Do not add bbox for standalone spaces / empty strings</span>
                    <span class="k">if</span> <span class="n">yes_make_bbox_for_word</span><span class="p">:</span>
                        <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ImageRecognizerResult</span><span class="p">(</span>
                                <span class="n">element</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
                                <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                                <span class="n">element</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                                <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                        <span class="c1"># add bounding boxes for all words in ocr dict</span>
                        <span class="c1"># contained within the text of recognized entity</span>
                        <span class="c1"># based on relative position in the full text</span>
                        <span class="k">while</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">:</span>
                            <span class="n">prev_word</span> <span class="o">=</span> <span class="n">word</span>
                            <span class="n">index</span><span class="p">,</span> <span class="n">word</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iter_ocr</span><span class="p">)</span>
                            <span class="n">yes_make_bbox_for_word</span> <span class="o">=</span> <span class="p">(</span>
                                <span class="p">(</span><span class="n">word</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">isspace</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">)</span>
                                <span class="ow">and</span> <span class="p">(</span><span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_list</span><span class="p">)</span>
                            <span class="p">)</span>
                            <span class="k">if</span> <span class="n">yes_make_bbox_for_word</span><span class="p">:</span>
                                <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                                    <span class="n">ImageRecognizerResult</span><span class="p">(</span>
                                        <span class="n">element</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
                                        <span class="n">element</span><span class="o">.</span><span class="n">start</span><span class="p">,</span>
                                        <span class="n">element</span><span class="o">.</span><span class="n">end</span><span class="p">,</span>
                                        <span class="n">element</span><span class="o">.</span><span class="n">score</span><span class="p">,</span>
                                        <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                        <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                        <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                        <span class="n">ocr_result</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">][</span><span class="n">index</span><span class="p">],</span>
                                    <span class="p">)</span>
                                <span class="p">)</span>
                            <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev_word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="n">proc_indexes</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">proc_indexes</span> <span class="o">==</span> <span class="n">indexes</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageAnalyzerEngine.fig2img" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fig2img</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a Matplotlib figure to a PIL Image and return it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Matplotlib figure.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="matplotlib.figure.Figure">Figure</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Image of figure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">Figure</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a Matplotlib figure to a PIL Image and return it.</span>

<span class="sd">    :param fig: Matplotlib figure.</span>

<span class="sd">    :return: Image of figure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageAnalyzerEngine.get_pii_bboxes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_pii_bboxes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_pii_bboxes</span><span class="p">(</span>
    <span class="n">ocr_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get a list of bboxes with is_PII property.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocr_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Bboxes from OCR results.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>analyzer_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Bboxes from analyzer results.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.List">List</span>[dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>All bboxes with appropriate label for whether it is PHI or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">get_pii_bboxes</span><span class="p">(</span>
    <span class="n">ocr_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">analyzer_bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of bboxes with is_PII property.</span>

<span class="sd">    :param ocr_bboxes: Bboxes from OCR results.</span>
<span class="sd">    :param analyzer_bboxes: Bboxes from analyzer results.</span>

<span class="sd">    :return: All bboxes with appropriate label for whether it is PHI or not.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ocr_bbox</span> <span class="ow">in</span> <span class="n">ocr_bboxes</span><span class="p">:</span>
        <span class="n">has_match</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Check if we have the same bbox in analyzer results</span>
        <span class="k">for</span> <span class="n">analyzer_bbox</span> <span class="ow">in</span> <span class="n">analyzer_bboxes</span><span class="p">:</span>
            <span class="n">has_same_position</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># noqa: E501</span>
            <span class="n">has_same_dimension</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
                <span class="ow">and</span> <span class="n">ocr_bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">analyzer_bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
            <span class="p">)</span>  <span class="c1"># noqa: E501</span>
            <span class="n">is_same</span> <span class="o">=</span> <span class="n">has_same_position</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">has_same_dimension</span> <span class="ow">is</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">is_same</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">current_bbox</span> <span class="o">=</span> <span class="n">analyzer_bbox</span>
                <span class="n">current_bbox</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">has_match</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">has_match</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">current_bbox</span> <span class="o">=</span> <span class="n">ocr_bbox</span>
            <span class="n">current_bbox</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">bboxes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_bbox</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageAnalyzerEngine.add_custom_bboxes" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_custom_bboxes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_custom_bboxes</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_greyscale_cmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add custom bounding boxes to image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Standard image of DICOM pixels.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of bounding boxes to display (with is_PII field).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gt_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Ground truth bboxes (list of dictionaries).</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_text_annotation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if you want text annotation for PHI status to display.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_greyscale_cmap</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Use greyscale color map.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Image with bounding boxes drawn on.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_analyzer_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">add_custom_bboxes</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_greyscale_cmap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add custom bounding boxes to image.</span>

<span class="sd">    :param image: Standard image of DICOM pixels.</span>
<span class="sd">    :param bboxes: List of bounding boxes to display (with is_PII field).</span>
<span class="sd">    :param gt_bboxes: Ground truth bboxes (list of dictionaries).</span>
<span class="sd">    :param show_text_annotation: True if you want text annotation for</span>
<span class="sd">    PHI status to display.</span>
<span class="sd">    :param use_greyscale_cmap: Use greyscale color map.</span>
<span class="sd">    :return: Image with bounding boxes drawn on.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image_custom</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span> <span class="o">=</span> <span class="n">image_custom</span><span class="o">.</span><span class="n">size</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">image_r</span> <span class="o">=</span> <span class="mi">70</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">image_x</span> <span class="o">/</span> <span class="n">image_r</span><span class="p">,</span> <span class="n">image_y</span> <span class="o">/</span> <span class="n">image_r</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bboxes</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">image_custom</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">entity_type</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;entity_type&quot;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">entity_type</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;is_PII&quot;</span><span class="p">]:</span>
                    <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;r&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">bbox_color</span> <span class="o">=</span> <span class="s2">&quot;b&quot;</span>

            <span class="c1"># Get coordinates and dimensions</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
            <span class="n">rect</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
                <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span> <span class="n">y0</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">bbox_color</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">show_text_annotation</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span>
                    <span class="n">entity_type</span><span class="p">,</span>
                    <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">y0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">),</span>
                    <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
                    <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">boxstyle</span><span class="o">=</span><span class="s2">&quot;round4,pad=.5&quot;</span><span class="p">,</span> <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;0.9&quot;</span><span class="p">),</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">use_greyscale_cmap</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image_custom</span><span class="p">)</span>
        <span class="n">im_from_fig</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">fig2img</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">im_resized</span> <span class="o">=</span> <span class="n">im_from_fig</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="n">image_x</span><span class="p">,</span> <span class="n">image_y</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">im_resized</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.ImageRedactorEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImageRedactorEngine</span>


</h3>


    <div class="doc doc-contents ">


        <p>ImageRedactorEngine performs OCR + PII detection + bounding box redaction.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_analyzer_engine</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Engine which performs OCR + PII detection.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine" href="#presidio_image_redactor.ImageAnalyzerEngine">ImageAnalyzerEngine</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageRedactorEngine.redact" href="#presidio_image_redactor.ImageRedactorEngine.redact">redact</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_redactor_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageRedactorEngine</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImageRedactorEngine performs OCR + PII detection + bounding box redaction.</span>

<span class="sd">    :param image_analyzer_engine: Engine which performs OCR + PII detection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image_analyzer_engine</span><span class="p">:</span> <span class="n">ImageAnalyzerEngine</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_analyzer_engine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span> <span class="o">=</span> <span class="n">ImageAnalyzerEngine</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span> <span class="o">=</span> <span class="n">image_analyzer_engine</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span> <span class="o">=</span> <span class="n">BboxProcessor</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given image.</span>

<span class="sd">        Please notice, this method duplicates the image, creates a new instance and</span>
<span class="sd">        manipulate it.</span>
<span class="sd">        :param image: PIL Image to be processed.</span>
<span class="sd">        :param fill: colour to fill the shape - int (0-255) for</span>
<span class="sd">        grayscale or Tuple(R, G, B) for RGB.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: the redacted image</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Check the ad-hoc recognizers list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">left</span>
            <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">top</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
            <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_ad_hoc_recognizer_list</span><span class="p">(</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the provided ad-hoc recognizer list is valid.</span>

<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">))):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">are_recognizers</span> <span class="o">=</span> <span class="nb">all</span><span class="p">(</span>
                        <span class="nb">isinstance</span><span class="p">(</span>
                            <span class="n">x</span><span class="p">,</span> <span class="n">presidio_analyzer</span><span class="o">.</span><span class="n">pattern_recognizer</span><span class="o">.</span><span class="n">PatternRecognizer</span>
                        <span class="p">)</span>
                        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ad_hoc_recognizers</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">are_recognizers</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
<span class="w">                            </span><span class="sd">&quot;&quot;&quot;All items in ad_hoc_recognizers list must be</span>
<span class="sd">                            PatternRecognizer objects&quot;&quot;&quot;</span>
                        <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                        <span class="s2">&quot;ad_hoc_recognizers must be None or list of PatternRecognizer&quot;</span>
                    <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;ad_hoc_recognizers must be None or list of PatternRecognizer&quot;</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageRedactorEngine.redact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given image.</p>
<p>Please notice, this method duplicates the image, creates a new instance and
manipulate it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>colour to fill the shape - int (0-255) for grayscale or Tuple(R, G, B) for RGB.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[int, <span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 0, 0)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the redacted image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given image.</span>

<span class="sd">    Please notice, this method duplicates the image, creates a new instance and</span>
<span class="sd">    manipulate it.</span>
<span class="sd">    :param image: PIL Image to be processed.</span>
<span class="sd">    :param fill: colour to fill the shape - int (0-255) for</span>
<span class="sd">    grayscale or Tuple(R, G, B) for RGB.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: the redacted image</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Check the ad-hoc recognizers list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">left</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">top</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.ImagePiiVerifyEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImagePiiVerifyEngine</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_redactor_engine.ImageRedactorEngine" href="#presidio_image_redactor.image_redactor_engine.ImageRedactorEngine">ImageRedactorEngine</a></code></p>


        <p>ImagePiiVerifyEngine class only supporting Pii verification currently.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImagePiiVerifyEngine.redact" href="#presidio_image_redactor.ImagePiiVerifyEngine.redact">redact</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImagePiiVerifyEngine.verify" href="#presidio_image_redactor.ImagePiiVerifyEngine.verify">verify</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Annotate image with the detect PII entity.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_pii_verify_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImagePiiVerifyEngine</span><span class="p">(</span><span class="n">ImageRedactorEngine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImagePiiVerifyEngine class only supporting Pii verification currently.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">verify</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
        <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Annotate image with the detect PII entity.</span>

<span class="sd">        Please notice, this method duplicates the image, creates a</span>
<span class="sd">        new instance and manipulate it.</span>

<span class="sd">        :param image: PIL Image to be processed.</span>
<span class="sd">        :param is_greyscale: Whether the image is greyscale or not.</span>
<span class="sd">        :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">        :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">        image with bounding boxes.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in ImageAnalyzerEngine.</span>

<span class="sd">        :return: the annotated image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Check the ad-hoc recognizers list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

        <span class="c1"># Detect text</span>
        <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># noqa: E501</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
            <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
                <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
            <span class="p">)</span>
        <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>

        <span class="c1"># Prepare for plotting</span>
        <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
            <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Get image with verification boxes</span>
        <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">display_image</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">verify_image</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImagePiiVerifyEngine.redact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given image.</p>
<p>Please notice, this method duplicates the image, creates a new instance and
manipulate it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>colour to fill the shape - int (0-255) for grayscale or Tuple(R, G, B) for RGB.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[int, <span title="typing.Tuple">Tuple</span>[int, int, int]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 0, 0)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the redacted image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given image.</span>

<span class="sd">    Please notice, this method duplicates the image, creates a new instance and</span>
<span class="sd">    manipulate it.</span>
<span class="sd">    :param image: PIL Image to be processed.</span>
<span class="sd">    :param fill: colour to fill the shape - int (0-255) for</span>
<span class="sd">    grayscale or Tuple(R, G, B) for RGB.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: the redacted image</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Check the ad-hoc recognizers list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">draw</span> <span class="o">=</span> <span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">bboxes</span><span class="p">:</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">left</span>
        <span class="n">y0</span> <span class="o">=</span> <span class="n">box</span><span class="o">.</span><span class="n">top</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">width</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">box</span><span class="o">.</span><span class="n">height</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">],</span> <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImagePiiVerifyEngine.verify" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">verify</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">verify</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Annotate image with the detect PII entity.</p>
<p>Please notice, this method duplicates the image, creates a
new instance and manipulate it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether the image is greyscale or not.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the verificationimage is displayed and returned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_text_annotation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to display entity type when displaying image with bounding boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the annotated image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Annotate image with the detect PII entity.</span>

<span class="sd">    Please notice, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulate it.</span>

<span class="sd">    :param image: PIL Image to be processed.</span>
<span class="sd">    :param is_greyscale: Whether the image is greyscale or not.</span>
<span class="sd">    :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">    :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">    image with bounding boxes.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in ImageAnalyzerEngine.</span>

<span class="sd">    :return: the annotated image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Check the ad-hoc recognizers list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

    <span class="c1"># Detect text</span>
    <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># noqa: E501</span>
    <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
            <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
        <span class="p">)</span>
    <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>

    <span class="c1"># Prepare for plotting</span>
    <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
        <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Get image with verification boxes</span>
    <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">display_image</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">verify_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.DicomImageRedactorEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DicomImageRedactorEngine</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageRedactorEngine" href="#presidio_image_redactor.ImageRedactorEngine">ImageRedactorEngine</a></code></p>


        <p>Performs OCR + PII detection + bounding box redaction.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image_analyzer_engine</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Engine which performs OCR + PII detection.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageAnalyzerEngine" href="#presidio_image_redactor.ImageAnalyzerEngine">ImageAnalyzerEngine</a></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImageRedactorEngine.redact_and_return_bbox" href="#presidio_image_redactor.DicomImageRedactorEngine.redact_and_return_bbox">redact_and_return_bbox</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given DICOM image and return redacted bboxes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImageRedactorEngine.redact" href="#presidio_image_redactor.DicomImageRedactorEngine.redact">redact</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given DICOM image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImageRedactorEngine.redact_from_file" href="#presidio_image_redactor.DicomImageRedactorEngine.redact_from_file">redact_from_file</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact from a given file.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImageRedactorEngine.redact_from_directory" href="#presidio_image_redactor.DicomImageRedactorEngine.redact_from_directory">redact_from_directory</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact from a directory of files.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImageRedactorEngine.augment_word" href="#presidio_image_redactor.DicomImageRedactorEngine.augment_word">augment_word</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Apply multiple types of casing to the provided string.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DicomImageRedactorEngine</span><span class="p">(</span><span class="n">ImageRedactorEngine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs OCR + PII detection + bounding box redaction.</span>

<span class="sd">    :param image_analyzer_engine: Engine which performs OCR + PII detection.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">redact_and_return_bbox</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image and return redacted bboxes.</span>

<span class="sd">        Please note, this method duplicates the image, creates a</span>
<span class="sd">        new instance and manipulates it.</span>

<span class="sd">        :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">        :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: DICOM instance with redacted pixel data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check input</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The provided image must be a loaded DICOM instance.&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">image</span><span class="o">.</span><span class="n">PixelData</span>
        <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided DICOM instance lacks pixel data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to access pixel data (may not exist): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IsADirectoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IsADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DICOM instance is a directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Load image for processing</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
            <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
            <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
            <span class="n">image_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

            <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Redact all bounding boxes from DICOM file</span>
        <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">remove_bbox_padding</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>
        <span class="n">redacted_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_redact_box</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redacted_image</span><span class="p">,</span> <span class="n">bboxes</span>

    <span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image.</span>

<span class="sd">        Please note, this method duplicates the image, creates a</span>
<span class="sd">        new instance and manipulates it.</span>

<span class="sd">        :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">        :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: DICOM instance with redacted pixel data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">redacted_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redact_and_return_bbox</span><span class="p">(</span>
            <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
            <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
            <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">redacted_image</span>

    <span class="k">def</span> <span class="nf">redact_from_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a given file.</span>

<span class="sd">        Please notice, this method duplicates the file, creates</span>
<span class="sd">        new instance and manipulate them.</span>

<span class="sd">        :param input_dicom_path: String path to DICOM image.</span>
<span class="sd">        :param output_dir: String path to parent output directory.</span>
<span class="sd">        :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">        :param fill: Color setting to use for redaction box</span>
<span class="sd">        (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">        :param verbose: True to print where redacted file was written to.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verify the given paths</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be file (not dir)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid file&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Create duplicate</span>
        <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># Process DICOM file</span>
        <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_single_dicom_image</span><span class="p">(</span>
            <span class="n">dcm_path</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
            <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
            <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">redact_from_directory</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a directory of files.</span>

<span class="sd">        Please notice, this method duplicates the files, creates</span>
<span class="sd">        new instances and manipulate them.</span>

<span class="sd">        :param input_dicom_path: String path to directory of DICOM images.</span>
<span class="sd">        :param output_dir: String path to parent output directory.</span>
<span class="sd">        :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Color setting to use for redaction box</span>
<span class="sd">        (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verify the given paths</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid directory&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a directory (not file)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Create duplicates</span>
        <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="c1"># Process DICOM files</span>
        <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_multiple_dicom_images</span><span class="p">(</span>
            <span class="n">dcm_dir</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
            <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
            <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
            <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_all_dcm_files</span><span class="p">(</span><span class="n">dcm_dir</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return paths to all DICOM files in a directory and its sub-directories.</span>

<span class="sd">        :param dcm_dir: pathlib Path to a directory containing at least one .dcm file.</span>

<span class="sd">        :return: List of pathlib Path objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Define applicable extensions</span>
        <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;[dD][cC][mM]&quot;</span><span class="p">,</span> <span class="s2">&quot;[dD][iI][cC][oO][mM]&quot;</span><span class="p">]</span>

        <span class="c1"># Get all files with any applicable extension</span>
        <span class="n">all_files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">extension</span> <span class="ow">in</span> <span class="n">extensions</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">dcm_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;**/*.</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">p</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_file</span><span class="p">()]</span>
            <span class="n">all_files</span> <span class="o">+=</span> <span class="n">files</span>

        <span class="k">return</span> <span class="n">all_files</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a DICOM image is in greyscale.</span>

<span class="sd">        :param instance: A single DICOM instance.</span>

<span class="sd">        :return: FALSE if the Photometric Interpretation is RGB.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if image is grayscale using the Photometric Interpretation element</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">color_scale</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">PhotometricInterpretation</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">color_scale</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="n">color_scale</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;MONOCHROME1&quot;</span><span class="p">,</span> <span class="s2">&quot;MONOCHROME2&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">is_greyscale</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_rescale_dcm_pixel_array</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Rescale DICOM pixel_array.</span>

<span class="sd">        :param instance: A singe DICOM instance.</span>
<span class="sd">        :param is_greyscale: FALSE if the Photometric Interpretation is RGB.</span>

<span class="sd">        :return: Rescaled DICOM pixel_array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Normalize contrast</span>
        <span class="k">if</span> <span class="s2">&quot;WindowWidth&quot;</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
                <span class="n">image_2d</span> <span class="o">=</span> <span class="n">apply_voi_lut</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">pixel_array</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">image_2d</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">pixel_array</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">image_2d</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">pixel_array</span>

        <span class="c1"># Convert to float to avoid overflow or underflow losses.</span>
        <span class="n">image_2d_float</span> <span class="o">=</span> <span class="n">image_2d</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="n">image_2d_scaled</span> <span class="o">=</span> <span class="n">image_2d_float</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Rescaling grey scale between 0-255</span>
            <span class="n">image_2d_scaled</span> <span class="o">=</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">image_2d_float</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">image_2d_float</span><span class="p">)</span>
                <span class="o">/</span> <span class="p">(</span><span class="n">image_2d_float</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">image_2d_float</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
            <span class="p">)</span> <span class="o">*</span> <span class="mf">255.0</span>

        <span class="c1"># Convert to uint</span>
        <span class="n">image_2d_scaled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">image_2d_scaled</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">image_2d_scaled</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_save_pixel_array_as_png</span><span class="p">(</span>
        <span class="n">pixel_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span>
        <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">output_file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;example&quot;</span><span class="p">,</span>
        <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;temp_dir&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the pixel data from a loaded DICOM instance as PNG.</span>

<span class="sd">        :param pixel_array: Pixel data from the instance.</span>
<span class="sd">        :param is_greyscale: True if image is greyscale.</span>
<span class="sd">        :param output_file_name: Name of output file (no file extension).</span>
<span class="sd">        :param output_dir: String path to output directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">pixel_array</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Write the PNG file</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">output_file_name</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">png_file</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">png</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">png_file</span><span class="p">,</span> <span class="n">pixel_array</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">output_file_name</span><span class="si">}</span><span class="s2">.png&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">png_file</span><span class="p">:</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">png</span><span class="o">.</span><span class="n">Writer</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">greyscale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># Semi-flatten the pixel array to RGB representation in 2D</span>
                <span class="n">pixel_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">pixel_array</span><span class="p">,</span> <span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span>
                <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">png_file</span><span class="p">,</span> <span class="n">pixel_array</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_convert_dcm_to_png</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;temp_dir&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert DICOM image to PNG file.</span>

<span class="sd">        :param filepath: pathlib Path to a single dcm file.</span>
<span class="sd">        :param output_dir: String path to output directory.</span>

<span class="sd">        :return: Shape of pixel array and if image mode is greyscale.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dcmread</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="c1"># Check if image is grayscale using the Photometric Interpretation element</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>

        <span class="c1"># Rescale pixel array</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span>

        <span class="c1"># Write to PNG file</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">filepath</span><span class="o">.</span><span class="n">stem</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">shape</span><span class="p">,</span> <span class="n">is_greyscale</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_bg_color</span><span class="p">(</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">invert</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select most common color as background color.</span>

<span class="sd">        :param image: Loaded PIL image.</span>
<span class="sd">        :param colorscale: Colorscale of image (e.g., &#39;grayscale&#39;, &#39;RGB&#39;)</span>
<span class="sd">        :param invert: TRUE if you want to get the inverse of the bg color.</span>

<span class="sd">        :return: Background color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Invert colors if invert flag is True</span>
        <span class="k">if</span> <span class="n">invert</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;RGBA&quot;</span><span class="p">:</span>
                <span class="c1"># Handle transparency as needed</span>
                <span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">rgb_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">g</span><span class="p">,</span> <span class="n">b</span><span class="p">))</span>
                <span class="n">inverted_image</span> <span class="o">=</span> <span class="n">ImageOps</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">rgb_image</span><span class="p">)</span>
                <span class="n">r2</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">inverted_image</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

                <span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="s2">&quot;RGBA&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">a</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">image</span> <span class="o">=</span> <span class="n">ImageOps</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Get background color</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="c1"># Select most common color as color</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">getdata</span><span class="p">()))</span><span class="o">.</span><span class="n">argmax</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Reduce size of image to 1 pixel to get dominant color</span>
            <span class="n">tmp_image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">tmp_image</span> <span class="o">=</span> <span class="n">tmp_image</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">resample</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">bg_color</span> <span class="o">=</span> <span class="n">tmp_image</span><span class="o">.</span><span class="n">getpixel</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">bg_color</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_array_corners</span><span class="p">(</span><span class="n">pixel_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Crop a pixel array to just return the corners in a single array.</span>

<span class="sd">        :param pixel_array: Numpy array containing the pixel data.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>

<span class="sd">        :return: Cropped input array.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">crop_ratio</span> <span class="o">&gt;=</span> <span class="mf">1.0</span> <span class="ow">or</span> <span class="n">crop_ratio</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;crop_ratio must be between 0 and 1&quot;</span><span class="p">)</span>

        <span class="c1"># Set dimensions</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">pixel_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">pixel_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">crop_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">width</span> <span class="o">*</span> <span class="n">crop_ratio</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">crop_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">height</span> <span class="o">*</span> <span class="n">crop_ratio</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>

        <span class="c1"># Get coordinates for corners</span>
        <span class="c1"># (left, top, right, bottom)</span>
        <span class="n">box_top_left</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">crop_width</span><span class="p">,</span> <span class="n">crop_height</span><span class="p">)</span>
        <span class="n">box_top_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">crop_width</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">crop_height</span><span class="p">)</span>
        <span class="n">box_bottom_left</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">crop_height</span><span class="p">,</span> <span class="n">crop_width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">box_bottom_right</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">crop_width</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">crop_height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="n">boxes</span> <span class="o">=</span> <span class="p">[</span><span class="n">box_top_left</span><span class="p">,</span> <span class="n">box_top_right</span><span class="p">,</span> <span class="n">box_bottom_left</span><span class="p">,</span> <span class="n">box_bottom_right</span><span class="p">]</span>

        <span class="c1"># Only keep box pixels</span>
        <span class="n">cropped_pixel_arrays</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">pixel_array</span><span class="p">[</span><span class="n">box</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">box</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">box</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">box</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span> <span class="k">for</span> <span class="n">box</span> <span class="ow">in</span> <span class="n">boxes</span>
        <span class="p">]</span>

        <span class="c1"># Combine the cropped pixel arrays</span>
        <span class="n">cropped_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">cropped_pixel_arrays</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">cropped_array</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_get_most_common_pixel_value</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find the most common pixel value.</span>

<span class="sd">        :param instance: A singe DICOM instance.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Determines how box color is selected.</span>
<span class="sd">        &#39;contrast&#39; - Masks stand out relative to background.</span>
<span class="sd">        &#39;background&#39; - Masks are same color as background.</span>

<span class="sd">        :return: Most or least common pixel value (depending on fill).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Crop down to just only look at image corners</span>
        <span class="n">cropped_array</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_array_corners</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">pixel_array</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">)</span>

        <span class="c1"># Get flattened pixel array</span>
        <span class="n">flat_pixel_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cropped_array</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="c1"># Get most common value</span>
            <span class="n">values</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">flat_pixel_array</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">flat_pixel_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">flat_pixel_array</span><span class="p">)</span>
            <span class="n">common_value</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">counts</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Most common pixel value retrieval is only supported for greyscale images at this point.&quot;</span>  <span class="c1"># noqa: E501</span>
            <span class="p">)</span>

        <span class="c1"># Invert color as necessary</span>
        <span class="k">if</span> <span class="n">fill</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">,</span> <span class="s2">&quot;invert&quot;</span><span class="p">,</span> <span class="s2">&quot;inverted&quot;</span><span class="p">,</span> <span class="s2">&quot;inverse&quot;</span><span class="p">]:</span>
            <span class="n">pixel_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">flat_pixel_array</span><span class="p">)</span> <span class="o">-</span> <span class="n">common_value</span>
        <span class="k">elif</span> <span class="n">fill</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;bg&quot;</span><span class="p">]:</span>
            <span class="n">pixel_value</span> <span class="o">=</span> <span class="n">common_value</span>

        <span class="k">return</span> <span class="n">pixel_value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_add_padding</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span>
        <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add border to image using most common color.</span>

<span class="sd">        :param image: Loaded PIL image.</span>
<span class="sd">        :param is_greyscale: Whether image is in grayscale or not.</span>
<span class="sd">        :param padding_width: Pixel width of padding (uniform).</span>

<span class="sd">        :return: PIL image with padding.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check padding width value</span>
        <span class="k">if</span> <span class="n">padding_width</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Enter a positive value for padding&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">padding_width</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Excessive padding width entered. Please use a width under 100 pixels.&quot;</span>  <span class="c1"># noqa: E501</span>
            <span class="p">)</span>

        <span class="c1"># Select most common color as border color</span>
        <span class="n">border_color</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_bg_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>

        <span class="c1"># Add padding</span>
        <span class="n">right</span> <span class="o">=</span> <span class="n">padding_width</span>
        <span class="n">left</span> <span class="o">=</span> <span class="n">padding_width</span>
        <span class="n">top</span> <span class="o">=</span> <span class="n">padding_width</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="n">padding_width</span>

        <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span>

        <span class="n">new_width</span> <span class="o">=</span> <span class="n">width</span> <span class="o">+</span> <span class="n">right</span> <span class="o">+</span> <span class="n">left</span>
        <span class="n">new_height</span> <span class="o">=</span> <span class="n">height</span> <span class="o">+</span> <span class="n">top</span> <span class="o">+</span> <span class="n">bottom</span>

        <span class="n">image_with_padding</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
            <span class="n">image</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="p">(</span><span class="n">new_width</span><span class="p">,</span> <span class="n">new_height</span><span class="p">),</span> <span class="n">border_color</span>
        <span class="p">)</span>
        <span class="n">image_with_padding</span><span class="o">.</span><span class="n">paste</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">top</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">image_with_padding</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_copy_files_for_processing</span><span class="p">(</span><span class="n">src_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dst_parent_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Copy DICOM files. All processing should be done on the copies.</span>

<span class="sd">        :param src_path: String path to DICOM file or directory containing DICOM files.</span>
<span class="sd">        :param dst_parent_dir: String path to parent directory of output location.</span>

<span class="sd">        :return: Output location of the file(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Identify output path</span>
        <span class="n">tail</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span><span class="o">.</span><span class="n">parts</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dst_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">dst_parent_dir</span><span class="p">,</span> <span class="n">tail</span><span class="p">)</span>

        <span class="c1"># Copy file(s)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">FileExistsError</span><span class="p">(</span>
                    <span class="s2">&quot;Destination files already exist. Please clear the destination files or specify a different dst_parent_dir.&quot;</span>  <span class="c1"># noqa: E501</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">src_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># Create the output dir manually if working with a single file</span>
            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="n">src_path</span><span class="p">,</span> <span class="n">dst_path</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_path</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dst_path</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_get_text_metadata</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieve all text metadata from the DICOM image.</span>

<span class="sd">        :param instance: Loaded DICOM instance.</span>

<span class="sd">        :return: List of all the instance&#39;s element values (excluding pixel data),</span>
<span class="sd">        bool for if the element is specified as being a name,</span>
<span class="sd">        bool for if the element is specified as being related to the patient.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">metadata_text</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">is_name</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="n">is_patient</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">instance</span><span class="p">:</span>
            <span class="c1"># Save all metadata except the DICOM image itself</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s2">&quot;Pixel Data&quot;</span><span class="p">:</span>
                <span class="c1"># Save the metadata</span>
                <span class="n">metadata_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

                <span class="c1"># Track whether this particular element is a name</span>
                <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">is_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">is_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

                <span class="c1"># Track whether this particular element is directly tied to the patient</span>
                <span class="k">if</span> <span class="s2">&quot;patient&quot;</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                    <span class="n">is_patient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">is_patient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">metadata_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">is_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">is_patient</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">metadata_text</span><span class="p">,</span> <span class="n">is_name</span><span class="p">,</span> <span class="n">is_patient</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Apply multiple types of casing to the provided string.</span>

<span class="sd">        :param words: String containing the word or term of interest.</span>
<span class="sd">        :param case_sensitive: True if we want to preserve casing.</span>

<span class="sd">        :return: List of the same string with different casings and spacing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="c1"># Replacing separator character with space, if any</span>
            <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">text_no_separator</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
                <span class="n">word_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_no_separator</span><span class="p">)</span>
                <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Capitalize all characters in string</span>
                <span class="n">text_upper</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

                <span class="c1"># Lowercase all characters in string</span>
                <span class="n">text_lower</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

                <span class="c1"># Capitalize first letter in each part of string</span>
                <span class="n">text_title</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

                <span class="c1"># Append iterations</span>
                <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">text_no_separator</span><span class="p">,</span> <span class="n">text_upper</span><span class="p">,</span> <span class="n">text_lower</span><span class="p">,</span> <span class="n">text_title</span><span class="p">]</span>
                <span class="p">)</span>

                <span class="c1"># Adding each term as a separate item in the list</span>
                <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                        <span class="n">text_upper</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                        <span class="n">text_lower</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                        <span class="n">text_title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>

            <span class="c1"># Flatten list</span>
            <span class="n">flat_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">flat_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">flat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

            <span class="c1"># Remove any duplicates and empty strings</span>
            <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flat_list</span><span class="p">))</span>
            <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">word_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">word_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_process_names</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">text_metadata</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">is_name</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process names to have multiple iterations in our PHI list.</span>

<span class="sd">        :param metadata_text: List of all the instance&#39;s element values</span>
<span class="sd">        (excluding pixel data).</span>
<span class="sd">        :param is_name: True if the element is specified as being a name.</span>

<span class="sd">        :return: Metadata text with additional name iterations appended.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">phi_list</span> <span class="o">=</span> <span class="n">text_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">text_metadata</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">is_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">original_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text_metadata</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">phi_list</span> <span class="o">+=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">augment_word</span><span class="p">(</span><span class="n">original_text</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">phi_list</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_add_known_generic_phi</span><span class="p">(</span><span class="n">phi_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add known potential generic PHI values.</span>

<span class="sd">        :param phi_list: List of PHI to use with Presidio ad-hoc recognizer.</span>

<span class="sd">        :return: Same list with added known values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">known_generic_phi</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;[M]&quot;</span><span class="p">,</span> <span class="s2">&quot;[F]&quot;</span><span class="p">,</span> <span class="s2">&quot;[X]&quot;</span><span class="p">,</span> <span class="s2">&quot;[U]&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="s2">&quot;U&quot;</span><span class="p">]</span>
        <span class="n">phi_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">known_generic_phi</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">phi_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_make_phi_list</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">original_metadata</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">multival</span><span class="o">.</span><span class="n">MultiValue</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]],</span>
        <span class="n">is_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
        <span class="n">is_patient</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">bool</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make the list of PHI to use in Presidio ad-hoc recognizer.</span>

<span class="sd">        :param original_metadata: List of all the instance&#39;s element values</span>
<span class="sd">        (excluding pixel data).</span>
<span class="sd">        :param is_name: True if the element is specified as being a name.</span>
<span class="sd">        :param is_patient: True if the element is specified as being</span>
<span class="sd">        related to the patient.</span>

<span class="sd">        :return: List of PHI (str) to use with Presidio ad-hoc recognizer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Process names</span>
        <span class="n">phi_list</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_process_names</span><span class="p">(</span><span class="n">original_metadata</span><span class="p">,</span> <span class="n">is_name</span><span class="p">)</span>

        <span class="c1"># Add known potential phi values</span>
        <span class="n">phi_list</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_add_known_generic_phi</span><span class="p">(</span><span class="n">phi_list</span><span class="p">)</span>

        <span class="c1"># Flatten any nested lists</span>
        <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">phi_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">multival</span><span class="o">.</span><span class="n">MultiValue</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">phi</span><span class="p">:</span>
                    <span class="n">phi_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">phi_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>

        <span class="c1"># Convert all items to strings</span>
        <span class="n">phi_str_list</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span> <span class="k">for</span> <span class="n">phi</span> <span class="ow">in</span> <span class="n">phi_list</span><span class="p">]</span>

        <span class="c1"># Remove duplicates</span>
        <span class="n">phi_str_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">phi_str_list</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">phi_str_list</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_set_bbox_color</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the bounding box color.</span>

<span class="sd">        :param instance: A single DICOM instance.</span>
<span class="sd">        :param fill: Determines how box color is selected.</span>
<span class="sd">        &#39;contrast&#39; - Masks stand out relative to background.</span>
<span class="sd">        &#39;background&#39; - Masks are same color as background.</span>

<span class="sd">        :return: int or tuple of int values determining masking box color.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if we want the box color to contrast with the background</span>
        <span class="k">if</span> <span class="n">fill</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;contrast&quot;</span><span class="p">,</span> <span class="s2">&quot;invert&quot;</span><span class="p">,</span> <span class="s2">&quot;inverted&quot;</span><span class="p">,</span> <span class="s2">&quot;inverse&quot;</span><span class="p">]:</span>
            <span class="n">invert_flag</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">fill</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;background&quot;</span><span class="p">,</span> <span class="s2">&quot;bg&quot;</span><span class="p">]:</span>
            <span class="n">invert_flag</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;fill must be &#39;contrast&#39; or &#39;background&#39;&quot;</span><span class="p">)</span>

        <span class="c1"># Temporarily save as PNG to get color</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
            <span class="n">dst_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/temp.dcm&quot;</span><span class="p">)</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">save_as</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_convert_dcm_to_png</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">tmpdirname</span><span class="p">)</span>

            <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dst_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
            <span class="n">box_color</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_bg_color</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">invert_flag</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">box_color</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_if_compressed</span><span class="p">(</span><span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the pixel data is compressed.</span>

<span class="sd">        :param instance: DICOM instance.</span>

<span class="sd">        :return: Boolean for whether the pixel data is compressed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Calculate expected bytes</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">Rows</span>
        <span class="n">columns</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">Columns</span>
        <span class="n">samples_per_pixel</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">SamplesPerPixel</span>
        <span class="n">bits_allocated</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">BitsAllocated</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">number_of_frames</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mh">0x0028</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">number_of_frames</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">expected_num_bytes</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">rows</span> <span class="o">*</span> <span class="n">columns</span> <span class="o">*</span> <span class="n">number_of_frames</span> <span class="o">*</span> <span class="n">samples_per_pixel</span> <span class="o">*</span> <span class="p">(</span><span class="n">bits_allocated</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Compare expected vs actual</span>
        <span class="n">is_compressed</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">expected_num_bytes</span><span class="p">))</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">PixelData</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">is_compressed</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_compress_pixel_data</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Recompress pixel data that was decompressed during redaction.</span>

<span class="sd">        :param instance: Loaded DICOM instance.</span>

<span class="sd">        :return: Instance with compressed pixel data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">compression_method</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">uid</span><span class="o">.</span><span class="n">RLELossless</span>

        <span class="c1"># Temporarily change syntax to an &quot;uncompressed&quot; method</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">file_meta</span><span class="o">.</span><span class="n">TransferSyntaxUID</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">uid</span><span class="o">.</span><span class="n">UID</span><span class="p">(</span><span class="s2">&quot;1.2.840.10008.1.2&quot;</span><span class="p">)</span>

        <span class="c1"># Compress and update syntax</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">compression_method</span><span class="p">,</span> <span class="n">encoding_plugin</span><span class="o">=</span><span class="s2">&quot;gdcm&quot;</span><span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">file_meta</span><span class="o">.</span><span class="n">TransferSyntaxUID</span> <span class="o">=</span> <span class="n">compression_method</span>

        <span class="k">return</span> <span class="n">instance</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_if_has_image_icon_sequence</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if there is an image icon sequence tag in the metadata.</span>

<span class="sd">        This leads to pixel data being present in multiple locations.</span>

<span class="sd">        :param instance: DICOM instance.</span>

<span class="sd">        :return: Boolean for whether the instance has an image icon sequence tag.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">has_image_icon_sequence</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="n">instance</span><span class="p">[</span><span class="mh">0x0088</span><span class="p">,</span> <span class="mh">0x0200</span><span class="p">]</span>
            <span class="n">has_image_icon_sequence</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">has_image_icon_sequence</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">has_image_icon_sequence</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_add_redact_box</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">bounding_boxes_coordinates</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add redaction bounding boxes on a DICOM instance.</span>

<span class="sd">        :param instance: A single DICOM instance.</span>
<span class="sd">        :param bounding_boxes_coordinates: Bounding box coordinates.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Determines how box color is selected.</span>
<span class="sd">        &#39;contrast&#39; - Masks stand out relative to background.</span>
<span class="sd">        &#39;background&#39; - Masks are same color as background.</span>

<span class="sd">        :return: A new dicom instance with redaction bounding boxes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Copy instance</span>
        <span class="n">redacted_instance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">is_compressed</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_compressed</span><span class="p">(</span><span class="n">redacted_instance</span><span class="p">)</span>
        <span class="n">has_image_icon_sequence</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_has_image_icon_sequence</span><span class="p">(</span>
            <span class="n">redacted_instance</span>
        <span class="p">)</span>

        <span class="c1"># Select masking box color</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="n">box_color</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_get_most_common_pixel_value</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">box_color</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_set_bbox_color</span><span class="p">(</span><span class="n">redacted_instance</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>

        <span class="c1"># Apply mask</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bounding_boxes_coordinates</span><span class="p">)):</span>
            <span class="n">bbox</span> <span class="o">=</span> <span class="n">bounding_boxes_coordinates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">top</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span>
            <span class="n">left</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">]</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">bbox</span><span class="p">[</span><span class="s2">&quot;height&quot;</span><span class="p">]</span>
            <span class="n">redacted_instance</span><span class="o">.</span><span class="n">pixel_array</span><span class="p">[</span><span class="n">top</span> <span class="p">:</span> <span class="n">top</span> <span class="o">+</span> <span class="n">height</span><span class="p">,</span> <span class="n">left</span> <span class="p">:</span> <span class="n">left</span> <span class="o">+</span> <span class="n">width</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">box_color</span>
            <span class="p">)</span>

        <span class="n">redacted_instance</span><span class="o">.</span><span class="n">PixelData</span> <span class="o">=</span> <span class="n">redacted_instance</span><span class="o">.</span><span class="n">pixel_array</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>

        <span class="c1"># If original pixel data is compressed, recompress after redaction</span>
        <span class="k">if</span> <span class="n">is_compressed</span> <span class="ow">or</span> <span class="n">has_image_icon_sequence</span><span class="p">:</span>
            <span class="c1"># Temporary &quot;fix&quot; to manually set all YBR photometric interp as YBR_FULL</span>
            <span class="k">if</span> <span class="s2">&quot;YBR&quot;</span> <span class="ow">in</span> <span class="n">redacted_instance</span><span class="o">.</span><span class="n">PhotometricInterpretation</span><span class="p">:</span>
                <span class="n">redacted_instance</span><span class="o">.</span><span class="n">PhotometricInterpretation</span> <span class="o">=</span> <span class="s2">&quot;YBR_FULL&quot;</span>
            <span class="n">redacted_instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_compress_pixel_data</span><span class="p">(</span><span class="n">redacted_instance</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redacted_instance</span>

    <span class="k">def</span> <span class="nf">_get_analyzer_results</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]],</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ImageRecognizerResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze image with selected redaction approach.</span>

<span class="sd">        :param image: DICOM pixel data as PIL image.</span>
<span class="sd">        :param instance: DICOM instance (with metadata).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine (e.g., allow_list).</span>

<span class="sd">        :return: Analyzer results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check the ad-hoc recognizers list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

        <span class="c1"># Create custom recognizer using DICOM metadata</span>
        <span class="k">if</span> <span class="n">use_metadata</span><span class="p">:</span>
            <span class="n">original_metadata</span><span class="p">,</span> <span class="n">is_name</span><span class="p">,</span> <span class="n">is_patient</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_text_metadata</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
            <span class="n">phi_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_phi_list</span><span class="p">(</span><span class="n">original_metadata</span><span class="p">,</span> <span class="n">is_name</span><span class="p">,</span> <span class="n">is_patient</span><span class="p">)</span>
            <span class="n">deny_list_recognizer</span> <span class="o">=</span> <span class="n">PatternRecognizer</span><span class="p">(</span>
                <span class="n">supported_entity</span><span class="o">=</span><span class="s2">&quot;PERSON&quot;</span><span class="p">,</span> <span class="n">deny_list</span><span class="o">=</span><span class="n">phi_list</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ad_hoc_recognizers</span> <span class="o">=</span> <span class="p">[</span><span class="n">deny_list_recognizer</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deny_list_recognizer</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">analyzer_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_save_bbox_json</span><span class="p">(</span><span class="n">output_dcm_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save the redacted bounding box info as a json file.</span>

<span class="sd">        :param output_dcm_path: Path to the redacted DICOM file.</span>

<span class="sd">        :param bboxes: Bounding boxes used in redaction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output_json_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dcm_path</span><span class="p">)</span><span class="o">.</span><span class="n">with_suffix</span><span class="p">(</span><span class="s2">&quot;.json&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_json_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">write_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">bboxes</span><span class="p">,</span> <span class="n">write_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_redact_single_dicom_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dcm_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact text PHI present on a DICOM image.</span>

<span class="sd">        :param dcm_path: String path to the DICOM file.</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Color setting to use for bounding boxes</span>
<span class="sd">        (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param padding_width: Pixel width of padding (uniform).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param overwrite: Only set to True if you are providing the</span>
<span class="sd">        duplicated DICOM path in dcm_path.</span>
<span class="sd">        :param dst_parent_dir: String path to parent directory of where to store copies.</span>
<span class="sd">        :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        :return: Path to the output DICOM file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure we are working on a single file</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcm_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Please ensure dcm_path is a single file&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcm_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dcm_path</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="c1"># Copy file before processing if overwrite==False</span>
        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">dcm_path</span><span class="p">,</span> <span class="n">dst_parent_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dst_path</span> <span class="o">=</span> <span class="n">dcm_path</span>

        <span class="c1"># Load instance</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dcmread</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">PixelData</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Provided DICOM file lacks pixel data.&quot;</span><span class="p">)</span>

        <span class="c1"># Load image for processing</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
            <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_dcm_to_png</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">tmpdirname</span><span class="p">)</span>
            <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">dst_path</span><span class="o">.</span><span class="n">stem</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

        <span class="c1"># Detect PII</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Redact all bounding boxes from DICOM file</span>
        <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>
        <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">remove_bbox_padding</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>
        <span class="n">redacted_dicom_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_redact_box</span><span class="p">(</span>
            <span class="n">instance</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span>
        <span class="p">)</span>
        <span class="n">redacted_dicom_instance</span><span class="o">.</span><span class="n">save_as</span><span class="p">(</span><span class="n">dst_path</span><span class="p">)</span>

        <span class="c1"># Save redacted bboxes</span>
        <span class="k">if</span> <span class="n">save_bboxes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_bbox_json</span><span class="p">(</span><span class="n">dst_path</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">dst_path</span>

    <span class="k">def</span> <span class="nf">_redact_multiple_dicom_images</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">dcm_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Redact text PHI present on all DICOM images in a directory.</span>

<span class="sd">        :param dcm_dir: String path to directory containing DICOM files (can be nested).</span>
<span class="sd">        :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">        most common pixel value as the background color value.</span>
<span class="sd">        :param fill: Color setting to use for bounding boxes</span>
<span class="sd">        (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">        :param padding_width: Pixel width of padding (uniform).</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param overwrite: Only set to True if you are providing</span>
<span class="sd">        the duplicated DICOM dir in dcm_dir.</span>
<span class="sd">        :param dst_parent_dir: String path to parent directory of where to store copies.</span>
<span class="sd">        :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in AnalyzerEngine.</span>

<span class="sd">        Return:</span>
<span class="sd">            dst_dir (str): Path to the output DICOM directory.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Ensure we are working on a directory (can have sub-directories)</span>
        <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcm_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">&quot;Please ensure dcm_path is a directory&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">Path</span><span class="p">(</span><span class="n">dcm_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">dcm_dir</span><span class="si">}</span><span class="s2"> does not exist&quot;</span><span class="p">)</span>

        <span class="c1"># List of files to process directly</span>
        <span class="k">if</span> <span class="n">overwrite</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">dst_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">dcm_dir</span><span class="p">,</span> <span class="n">dst_parent_dir</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dst_dir</span> <span class="o">=</span> <span class="n">dcm_dir</span>

        <span class="c1"># Process each DICOM file directly</span>
        <span class="n">all_dcm_files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_dcm_files</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">dst_dir</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">dst_path</span> <span class="ow">in</span> <span class="n">all_dcm_files</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_redact_single_dicom_image</span><span class="p">(</span>
                <span class="n">dst_path</span><span class="p">,</span>
                <span class="n">crop_ratio</span><span class="p">,</span>
                <span class="n">fill</span><span class="p">,</span>
                <span class="n">padding_width</span><span class="p">,</span>
                <span class="n">use_metadata</span><span class="p">,</span>
                <span class="n">overwrite</span><span class="p">,</span>
                <span class="n">dst_parent_dir</span><span class="p">,</span>
                <span class="n">save_bboxes</span><span class="p">,</span>
                <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
                <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
                <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">dst_dir</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImageRedactorEngine.redact_and_return_bbox" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_and_return_bbox</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_and_return_bbox</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given DICOM image and return redacted bboxes.</p>
<p>Please note, this method duplicates the image, creates a
new instance and manipulates it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Fill setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="pydicom.dataset.FileDataset">FileDataset</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, int]]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>DICOM instance with redacted pixel data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_and_return_bbox</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image and return redacted bboxes.</span>

<span class="sd">    Please note, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulates it.</span>

<span class="sd">    :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: DICOM instance with redacted pixel data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check input</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The provided image must be a loaded DICOM instance.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">image</span><span class="o">.</span><span class="n">PixelData</span>
    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided DICOM instance lacks pixel data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to access pixel data (may not exist): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IsADirectoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IsADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DICOM instance is a directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">instance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Load image for processing</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

        <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Redact all bounding boxes from DICOM file</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">remove_bbox_padding</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>
    <span class="n">redacted_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_redact_box</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">redacted_image</span><span class="p">,</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImageRedactorEngine.redact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given DICOM image.</p>
<p>Please note, this method duplicates the image, creates a
new instance and manipulates it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Fill setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>DICOM instance with redacted pixel data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image.</span>

<span class="sd">    Please note, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulates it.</span>

<span class="sd">    :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: DICOM instance with redacted pixel data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">redacted_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redact_and_return_bbox</span><span class="p">(</span>
        <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">redacted_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImageRedactorEngine.redact_from_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_from_file</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_from_file</span><span class="p">(</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact from a given file.</p>
<p>Please notice, this method duplicates the file, creates
new instance and manipulate them.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_dicom_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to DICOM image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to parent output directory.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code></code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>padding_width</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Color setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to save boundings boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to print where redacted file was written to.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_from_file</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a given file.</span>

<span class="sd">    Please notice, this method duplicates the file, creates</span>
<span class="sd">    new instance and manipulate them.</span>

<span class="sd">    :param input_dicom_path: String path to DICOM image.</span>
<span class="sd">    :param output_dir: String path to parent output directory.</span>
<span class="sd">    :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">    :param fill: Color setting to use for redaction box</span>
<span class="sd">    (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">    :param verbose: True to print where redacted file was written to.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify the given paths</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be file (not dir)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid file&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create duplicate</span>
    <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

    <span class="c1"># Process DICOM file</span>
    <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_single_dicom_image</span><span class="p">(</span>
        <span class="n">dcm_path</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImageRedactorEngine.redact_from_directory" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_from_directory</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_from_directory</span><span class="p">(</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact from a directory of files.</p>
<p>Please notice, this method duplicates the files, creates
new instances and manipulate them.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_dicom_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to directory of DICOM images.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to parent output directory.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code></code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>padding_width</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Color setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to save boundings boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_from_directory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a directory of files.</span>

<span class="sd">    Please notice, this method duplicates the files, creates</span>
<span class="sd">    new instances and manipulate them.</span>

<span class="sd">    :param input_dicom_path: String path to directory of DICOM images.</span>
<span class="sd">    :param output_dir: String path to parent output directory.</span>
<span class="sd">    :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param fill: Color setting to use for redaction box</span>
<span class="sd">    (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify the given paths</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid directory&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a directory (not file)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create duplicates</span>
    <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

    <span class="c1"># Process DICOM files</span>
    <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_multiple_dicom_images</span><span class="p">(</span>
        <span class="n">dcm_dir</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImageRedactorEngine.augment_word" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">augment_word</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply multiple types of casing to the provided string.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>words</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String containing the word or term of interest.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>case_sensitive</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to preserve casing.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>list</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of the same string with different casings and spacing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply multiple types of casing to the provided string.</span>

<span class="sd">    :param words: String containing the word or term of interest.</span>
<span class="sd">    :param case_sensitive: True if we want to preserve casing.</span>

<span class="sd">    :return: List of the same string with different casings and spacing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="c1"># Replacing separator character with space, if any</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_no_separator</span><span class="p">)</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Capitalize all characters in string</span>
            <span class="n">text_upper</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

            <span class="c1"># Lowercase all characters in string</span>
            <span class="n">text_lower</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># Capitalize first letter in each part of string</span>
            <span class="n">text_title</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

            <span class="c1"># Append iterations</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span><span class="n">text_no_separator</span><span class="p">,</span> <span class="n">text_upper</span><span class="p">,</span> <span class="n">text_lower</span><span class="p">,</span> <span class="n">text_title</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Adding each term as a separate item in the list</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_upper</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_lower</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Flatten list</span>
        <span class="n">flat_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">flat_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># Remove any duplicates and empty strings</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flat_list</span><span class="p">))</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">word_list</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">word_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.DicomImagePiiVerifyEngine" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">DicomImagePiiVerifyEngine</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImagePiiVerifyEngine" href="#presidio_image_redactor.ImagePiiVerifyEngine">ImagePiiVerifyEngine</a></code>, <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImageRedactorEngine" href="#presidio_image_redactor.DicomImageRedactorEngine">DicomImageRedactorEngine</a></code></p>


        <p>Class to handle verification and evaluation for DICOM de-identification.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.redact" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact">redact</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given DICOM image.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.redact_and_return_bbox" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact_and_return_bbox">redact_and_return_bbox</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact the given DICOM image and return redacted bboxes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_file" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_file">redact_from_file</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact from a given file.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_directory" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_directory">redact_from_directory</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Redact method to redact from a directory of files.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.augment_word" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.augment_word">augment_word</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Apply multiple types of casing to the provided string.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.verify" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.verify">verify</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Annotate image with the detect PII entity.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.verify_dicom_instance" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.verify_dicom_instance">verify_dicom_instance</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Verify PII on a single DICOM instance.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.eval_dicom_instance" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.eval_dicom_instance">eval_dicom_instance</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Evaluate performance for a single DICOM instance.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_precision" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_precision">calculate_precision</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Calculate precision.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_recall" href="#presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_recall">calculate_recall</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Calculate recall.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">DicomImagePiiVerifyEngine</span><span class="p">(</span><span class="n">ImagePiiVerifyEngine</span><span class="p">,</span> <span class="n">DicomImageRedactorEngine</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class to handle verification and evaluation for DICOM de-identification.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">ocr_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OCR</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">image_analyzer_engine</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageAnalyzerEngine</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize DicomImagePiiVerifyEngine object.</span>

<span class="sd">        :param ocr_engine: OCR engine to use.</span>
<span class="sd">        :param image_analyzer_engine: Image analyzer engine to use.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize OCR engine</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ocr_engine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ocr_engine</span> <span class="o">=</span> <span class="n">TesseractOCR</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ocr_engine</span> <span class="o">=</span> <span class="n">ocr_engine</span>

        <span class="c1"># Initialize image analyzer engine</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_analyzer_engine</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span> <span class="o">=</span> <span class="n">ImageAnalyzerEngine</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span> <span class="o">=</span> <span class="n">image_analyzer_engine</span>

        <span class="c1"># Initialize bbox processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span> <span class="o">=</span> <span class="n">BboxProcessor</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">verify_dicom_instance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Verify PII on a single DICOM instance.</span>

<span class="sd">        :param instance: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">        :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">        :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">        :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">        image with bounding boxes.</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in ImageAnalyzerEngine.</span>

<span class="sd">        :return: Image with boxes identifying PHI, OCR results,</span>
<span class="sd">        and analyzer results.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">instance_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">instance_copy</span><span class="o">.</span><span class="n">PixelData</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Provided DICOM instance lacks pixel data.&quot;</span><span class="p">)</span>

        <span class="c1"># Load image for processing</span>
        <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
            <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
            <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance_copy</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance_copy</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="s2">&quot;tmp_dcm&quot;</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

            <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/tmp_dcm.png&quot;</span>
            <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

        <span class="c1"># Get OCR results</span>
        <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
        <span class="p">)</span>  <span class="c1"># noqa: E501</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr_engine</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
            <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
                <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
            <span class="p">)</span>
        <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

        <span class="c1"># Get analyzer results</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>

        <span class="c1"># Prepare for plotting</span>
        <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
            <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
            <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Get image with verification boxes</span>
        <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">display_image</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">verify_image</span><span class="p">,</span> <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>

    <span class="k">def</span> <span class="nf">eval_dicom_instance</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
        <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
        <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate performance for a single DICOM instance.</span>

<span class="sd">        :param instance: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">        :param ground_truth: Dictionary containing ground truth labels for the instance.</span>
<span class="sd">        :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">        :param tolerance: Pixel distance tolerance for matching to ground truth.</span>
<span class="sd">        :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">        :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">        are present in the metadata.</span>
<span class="sd">        :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">        :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">        for ad-hoc recognizer.</span>
<span class="sd">        :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">        in ImageAnalyzerEngine.</span>

<span class="sd">        :return: Evaluation comparing redactor engine results vs ground truth.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Verify detected PHI</span>
        <span class="n">verify_image</span><span class="p">,</span> <span class="n">ocr_results</span><span class="p">,</span> <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_dicom_instance</span><span class="p">(</span>
            <span class="n">instance</span><span class="p">,</span>
            <span class="n">padding_width</span><span class="p">,</span>
            <span class="n">display_image</span><span class="p">,</span>
            <span class="n">use_metadata</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">formatted_ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span>
            <span class="n">ocr_results</span>
        <span class="p">)</span>
        <span class="n">detected_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
            <span class="n">analyzer_results</span>
        <span class="p">)</span>

        <span class="c1"># Remove duplicate entities in results</span>
        <span class="n">detected_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicate_entities</span><span class="p">(</span><span class="n">detected_phi</span><span class="p">)</span>

        <span class="c1"># Get correct PHI text (all TP and FP)</span>
        <span class="n">all_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_all_positives</span><span class="p">(</span>
            <span class="n">ground_truth</span><span class="p">,</span> <span class="n">formatted_ocr_results</span><span class="p">,</span> <span class="n">detected_phi</span><span class="p">,</span> <span class="n">tolerance</span>
        <span class="p">)</span>

        <span class="c1"># Calculate evaluation metrics</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_precision</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">)</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_recall</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">)</span>

        <span class="n">eval_results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;all_positives&quot;</span><span class="p">:</span> <span class="n">all_pos</span><span class="p">,</span>
            <span class="s2">&quot;ground_truth&quot;</span><span class="p">:</span> <span class="n">ground_truth</span><span class="p">,</span>
            <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
            <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">verify_image</span><span class="p">,</span> <span class="n">eval_results</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_remove_duplicate_entities</span><span class="p">(</span>
        <span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">dup_pix_tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle when a word is detected multiple times as different types of entities.</span>

<span class="sd">        :param results: List of detected PHI with bbox info.</span>
<span class="sd">        :param dup_pix_tolerance: Pixel difference tolerance for identifying duplicates.</span>
<span class="sd">        :return: Detected PHI with no duplicate entities.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="nb">sorted</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">results_no_dups</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">]</span>

        <span class="c1"># Check for duplicates</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">i_dims</span> <span class="o">=</span> <span class="p">{</span><span class="n">dim</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">}</span>

            <span class="c1"># Ignore if we&#39;ve already detected this dup combination</span>
            <span class="k">for</span> <span class="n">other</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">results_no_dups</span><span class="p">:</span>
                    <span class="n">other_dims</span> <span class="o">=</span> <span class="p">{</span><span class="n">dim</span><span class="p">:</span> <span class="n">results</span><span class="p">[</span><span class="n">other</span><span class="p">][</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">}</span>
                    <span class="n">matching_dims</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="n">dim</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">i_dims</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">-</span> <span class="n">other_dims</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">dup_pix_tolerance</span>
                        <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dims</span>
                    <span class="p">}</span>
                    <span class="n">matching</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">matching_dims</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

                    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">matching</span><span class="p">):</span>
                        <span class="n">lower_scored_index</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">other</span>
                            <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="n">other</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;score&quot;</span><span class="p">]</span>
                            <span class="k">else</span> <span class="n">i</span>
                        <span class="p">)</span>
                        <span class="n">dups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lower_scored_index</span><span class="p">)</span>

        <span class="c1"># Remove duplicates</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dups</span><span class="p">:</span>
                <span class="n">results_no_dups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">results_no_dups</span>

    <span class="k">def</span> <span class="nf">_label_all_positives</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">gt_labels_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
        <span class="n">ocr_results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">detected_phi</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
        <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Label all entities detected as PHI by using ground truth and OCR results.</span>

<span class="sd">        All positives (detected_phi) do not contain PHI labels and are thus</span>
<span class="sd">        difficult to work with intuitively. This method maps back to the</span>
<span class="sd">        actual PHI to each detected sensitive entity.</span>

<span class="sd">        :param gt_labels_dict: Dictionary with ground truth labels for a</span>
<span class="sd">        single DICOM instance.</span>
<span class="sd">        :param ocr_results: All detected text.</span>
<span class="sd">        :param detected_phi: Formatted analyzer_results.</span>
<span class="sd">        :param tolerance: Tolerance for exact coordinates and size data.</span>
<span class="sd">        :return: List of all positives, labeled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_pos</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Cycle through each positive (TP or FP)</span>
        <span class="k">for</span> <span class="n">analyzer_result</span> <span class="ow">in</span> <span class="n">detected_phi</span><span class="p">:</span>
            <span class="c1"># See if there are any ground truth matches</span>
            <span class="n">all_pos</span><span class="p">,</span> <span class="n">gt_match_found</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">match_with_source</span><span class="p">(</span>
                <span class="n">all_pos</span><span class="p">,</span> <span class="n">gt_labels_dict</span><span class="p">,</span> <span class="n">analyzer_result</span><span class="p">,</span> <span class="n">tolerance</span>
            <span class="p">)</span>

            <span class="c1"># If not, check back with OCR</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">gt_match_found</span><span class="p">:</span>
                <span class="n">all_pos</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">match_with_source</span><span class="p">(</span>
                    <span class="n">all_pos</span><span class="p">,</span> <span class="n">ocr_results</span><span class="p">,</span> <span class="n">analyzer_result</span><span class="p">,</span> <span class="n">tolerance</span>
                <span class="p">)</span>

        <span class="c1"># Remove any duplicates</span>
        <span class="n">all_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicate_entities</span><span class="p">(</span><span class="n">all_pos</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_pos</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calculate_precision</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate precision.</span>

<span class="sd">        :param gt: List of ground truth labels.</span>
<span class="sd">        :param all_pos: All Detected PHI (mapped back to have actual PHI text).</span>
<span class="sd">        :return: Precision value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find True Positive (TP) and precision</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_pos</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">precision</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">calculate_recall</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate recall.</span>

<span class="sd">        :param gt: List of ground truth labels.</span>
<span class="sd">        :param all_pos: All Detected PHI (mapped back to have actual PHI text).</span>
<span class="sd">        :return: Recall value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Find True Positive (TP) and precision</span>
        <span class="n">tp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">recall</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gt</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="n">recall</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">recall</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.redact" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given DICOM image.</p>
<p>Please note, this method duplicates the image, creates a
new instance and manipulates it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Fill setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>DICOM instance with redacted pixel data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image.</span>

<span class="sd">    Please note, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulates it.</span>

<span class="sd">    :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: DICOM instance with redacted pixel data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">redacted_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">redact_and_return_bbox</span><span class="p">(</span>
        <span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">redacted_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.redact_and_return_bbox" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_and_return_bbox</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_and_return_bbox</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact the given DICOM image and return redacted bboxes.</p>
<p>Please note, this method duplicates the image, creates a
new instance and manipulates it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Fill setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="pydicom.dataset.FileDataset">FileDataset</span>, <span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[str, int]]]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>DICOM instance with redacted pixel data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_and_return_bbox</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact the given DICOM image and return redacted bboxes.</span>

<span class="sd">    Please note, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulates it.</span>

<span class="sd">    :param image: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param fill: Fill setting to use for redaction box (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>

<span class="sd">    :return: DICOM instance with redacted pixel data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check input</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">image</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The provided image must be a loaded DICOM instance.&quot;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">image</span><span class="o">.</span><span class="n">PixelData</span>
    <span class="k">except</span> <span class="ne">AttributeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Provided DICOM instance lacks pixel data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">PermissionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to access pixel data (may not exist): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">IsADirectoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">IsADirectoryError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DICOM instance is a directory: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">instance</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Load image for processing</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
        <span class="n">image_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">image_name</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

        <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">image_name</span><span class="si">}</span><span class="s2">.png&quot;</span>
        <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Redact all bounding boxes from DICOM file</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>
    <span class="n">bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">remove_bbox_padding</span><span class="p">(</span><span class="n">analyzer_bboxes</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>
    <span class="n">redacted_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_redact_box</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">bboxes</span><span class="p">,</span> <span class="n">crop_ratio</span><span class="p">,</span> <span class="n">fill</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">redacted_image</span><span class="p">,</span> <span class="n">bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_file" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_from_file</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_from_file</span><span class="p">(</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact from a given file.</p>
<p>Please notice, this method duplicates the file, creates
new instance and manipulate them.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_dicom_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to DICOM image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to parent output directory.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code></code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>padding_width</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Color setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to save boundings boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbose</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to print where redacted file was written to.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_from_file</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a given file.</span>

<span class="sd">    Please notice, this method duplicates the file, creates</span>
<span class="sd">    new instance and manipulate them.</span>

<span class="sd">    :param input_dicom_path: String path to DICOM image.</span>
<span class="sd">    :param output_dir: String path to parent output directory.</span>
<span class="sd">    :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">    :param fill: Color setting to use for redaction box</span>
<span class="sd">    (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">    :param verbose: True to print where redacted file was written to.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify the given paths</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be file (not dir)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid file&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create duplicate</span>
    <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

    <span class="c1"># Process DICOM file</span>
    <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_single_dicom_image</span><span class="p">(</span>
        <span class="n">dcm_path</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.redact_from_directory" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">redact_from_directory</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">redact_from_directory</span><span class="p">(</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Redact method to redact from a directory of files.</p>
<p>Please notice, this method duplicates the files, creates
new instances and manipulate them.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>input_dicom_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to directory of DICOM images.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_dir</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String path to parent output directory.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code></code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>padding_width</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Portion of image to consider when selecting most common pixel value as the background color value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>float</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.75</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Color setting to use for redaction box ("contrast" or "background").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;contrast&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_bboxes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to save boundings boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in AnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">redact_from_directory</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">input_dicom_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">output_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">crop_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span>
    <span class="n">fill</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">save_bboxes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Redact method to redact from a directory of files.</span>

<span class="sd">    Please notice, this method duplicates the files, creates</span>
<span class="sd">    new instances and manipulate them.</span>

<span class="sd">    :param input_dicom_path: String path to directory of DICOM images.</span>
<span class="sd">    :param output_dir: String path to parent output directory.</span>
<span class="sd">    :param padding_width : Padding width to use when running OCR.</span>
<span class="sd">    :param crop_ratio: Portion of image to consider when selecting</span>
<span class="sd">    most common pixel value as the background color value.</span>
<span class="sd">    :param fill: Color setting to use for redaction box</span>
<span class="sd">    (&quot;contrast&quot; or &quot;background&quot;).</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param save_bboxes: True if we want to save boundings boxes.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in AnalyzerEngine.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify the given paths</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a valid directory&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;input_dicom_path must be a directory (not file)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">output_dir</span><span class="p">)</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
            <span class="s2">&quot;output_dir must be a directory (does not need to exist yet)&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create duplicates</span>
    <span class="n">dst_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_copy_files_for_processing</span><span class="p">(</span><span class="n">input_dicom_path</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span>

    <span class="c1"># Process DICOM files</span>
    <span class="n">output_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_redact_multiple_dicom_images</span><span class="p">(</span>
        <span class="n">dcm_dir</span><span class="o">=</span><span class="n">dst_path</span><span class="p">,</span>
        <span class="n">crop_ratio</span><span class="o">=</span><span class="n">crop_ratio</span><span class="p">,</span>
        <span class="n">fill</span><span class="o">=</span><span class="n">fill</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="o">=</span><span class="n">padding_width</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="o">=</span><span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dst_parent_dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">save_bboxes</span><span class="o">=</span><span class="n">save_bboxes</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output written to </span><span class="si">{</span><span class="n">output_location</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.augment_word" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">augment_word</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Apply multiple types of casing to the provided string.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>words</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>String containing the word or term of interest.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>case_sensitive</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True if we want to preserve casing.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>list</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of the same string with different casings and spacing.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_redactor_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">augment_word</span><span class="p">(</span><span class="n">word</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">case_sensitive</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply multiple types of casing to the provided string.</span>

<span class="sd">    :param words: String containing the word or term of interest.</span>
<span class="sd">    :param case_sensitive: True if we want to preserve casing.</span>

<span class="sd">    :return: List of the same string with different casings and spacing.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">word_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">word</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="c1"># Replacing separator character with space, if any</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="n">text_no_separator</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">case_sensitive</span><span class="p">:</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text_no_separator</span><span class="p">)</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Capitalize all characters in string</span>
            <span class="n">text_upper</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

            <span class="c1"># Lowercase all characters in string</span>
            <span class="n">text_lower</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

            <span class="c1"># Capitalize first letter in each part of string</span>
            <span class="n">text_title</span> <span class="o">=</span> <span class="n">text_no_separator</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

            <span class="c1"># Append iterations</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span><span class="n">text_no_separator</span><span class="p">,</span> <span class="n">text_upper</span><span class="p">,</span> <span class="n">text_lower</span><span class="p">,</span> <span class="n">text_title</span><span class="p">]</span>
            <span class="p">)</span>

            <span class="c1"># Adding each term as a separate item in the list</span>
            <span class="n">word_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">text_no_separator</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_upper</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_lower</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                    <span class="n">text_title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Flatten list</span>
        <span class="n">flat_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">word_list</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">flat_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">flat_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

        <span class="c1"># Remove any duplicates and empty strings</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">flat_list</span><span class="p">))</span>
        <span class="n">word_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">word_list</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">word_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.verify" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">verify</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">verify</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Annotate image with the detect PII entity.</p>
<p>Please notice, this method duplicates the image, creates a
new instance and manipulate it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PIL Image to be processed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether the image is greyscale or not.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the verificationimage is displayed and returned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_text_annotation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to display entity type when displaying image with bounding boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="PIL.Image">Image</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>the annotated image</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="p">,</span>
    <span class="n">is_greyscale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Annotate image with the detect PII entity.</span>

<span class="sd">    Please notice, this method duplicates the image, creates a</span>
<span class="sd">    new instance and manipulate it.</span>

<span class="sd">    :param image: PIL Image to be processed.</span>
<span class="sd">    :param is_greyscale: Whether the image is greyscale or not.</span>
<span class="sd">    :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">    :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">    image with bounding boxes.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in ImageAnalyzerEngine.</span>

<span class="sd">    :return: the annotated image</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">ImageChops</span><span class="o">.</span><span class="n">duplicate</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Check the ad-hoc recognizers list</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_check_ad_hoc_recognizer_list</span><span class="p">(</span><span class="n">ad_hoc_recognizers</span><span class="p">)</span>

    <span class="c1"># Detect text</span>
    <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># noqa: E501</span>
    <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">ocr</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
            <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
        <span class="p">)</span>
    <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

    <span class="c1"># Detect PII</span>
    <span class="k">if</span> <span class="n">ad_hoc_recognizers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
            <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
            <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>

    <span class="c1"># Prepare for plotting</span>
    <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
        <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Get image with verification boxes</span>
    <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">display_image</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">verify_image</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.verify_dicom_instance" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">verify_dicom_instance</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">verify_dicom_instance</span><span class="p">(</span>
    <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Verify PII on a single DICOM instance.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>instance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the verificationimage is displayed and returned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>show_text_annotation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>True to display entity type when displaying image with bounding boxes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Optional">Optional</span>[<span title="PIL.Image.Image">Image</span>], dict, list]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Image with boxes identifying PHI, OCR results, and analyzer results.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify_dicom_instance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">show_text_annotation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Verify PII on a single DICOM instance.</span>

<span class="sd">    :param instance: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">    :param show_text_annotation: True to display entity type when displaying</span>
<span class="sd">    image with bounding boxes.</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in ImageAnalyzerEngine.</span>

<span class="sd">    :return: Image with boxes identifying PHI, OCR results,</span>
<span class="sd">    and analyzer results.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">instance_copy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">instance_copy</span><span class="o">.</span><span class="n">PixelData</span>
    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s2">&quot;Provided DICOM instance lacks pixel data.&quot;</span><span class="p">)</span>

    <span class="c1"># Load image for processing</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdirname</span><span class="p">:</span>
        <span class="c1"># Convert DICOM to PNG and add padding for OCR (during analysis)</span>
        <span class="n">is_greyscale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_if_greyscale</span><span class="p">(</span><span class="n">instance_copy</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rescale_dcm_pixel_array</span><span class="p">(</span><span class="n">instance_copy</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_pixel_array_as_png</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="s2">&quot;tmp_dcm&quot;</span><span class="p">,</span> <span class="n">tmpdirname</span><span class="p">)</span>

        <span class="n">png_filepath</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdirname</span><span class="si">}</span><span class="s2">/tmp_dcm.png&quot;</span>
        <span class="n">loaded_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">png_filepath</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_padding</span><span class="p">(</span><span class="n">loaded_image</span><span class="p">,</span> <span class="n">is_greyscale</span><span class="p">,</span> <span class="n">padding_width</span><span class="p">)</span>

    <span class="c1"># Get OCR results</span>
    <span class="n">perform_ocr_kwargs</span><span class="p">,</span> <span class="n">ocr_threshold</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">_parse_ocr_kwargs</span><span class="p">(</span><span class="n">ocr_kwargs</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># noqa: E501</span>
    <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ocr_engine</span><span class="o">.</span><span class="n">perform_ocr</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">**</span><span class="n">perform_ocr_kwargs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ocr_threshold</span><span class="p">:</span>
        <span class="n">ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">threshold_ocr_result</span><span class="p">(</span>
            <span class="n">ocr_results</span><span class="p">,</span> <span class="n">ocr_threshold</span>
        <span class="p">)</span>
    <span class="n">ocr_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span><span class="n">ocr_results</span><span class="p">)</span>

    <span class="c1"># Get analyzer results</span>
    <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_analyzer_results</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">analyzer_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>

    <span class="c1"># Prepare for plotting</span>
    <span class="n">pii_bboxes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">get_pii_bboxes</span><span class="p">(</span>
        <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">is_greyscale</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">use_greyscale_cmap</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Get image with verification boxes</span>
    <span class="n">verify_image</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">image_analyzer_engine</span><span class="o">.</span><span class="n">add_custom_bboxes</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span> <span class="n">pii_bboxes</span><span class="p">,</span> <span class="n">show_text_annotation</span><span class="p">,</span> <span class="n">use_greyscale_cmap</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">display_image</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">verify_image</span><span class="p">,</span> <span class="n">ocr_bboxes</span><span class="p">,</span> <span class="n">analyzer_bboxes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.eval_dicom_instance" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">eval_dicom_instance</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">eval_dicom_instance</span><span class="p">(</span>
    <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Evaluate performance for a single DICOM instance.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>instance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded DICOM instance including pixel data and metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="pydicom.dataset.FileDataset">FileDataset</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ground_truth</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary containing ground truth labels for the instance.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>dict</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>padding_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to use when running OCR.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>25</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tolerance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel distance tolerance for matching to ground truth.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>50</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>display_image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If the verificationimage is displayed and returned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_metadata</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to redact text in the image that are present in the metadata.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>bool</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocr_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional params for OCR methods.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[dict]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ad_hoc_recognizers</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of PatternRecognizer objects to use for ad-hoc recognizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="presidio_analyzer.PatternRecognizer" href="../analyzer_python/#presidio_analyzer.pattern_recognizer.PatternRecognizer">PatternRecognizer</a>]]</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>text_analyzer_kwargs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional values for the analyze method in ImageAnalyzerEngine.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>{}</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="typing.Optional">Optional</span>[<span title="PIL.Image.Image">Image</span>], dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Evaluation comparing redactor engine results vs ground truth.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eval_dicom_instance</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">instance</span><span class="p">:</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">dataset</span><span class="o">.</span><span class="n">FileDataset</span><span class="p">,</span>
    <span class="n">ground_truth</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">padding_width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">tolerance</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">display_image</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">use_metadata</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">ocr_kwargs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ad_hoc_recognizers</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PatternRecognizer</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">],</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate performance for a single DICOM instance.</span>

<span class="sd">    :param instance: Loaded DICOM instance including pixel data and metadata.</span>
<span class="sd">    :param ground_truth: Dictionary containing ground truth labels for the instance.</span>
<span class="sd">    :param padding_width: Padding width to use when running OCR.</span>
<span class="sd">    :param tolerance: Pixel distance tolerance for matching to ground truth.</span>
<span class="sd">    :param display_image: If the verificationimage is displayed and returned.</span>
<span class="sd">    :param use_metadata: Whether to redact text in the image that</span>
<span class="sd">    are present in the metadata.</span>
<span class="sd">    :param ocr_kwargs: Additional params for OCR methods.</span>
<span class="sd">    :param ad_hoc_recognizers: List of PatternRecognizer objects to use</span>
<span class="sd">    for ad-hoc recognizer.</span>
<span class="sd">    :param text_analyzer_kwargs: Additional values for the analyze method</span>
<span class="sd">    in ImageAnalyzerEngine.</span>

<span class="sd">    :return: Evaluation comparing redactor engine results vs ground truth.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify detected PHI</span>
    <span class="n">verify_image</span><span class="p">,</span> <span class="n">ocr_results</span><span class="p">,</span> <span class="n">analyzer_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_dicom_instance</span><span class="p">(</span>
        <span class="n">instance</span><span class="p">,</span>
        <span class="n">padding_width</span><span class="p">,</span>
        <span class="n">display_image</span><span class="p">,</span>
        <span class="n">use_metadata</span><span class="p">,</span>
        <span class="n">ocr_kwargs</span><span class="o">=</span><span class="n">ocr_kwargs</span><span class="p">,</span>
        <span class="n">ad_hoc_recognizers</span><span class="o">=</span><span class="n">ad_hoc_recognizers</span><span class="p">,</span>
        <span class="o">**</span><span class="n">text_analyzer_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">formatted_ocr_results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_ocr_results</span><span class="p">(</span>
        <span class="n">ocr_results</span>
    <span class="p">)</span>
    <span class="n">detected_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bbox_processor</span><span class="o">.</span><span class="n">get_bboxes_from_analyzer_results</span><span class="p">(</span>
        <span class="n">analyzer_results</span>
    <span class="p">)</span>

    <span class="c1"># Remove duplicate entities in results</span>
    <span class="n">detected_phi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_duplicate_entities</span><span class="p">(</span><span class="n">detected_phi</span><span class="p">)</span>

    <span class="c1"># Get correct PHI text (all TP and FP)</span>
    <span class="n">all_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label_all_positives</span><span class="p">(</span>
        <span class="n">ground_truth</span><span class="p">,</span> <span class="n">formatted_ocr_results</span><span class="p">,</span> <span class="n">detected_phi</span><span class="p">,</span> <span class="n">tolerance</span>
    <span class="p">)</span>

    <span class="c1"># Calculate evaluation metrics</span>
    <span class="n">precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_precision</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">)</span>
    <span class="n">recall</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_recall</span><span class="p">(</span><span class="n">ground_truth</span><span class="p">,</span> <span class="n">all_pos</span><span class="p">)</span>

    <span class="n">eval_results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;all_positives&quot;</span><span class="p">:</span> <span class="n">all_pos</span><span class="p">,</span>
        <span class="s2">&quot;ground_truth&quot;</span><span class="p">:</span> <span class="n">ground_truth</span><span class="p">,</span>
        <span class="s2">&quot;precision&quot;</span><span class="p">:</span> <span class="n">precision</span><span class="p">,</span>
        <span class="s2">&quot;recall&quot;</span><span class="p">:</span> <span class="n">recall</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">verify_image</span><span class="p">,</span> <span class="n">eval_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_precision" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_precision</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate_precision</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate precision.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gt</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of ground truth labels.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_pos</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>All Detected PHI (mapped back to have actual PHI text).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>float</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Precision value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">calculate_precision</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate precision.</span>

<span class="sd">    :param gt: List of ground truth labels.</span>
<span class="sd">    :param all_pos: All Detected PHI (mapped back to have actual PHI text).</span>
<span class="sd">    :return: Precision value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find True Positive (TP) and precision</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_pos</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">precision</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">precision</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.DicomImagePiiVerifyEngine.calculate_recall" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">calculate_recall</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">calculate_recall</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Calculate recall.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>gt</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of ground truth labels.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>all_pos</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>All Detected PHI (mapped back to have actual PHI text).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.List">List</span>[dict]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>float</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Recall value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/dicom_image_pii_verify_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">calculate_recall</span><span class="p">(</span><span class="n">gt</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">all_pos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate recall.</span>

<span class="sd">    :param gt: List of ground truth labels.</span>
<span class="sd">    :param all_pos: All Detected PHI (mapped back to have actual PHI text).</span>
<span class="sd">    :return: Recall value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find True Positive (TP) and precision</span>
    <span class="n">tp</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_pos</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">gt</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">gt</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
        <span class="n">recall</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">recall</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.ContrastSegmentedImageEnhancer" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ContrastSegmentedImageEnhancer</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor">ImagePreprocessor</a></code></p>


        <p>Class containing all logic to perform contrastive segmentation.</p>
<p>Contrastive segmentation is a preprocessing step that aims to enhance the
text in an image by increasing the contrast between the text and the
background. The parameters used to run the preprocessing are selected based
on the contrast level of the image.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ContrastSegmentedImageEnhancer.convert_image_to_array" href="#presidio_image_redactor.ContrastSegmentedImageEnhancer.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ContrastSegmentedImageEnhancer.preprocess_image" href="#presidio_image_redactor.ContrastSegmentedImageEnhancer.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image to be analyzed.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ContrastSegmentedImageEnhancer</span><span class="p">(</span><span class="n">ImagePreprocessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class containing all logic to perform contrastive segmentation.</span>

<span class="sd">    Contrastive segmentation is a preprocessing step that aims to enhance the</span>
<span class="sd">    text in an image by increasing the contrast between the text and the</span>
<span class="sd">    background. The parameters used to run the preprocessing are selected based</span>
<span class="sd">    on the contrast level of the image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bilateral_filter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BilateralFilter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">adaptive_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SegmentedAdaptiveThreshold</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">image_rescaling</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ImageRescaling</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">low_contrast_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the class.</span>

<span class="sd">        :param bilateral_filter: Optional BilateralFilter instance.</span>
<span class="sd">        :param adaptive_threshold: Optional AdaptiveThreshold instance.</span>
<span class="sd">        :param image_rescaling: Optional ImageRescaling instance.</span>
<span class="sd">        :param low_contrast_threshold: Threshold for low contrast images.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">use_greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bilateral_filter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bilateral_filter</span> <span class="o">=</span> <span class="n">BilateralFilter</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bilateral_filter</span> <span class="o">=</span> <span class="n">bilateral_filter</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">adaptive_threshold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_threshold</span> <span class="o">=</span> <span class="n">SegmentedAdaptiveThreshold</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_threshold</span> <span class="o">=</span> <span class="n">adaptive_threshold</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">image_rescaling</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_rescaling</span> <span class="o">=</span> <span class="n">ImageRescaling</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">image_rescaling</span> <span class="o">=</span> <span class="n">image_rescaling</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">low_contrast_threshold</span> <span class="o">=</span> <span class="n">low_contrast_threshold</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and metadata (background color, scale percentage,</span>
<span class="sd">             contrast level, and C value).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Apply bilateral filtering</span>
        <span class="n">filtered_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bilateral_filter</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Convert to grayscale</span>
        <span class="n">pil_filtered_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">))</span>
        <span class="n">pil_grayscale_image</span> <span class="o">=</span> <span class="n">pil_filtered_image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">grayscale_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pil_grayscale_image</span><span class="p">)</span>

        <span class="c1"># Improve contrast</span>
        <span class="n">adjusted_image</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">adjusted_contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_improve_contrast</span><span class="p">(</span><span class="n">grayscale_image</span><span class="p">)</span>

        <span class="c1"># Adaptive Thresholding</span>
        <span class="n">adaptive_threshold_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_threshold</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span>
            <span class="n">adjusted_image</span>
        <span class="p">)</span>
        <span class="c1"># Increase contrast</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">adaptive_threshold_image</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">|</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Rescale image</span>
        <span class="n">rescaled_image</span><span class="p">,</span> <span class="n">scale_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_rescaling</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span>
            <span class="n">threshold_image</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">rescaled_image</span><span class="p">,</span> <span class="n">scale_metadata</span>

    <span class="k">def</span> <span class="nf">_improve_contrast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Improve the contrast of an image based on its initial contrast level.</span>

<span class="sd">        :param image: Input image.</span>

<span class="sd">        :return: A tuple containing the improved image, the initial contrast level,</span>
<span class="sd">             and the adjusted contrast level.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contrast</span><span class="p">,</span> <span class="n">mean_intensity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">contrast</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">low_contrast_threshold</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.5</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="o">-</span><span class="n">mean_intensity</span> <span class="o">*</span> <span class="n">alpha</span>
            <span class="n">adjusted_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">convertScaleAbs</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">beta</span><span class="p">)</span>
            <span class="n">adjusted_contrast</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_contrast</span><span class="p">(</span><span class="n">adjusted_image</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adjusted_image</span> <span class="o">=</span> <span class="n">image</span>
            <span class="n">adjusted_contrast</span> <span class="o">=</span> <span class="n">contrast</span>
        <span class="k">return</span> <span class="n">adjusted_image</span><span class="p">,</span> <span class="n">contrast</span><span class="p">,</span> <span class="n">adjusted_contrast</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ContrastSegmentedImageEnhancer.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ContrastSegmentedImageEnhancer.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image to be analyzed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and metadata (background color, scale percentage, contrast level, and C value).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and metadata (background color, scale percentage,</span>
<span class="sd">         contrast level, and C value).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Apply bilateral filtering</span>
    <span class="n">filtered_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bilateral_filter</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Convert to grayscale</span>
    <span class="n">pil_filtered_image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">))</span>
    <span class="n">pil_grayscale_image</span> <span class="o">=</span> <span class="n">pil_filtered_image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
    <span class="n">grayscale_image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pil_grayscale_image</span><span class="p">)</span>

    <span class="c1"># Improve contrast</span>
    <span class="n">adjusted_image</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">adjusted_contrast</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_improve_contrast</span><span class="p">(</span><span class="n">grayscale_image</span><span class="p">)</span>

    <span class="c1"># Adaptive Thresholding</span>
    <span class="n">adaptive_threshold_image</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adaptive_threshold</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span>
        <span class="n">adjusted_image</span>
    <span class="p">)</span>
    <span class="c1"># Increase contrast</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">threshold</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">adaptive_threshold_image</span><span class="p">),</span>
        <span class="mi">0</span><span class="p">,</span>
        <span class="mi">255</span><span class="p">,</span>
        <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span> <span class="o">|</span> <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_OTSU</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Rescale image</span>
    <span class="n">rescaled_image</span><span class="p">,</span> <span class="n">scale_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image_rescaling</span><span class="o">.</span><span class="n">preprocess_image</span><span class="p">(</span>
        <span class="n">threshold_image</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">rescaled_image</span><span class="p">,</span> <span class="n">scale_metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.BilateralFilter" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">BilateralFilter</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor">ImagePreprocessor</a></code></p>


        <p>BilateralFilter class.</p>
<p>The class applies bilateral filtering to an image. and returns the filtered
  image and metadata.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.BilateralFilter.convert_image_to_array" href="#presidio_image_redactor.BilateralFilter.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.BilateralFilter.preprocess_image" href="#presidio_image_redactor.BilateralFilter.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image to be analyzed.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BilateralFilter</span><span class="p">(</span><span class="n">ImagePreprocessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;BilateralFilter class.</span>

<span class="sd">    The class applies bilateral filtering to an image. and returns the filtered</span>
<span class="sd">      image and metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">diameter</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sigma_color</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span> <span class="n">sigma_space</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the BilateralFilter class.</span>

<span class="sd">        :param diameter: Diameter of each pixel neighborhood.</span>
<span class="sd">        :param sigma_color: value of sigma in the color space.</span>
<span class="sd">        :param sigma_space: value of sigma in the coordinate space.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">use_greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span> <span class="o">=</span> <span class="n">diameter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span> <span class="o">=</span> <span class="n">sigma_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span> <span class="o">=</span> <span class="n">sigma_space</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and metadata (diameter, sigma_color, sigma_space).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Apply bilateral filtering</span>
        <span class="n">filtered_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bilateralFilter</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span>
            <span class="s2">&quot;sigma_color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span><span class="p">,</span>
            <span class="s2">&quot;sigma_space&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.BilateralFilter.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.BilateralFilter.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image to be analyzed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and metadata (diameter, sigma_color, sigma_space).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and metadata (diameter, sigma_color, sigma_space).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Apply bilateral filtering</span>
    <span class="n">filtered_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">bilateralFilter</span><span class="p">(</span>
        <span class="n">image</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;diameter&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">diameter</span><span class="p">,</span>
        <span class="s2">&quot;sigma_color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_color</span><span class="p">,</span>
        <span class="s2">&quot;sigma_space&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_space</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">filtered_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.SegmentedAdaptiveThreshold" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SegmentedAdaptiveThreshold</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor">ImagePreprocessor</a></code></p>


        <p>SegmentedAdaptiveThreshold class.</p>
<p>The class applies adaptive thresholding to an image
and returns the thresholded image and metadata.
The parameters used to run the adaptivethresholding are selected based on
the contrast level of the image.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.SegmentedAdaptiveThreshold.convert_image_to_array" href="#presidio_image_redactor.SegmentedAdaptiveThreshold.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.SegmentedAdaptiveThreshold.preprocess_image" href="#presidio_image_redactor.SegmentedAdaptiveThreshold.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SegmentedAdaptiveThreshold</span><span class="p">(</span><span class="n">ImagePreprocessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;SegmentedAdaptiveThreshold class.</span>

<span class="sd">    The class applies adaptive thresholding to an image</span>
<span class="sd">    and returns the thresholded image and metadata.</span>
<span class="sd">    The parameters used to run the adaptivethresholding are selected based on</span>
<span class="sd">    the contrast level of the image.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">block_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
        <span class="n">contrast_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">c_low_contrast</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="n">c_high_contrast</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
        <span class="n">bg_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">122</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the SegmentedAdaptiveThreshold class.</span>

<span class="sd">        :param block_size: Size of the neighborhood area for threshold calculation.</span>
<span class="sd">        :param contrast_threshold: Threshold for low contrast images.</span>
<span class="sd">        :param C_low_contrast: Constant added to the mean for low contrast images.</span>
<span class="sd">        :param C_high_contrast: Constant added to the mean for high contrast images.</span>
<span class="sd">        :param bg_threshold: Threshold for background color.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">use_greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="n">block_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_low_contrast</span> <span class="o">=</span> <span class="n">c_low_contrast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_high_contrast</span> <span class="o">=</span> <span class="n">c_high_contrast</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bg_threshold</span> <span class="o">=</span> <span class="n">bg_threshold</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contrast_threshold</span> <span class="o">=</span> <span class="n">contrast_threshold</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and metadata (C, background_color, contrast).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="c1"># Determine background color</span>
        <span class="n">background_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bg_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">contrast</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

        <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">c_low_contrast</span>
            <span class="k">if</span> <span class="n">contrast</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast_threshold</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_high_contrast</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">background_color</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bg_threshold</span><span class="p">:</span>
            <span class="n">adaptive_threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="mi">255</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_MEAN_C</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY_INV</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
                <span class="o">-</span><span class="n">c</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">adaptive_threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
                <span class="n">image</span><span class="p">,</span>
                <span class="mi">255</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_MEAN_C</span><span class="p">,</span>
                <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
                <span class="n">c</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="s2">&quot;background_color&quot;</span><span class="p">:</span> <span class="n">background_color</span><span class="p">,</span> <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="n">contrast</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">adaptive_threshold_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.SegmentedAdaptiveThreshold.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.SegmentedAdaptiveThreshold.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span>
    <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="typing.Union">Union</span>[<span title="PIL.Image.Image">Image</span>, <span title="numpy.ndarray">ndarray</span>]</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and metadata (C, background_color, contrast).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and metadata (C, background_color, contrast).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="c1"># Determine background color</span>
    <span class="n">background_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bg_color</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
    <span class="n">contrast</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_image_contrast</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c_low_contrast</span>
        <span class="k">if</span> <span class="n">contrast</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast_threshold</span>
        <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_high_contrast</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">background_color</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">bg_threshold</span><span class="p">:</span>
        <span class="n">adaptive_threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_MEAN_C</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY_INV</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
            <span class="o">-</span><span class="n">c</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">adaptive_threshold_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">adaptiveThreshold</span><span class="p">(</span>
            <span class="n">image</span><span class="p">,</span>
            <span class="mi">255</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">ADAPTIVE_THRESH_MEAN_C</span><span class="p">,</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">THRESH_BINARY</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">,</span>
            <span class="n">c</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;C&quot;</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span> <span class="s2">&quot;background_color&quot;</span><span class="p">:</span> <span class="n">background_color</span><span class="p">,</span> <span class="s2">&quot;contrast&quot;</span><span class="p">:</span> <span class="n">contrast</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">adaptive_threshold_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>






<div class="doc doc-object doc-class">



<h3 id="presidio_image_redactor.ImageRescaling" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ImageRescaling</span>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="presidio_image_redactor.image_processing_engine.ImagePreprocessor" href="#presidio_image_redactor.image_processing_engine.ImagePreprocessor">ImagePreprocessor</a></code></p>


        <p>ImageRescaling class. Rescales images based on their size.</p>







<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">METHOD</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageRescaling.convert_image_to_array" href="#presidio_image_redactor.ImageRescaling.convert_image_to_array">convert_image_to_array</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Convert PIL image to numpy array.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="presidio_image_redactor.ImageRescaling.preprocess_image" href="#presidio_image_redactor.ImageRescaling.preprocess_image">preprocess_image</a></code></td>
              <td class="doc-function-details">
                <div class="doc-md-description">
                  <p>Preprocess the image to be analyzed.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>


              <details class="quote">
                <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ImageRescaling</span><span class="p">(</span><span class="n">ImagePreprocessor</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;ImageRescaling class. Rescales images based on their size.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">small_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1048576</span><span class="p">,</span>
        <span class="n">large_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4000000</span><span class="p">,</span>
        <span class="n">factor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the ImageRescaling class.</span>

<span class="sd">        :param small_size: Threshold for small image size.</span>
<span class="sd">        :param large_size: Threshold for large image size.</span>
<span class="sd">        :param factor: Scaling factor for resizing.</span>
<span class="sd">        :param interpolation: Interpolation method for resizing.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">use_greyscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">small_size</span> <span class="o">=</span> <span class="n">small_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">large_size</span> <span class="o">=</span> <span class="n">large_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factor</span> <span class="o">=</span> <span class="n">factor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span> <span class="o">=</span> <span class="n">interpolation</span>

    <span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">        :param image: Loaded PIL image.</span>

<span class="sd">        :return: The processed image and metadata (scale_factor).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">small_size</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
        <span class="k">elif</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">large_size</span><span class="p">:</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>

        <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
        <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
        <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="c1"># resize image</span>
        <span class="n">rescaled_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">:</span> <span class="n">scale_factor</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">rescaled_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageRescaling.convert_image_to_array" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_image_to_array</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_image_to_array</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert PIL image to numpy array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>convert_to_greyscale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to convert the image to greyscale.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="numpy.ndarray">ndarray</span></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>image pixels as a numpy array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">convert_image_to_array</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert PIL image to numpy array.</span>

<span class="sd">    :param image: Loaded PIL image.</span>
<span class="sd">    :param convert_to_greyscale: Whether to convert the image to greyscale.</span>

<span class="sd">    :return: image pixels as a numpy array.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">image</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_greyscale</span><span class="p">:</span>
            <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>






<div class="doc doc-object doc-function">


<h4 id="presidio_image_redactor.ImageRescaling.preprocess_image" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">preprocess_image</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">preprocess_image</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Preprocess the image to be analyzed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loaded PIL image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><span title="PIL.Image.Image">Image</span></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><span title="typing.Tuple">Tuple</span>[<span title="PIL.Image.Image">Image</span>, dict]</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The processed image and metadata (scale_factor).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>presidio_image_redactor/image_processing_engine.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preprocess_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preprocess the image to be analyzed.</span>

<span class="sd">    :param image: Loaded PIL image.</span>

<span class="sd">    :return: The processed image and metadata (scale_factor).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">small_size</span><span class="p">:</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>
    <span class="k">elif</span> <span class="n">image</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">large_size</span><span class="p">:</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">factor</span>

    <span class="n">width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
    <span class="n">height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span>
    <span class="n">dimensions</span> <span class="o">=</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

    <span class="c1"># resize image</span>
    <span class="n">rescaled_image</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">dimensions</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">)</span>
    <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;scale_factor&quot;</span><span class="p">:</span> <span class="n">scale_factor</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">rescaled_image</span><span class="p">),</span> <span class="n">metadata</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>




  </div>

    </div>

</div>




  </div>

    </div>

</div>












                

              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/microsoft/presidio" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://hub.docker.com/_/microsoft-presidio" target="_blank" rel="noopener" title="hub.docker.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1zm0-204.3h-66.1v60.7h66.1zm78.2 144.8H362v59.4h66.1zm-156.3-72.1h-66.1v60.1h66.1zm78.1 0h-66.1v60.1h66.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1zm78.1 0h-66.1v59.4h66.1zm-78.1-72.1h-66.1v60.1h66.1z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:presidio@microsoft.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l217.6 163.2c11.4 8.5 27 8.5 38.4 0l217.6-163.2c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 176v208c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V176L294.4 339.2a63.9 63.9 0 0 1-76.8 0z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "content.tabs.link", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
    
  </body>
</html>