FROM python:3.13-windowsservercore

ENV PIP_NO_CACHE_DIR=1
ENV PORT=3000

WORKDIR /app

COPY ./pyproject.toml /app/
RUN python.exe -m pip install --upgrade pip; pip install poetry; poetry install --no-root --only=main -E server

COPY . /app/

EXPOSE ${PORT}
CMD ["powershell", "-Command", "poetry run waitress-serve --port=$env:PORT app:create_app"]
