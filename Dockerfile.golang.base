FROM golang:1.11-alpine AS base-deps

ARG DEP_VERSION="0.5.0"

RUN apk --update add curl git make g++

RUN curl -L -s https://github.com/golang/dep/releases/download/v${DEP_VERSION}/dep-linux-amd64 -o $GOPATH/bin/dep && \
    chmod +x $GOPATH/bin/dep && \
    curl -L https://git.io/vp6lP | sh

#----------------------------

FROM base-deps

WORKDIR $GOPATH/src/github.com/Microsoft/presidio
ADD . $GOPATH/src/github.com/Microsoft/presidio

RUN dep ensure && \
    make go-test
